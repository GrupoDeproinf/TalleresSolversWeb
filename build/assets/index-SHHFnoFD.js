import{r as s,j as e,a9 as P,a8 as E,aa as R}from"./index-KuHpp12A.js";import{P as ae}from"./index-fYT-_Uho.js";import{T}from"./index-boacLOhc.js";import{B as k}from"./Button-eyFfbJth.js";import{D as te}from"./Dialog-B56J56a8.js";import{u as oe,f as M,g as se,a as re,b as ne}from"./index-5v8nFfab.js";import{t as d,N as u}from"./toast-atGiHx5-.js";import{O as le,D as ce}from"./index.esm-kBL7sQe6.js";import{u as v,w as ie}from"./xlsx-b-y62sF7.js";import{n as de,F as ue}from"./index.esm-rGXFteFT.js";import"./context-7oHEF7cI.js";import"./index-SoSXLTBu.js";import"./index-v0Cy3ZU9.js";import"./CloseButton-iwuzLpEL.js";import"./motion-N0SAmF_z.js";import"./useTimeout-ti4Rp5j2.js";import"./StatusIcon-QGgKYtDM.js";import"./chainedFunction-ltcSYACe.js";const me=()=>{const[A,B]=s.useState([]),[H,m]=s.useState([]);s.useState(null);const[S,O]=s.useState("nombre_taller"),[h,U]=s.useState(""),[C,K]=s.useState([]),[g,w]=s.useState(""),[x,y]=s.useState(""),N=async()=>{try{const t=await R(E(P,"Servicios")),a=[];await Promise.all(t.docs.map(async r=>{const c=r.data(),o=r.id,i=(await R(E(P,"Servicios",o,"calificaciones"))).docs.map(_=>({..._.data(),id:_.id}));a.push({nombre_servicio:c.nombre_servicio,uid_servicio:o,calificaciones:i})}));const n=a.flatMap(r=>r.calificaciones.map(c=>({...c,nombre_servicio:r.nombre_servicio})));K(n)}catch(t){console.error("Error obteniendo los datos:",t)}};s.useEffect(()=>{N()},[]);const L=async()=>{await N(),d.push(e.jsx(u,{title:"Datos actualizados",children:"La tabla ha sido actualizada con éxito."}))},q=t=>{const a=t.target.value;U(a),m([{id:S,value:a}])},I=t=>{const a=t.target.value;O(a),h!==""&&m([{id:a,value:h}])},[z,D]=s.useState(!1),V=()=>{D(!0)},p=()=>{D(!1),w(""),y("")},G=[{header:"Taller",accessorKey:"nombre_taller"},{header:"Servicio",accessorKey:"nombre_servicio"},{header:"Fecha de Creación",cell:({row:t})=>{const a=t.original.fecha_creacion;if(a){if(a.toDate)return a.toDate().toLocaleString();if(a instanceof Date)return a.toLocaleString()}return"Sin fecha"}},{header:"Nombre del Usuario",accessorKey:"usuario.nombre"},{header:"Correo del Usuario",accessorKey:"usuario.email"},{header:"Puntuación",cell:({row:t})=>{const a=t.original.puntuacion||0,n=5,r=Array.from({length:n},(c,o)=>o<a?e.jsx(de,{color:"gold"},o):e.jsx(ue,{color:"gray"},o));return e.jsx("div",{style:{display:"flex",gap:"2px"},children:r})}},{header:"Comentario",accessorKey:"comentario"}],{Tr:F,Th:J,Td:Q,THead:W,TBody:X,Sorter:he}=T,f=oe({data:C,columns:G,state:{sorting:A,columnFilters:H},onSortingChange:B,onColumnFiltersChange:m,getCoreRowModel:se(),getSortedRowModel:re(),getFilteredRowModel:ne()}),[b,Y]=s.useState(1),j=6,Z=f.getRowModel().rows.length,$=t=>{console.log("onPaginationChange",t),Y(t)},ee=()=>{if(!g||!x){d.push(e.jsx(u,{title:"Fechas incompletas",children:"Por favor, selecciona ambas fechas para continuar."}));return}const t=new Date(g);t.setUTCHours(0,0,0,0);const a=new Date(x);a.setUTCHours(23,59,59,999),console.log({startDate:t,endDate:a});const n=C.filter(o=>{var i;const l=(i=o.fecha_creacion)==null?void 0:i.toDate();return console.log("Creation date aquí",l),l&&l>=t&&l<=a}).map(o=>{var l,i;return{"Nombre del taller":o.nombre_taller||"N/A",Puntuación:o.puntuacion||"N/A","Fecha de Creación":o.fecha_creacion?o.fecha_creacion.toDate().toLocaleString():"N/A","Nombre del Usuario":((l=o.usuario)==null?void 0:l.nombre)||"N/A","Correo del Usuario":((i=o.usuario)==null?void 0:i.email)||"N/A"}});if(n.length===0){d.push(e.jsx(u,{title:"Sin datos para exportar",children:"No hay datos disponibles en el rango de fechas seleccionado."}));return}const r=v.json_to_sheet(n),c=v.book_new();v.book_append_sheet(c,r,"Servicios"),ie(c,"ServiciosSolicitados.xlsx"),d.push(e.jsx(u,{title:"Exportación exitosa",children:"El archivo Excel se ha descargado correctamente."})),p(),console.log("Start date aquí: ",t,"End date aquí",a)};return e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsxs("h1",{className:"mb-6 flex justify-start items-center space-x-4",children:[" ",e.jsx("span",{className:"text-[#000B7E]",children:"Puntuación de talleres"}),e.jsx("button",{className:"p-2  bg-slate-100 hover:bg-slate-200 active:bg-slate-300 transition-all duration-200 shadow-md transform hover:scale-105 rounded-md",onClick:L,children:e.jsx(le,{className:"w-5 h-5 text-gray-700 hover:text-blue-500 transition-colors duration-200"})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"relative w-32",children:[" ",e.jsx("select",{className:"h-10 w-full py-2 px-4 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:I,value:S,children:e.jsx("option",{value:"nombre_taller",children:"Taller"})})]}),e.jsxs("div",{className:"relative w-80 ml-4",children:[e.jsx("input",{type:"text",placeholder:"Buscar...",className:"w-full py-2 px-4 pl-10 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 h-10",value:h,onChange:q}),e.jsx(ce,{className:"absolute left-3 top-5 transform -translate-y-1/2 text-gray-500 w-5 h-5"})]}),e.jsx("button",{style:{backgroundColor:"#000B7E"},className:"p-2 ml-4 bg-blue-500 text-white rounded-md shadow-md hover:bg-blue-600 active:bg-blue-700 transition duration-200 hover:opacity-80",onClick:V,children:"Exportar a Excel"})]})})]}),e.jsxs("div",{className:"p-1 rounded-lg shadow",children:[e.jsxs(T,{className:"w-full rounded-lg",children:[e.jsx(W,{children:f.getHeaderGroups().map(t=>e.jsx(F,{children:t.headers.map(a=>e.jsx(J,{colSpan:a.colSpan,children:a.isPlaceholder?null:e.jsx("div",{className:a.column.getCanSort()?"cursor-pointer select-none":"",onClick:a.column.getToggleSortingHandler(),children:M(a.column.columnDef.header,a.getContext())})},a.id))},t.id))}),e.jsx(X,{children:f.getRowModel().rows.slice((b-1)*j,b*j).map(t=>e.jsx(F,{children:t.getVisibleCells().map(a=>e.jsx(Q,{children:M(a.column.columnDef.cell,a.getContext())},a.id))},t.id))})]}),e.jsx(ae,{onChange:$,currentPage:b,totalRows:Z,rowsPerPage:j})]}),e.jsx(te,{isOpen:z,onClose:p,children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Seleccionar Rango de Fechas"}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"startDate",className:"block text-sm",children:"Fecha de Inicio:"}),e.jsx("input",{id:"startDate",type:"date",value:g,onChange:t=>w(t.target.value),className:"w-full border border-gray-300 rounded-md p-2"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"endDate",className:"block text-sm",children:"Fecha de Fin:"}),e.jsx("input",{id:"endDate",type:"date",value:x,onChange:t=>y(t.target.value),className:"w-full border border-gray-300 rounded-md p-2"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-4",children:[e.jsx(k,{onClick:p,children:"Cancelar"}),e.jsx(k,{onClick:ee,className:"text-white hover:opacity-80",style:{backgroundColor:"#000B7E"},children:"Exportar"})]})]})})]})})},ke=me;export{ke as default};
