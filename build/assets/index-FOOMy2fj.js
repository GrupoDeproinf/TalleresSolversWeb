import{a0 as A,a1 as U,a2 as _,a3 as V,r as u,a as f,j as t,au as R,L as J,T as Q,a5 as W}from"./index-50rgKX9S.js";import{A as X}from"./AdaptableCard-LFMvjwtD.js";import{A as z}from"./index-_GS3LEUB.js";import{B as I}from"./Badge-R0b3axTj.js";import{D as Z}from"./DataTable-UWSgVgZj.js";import{c as ee,d as te,e as se}from"./CrmService-z4pbjIpN.js";import{u as F}from"./useThemeClass-fPcZOa7P.js";import{B as T}from"./Button-xRLYDkxn.js";import{D as ae}from"./Drawer-o2AIGSQ4.js";import{c as h}from"./cloneDeep-5XeEZjui.js";import{i as re}from"./Views-A7x8nqpb.js";import{C as oe}from"./CustomerForm-vH8kldrC.js";import{I as ne}from"./Input--puSdvxq.js";import{D as ie,L as le,c as ce,aj as me,q as de}from"./index.esm-CTp4r0U4.js";import{d as ue}from"./debounce-4p2zp5Fx.js";import{S as pe,c as Ce}from"./Select-CxnAYESn.js";import{C as ge}from"./Card-vqKpG-UA.js";import{G as xe}from"./GrowShrinkTag-lH4L5ECE.js";import{M as fe}from"./MediaSkeleton-hvhC29h0.js";import{N as he}from"./react-number-format.es-56BQjFH8.js";import"./useMergeRef-Rt_Crb27.js";import"./Tooltip-GIYbDsiP.js";import"./index.esm-opZQsgq7.js";import"./floating-ui.react-bRmrURkd.js";import"./floating-ui.dom-0rLBacrf.js";import"./index-oREErx12.js";import"./motion-QExVqk61.js";import"./index-X3G8Yg8B.js";import"./index.esm-BzTP7NzC.js";import"./index-zp3PEYV3.js";import"./index-vTv-toOv.js";import"./_getAllKeys-1s2zq0dU.js";import"./_MapCache-2XbJC0-4.js";import"./_baseIsEqual-2B9JDPab.js";import"./get-werKe3PL.js";import"./toString-6lQZz3FR.js";import"./TableRowSkeleton-7SdP7iFu.js";import"./Skeleton-A_nRjx-l.js";import"./index-CcDhNinj.js";import"./ApiService-5KN9i4Cg.js";import"./context-S2-woICp.js";import"./index-E7L2uv60.js";import"./index-q4uYtSHq.js";import"./CloseButton-NICPh_Cl.js";import"./index-vTIpNX8M.js";import"./useControllableState-DOzhx4PK.js";import"./FormItem-tcv8UMxq.js";import"./formik.esm-Y7Bmnko2.js";import"./index.esm-1NCRVz3q.js";import"./index-v66BEvdr.js";import"./Calendar-3cZ-sm7M.js";import"./RangeCalendar-X9TLkpWI.js";import"./TimeInput-yjgONFtu.js";import"./useUniqueId-ShSZumYL.js";import"./useDidUpdate-12688dYZ.js";import"./Upload-J1c4aH1-.js";import"./index.esm-oiqqRY0R.js";import"./toast-X0ZD5_pK.js";import"./useTimeout-wgPWIlQI.js";import"./StatusIcon-HZtVKaUR.js";import"./chainedFunction-ltcSYACe.js";import"./isNil-tsmo4mGH.js";import"./toConsumableArray-YYxflNc8.js";import"./objectWithoutPropertiesLoose-pdUxmcoj.js";import"./setPrototypeOf-ahVgEFUp.js";import"./Tag-BtOgoHK3.js";const be="crmCustomers",L=A("crmCustomers/data/getCustomerStatistic",async()=>(await ee()).data),j=A("crmCustomers/data/getCustomers",async s=>(await te(s)).data),je=A("crmCustomers/data/putCustomer",async s=>(await se(s)).data),we={total:0,pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},ve={status:""},ye={loading:!1,statisticLoading:!1,customerList:[],statisticData:{},tableData:we,filterData:ve,drawerOpen:!1,selectedCustomer:{}},E=U({name:`${be}/state`,initialState:ye,reducers:{setTableData:(s,e)=>{s.tableData=e.payload},setCustomerList:(s,e)=>{s.customerList=e.payload},setFilterData:(s,e)=>{s.filterData=e.payload},setSelectedCustomer:(s,e)=>{s.selectedCustomer=e.payload},setDrawerOpen:s=>{s.drawerOpen=!0},setDrawerClose:s=>{s.drawerOpen=!1}},extraReducers:s=>{s.addCase(j.fulfilled,(e,a)=>{e.customerList=a.payload.data,e.tableData.total=a.payload.total,e.loading=!1}).addCase(j.pending,e=>{e.loading=!0}).addCase(L.fulfilled,(e,a)=>{e.statisticData=a.payload,e.statisticLoading=!1}).addCase(L.pending,e=>{e.statisticLoading=!0})}}),{setTableData:b,setCustomerList:Se,setFilterData:M,setSelectedCustomer:Y,setDrawerOpen:De,setDrawerClose:$}=E.actions,Ne=E.reducer,ke=_({data:Ne}),d=V,q=u.forwardRef((s,e)=>{const a=f(),r=d(i=>i.crmCustomers.data.selectedCustomer),c=d(i=>i.crmCustomers.data.customerList),{id:l}=r,o=i=>{const{name:g,birthday:p,email:C,img:w,location:v,title:y,phoneNumber:S,facebook:n,twitter:m,pinterest:G,linkedIn:H}=i,K={name:g,email:C,img:w},P={location:v,title:y,birthday:R(p).format("DD/MM/YYYY"),phoneNumber:S,facebook:n,twitter:m,pinterest:G,linkedIn:H};let D=h(c),N={};D=D.map(x=>(x.id===l&&(x={...x,...K},x.personalInfo={...x.personalInfo,...P},N=x),x)),re(N)||a(je(N)),a($()),a(Se(D))};return t.jsx(oe,{ref:e,customer:r,onFormSubmit:o})});q.displayName="CustomerEditContent";const Te=({onSaveClick:s,onCancel:e})=>t.jsxs("div",{className:"text-right w-full",children:[t.jsx(T,{size:"sm",className:"mr-2",onClick:e,children:"Cancel"}),t.jsx(T,{size:"sm",variant:"solid",onClick:s,children:"Save"})]}),Le=()=>{const s=f(),e=d(l=>l.crmCustomers.data.drawerOpen),a=()=>{s($()),s(Y({}))},r=u.useRef(null),c=()=>{var l;(l=r.current)==null||l.submitForm()};return t.jsx(ae,{isOpen:e,closable:!1,bodyClass:"p-0",footer:t.jsx(Te,{onCancel:a,onSaveClick:c}),onClose:a,onRequestClose:a,children:t.jsx(q,{ref:r})})},Ae={active:"bg-emerald-500",blocked:"bg-red-500"},Ie=({row:s})=>{const{textTheme:e}=F(),a=f(),r=()=>{a(De()),a(Y(s))};return t.jsx("div",{className:`${e} cursor-pointer select-none font-semibold`,onClick:r,children:"Edit"})},Oe=({row:s})=>{const{textTheme:e}=F();return t.jsxs("div",{className:"flex items-center",children:[t.jsx(z,{size:28,shape:"circle",src:s.img}),t.jsx(J,{className:`hover:${e} ml-2 rtl:mr-2 font-semibold`,to:`/app/crm/customer-details?id=${s.id}`,children:s.name})]})},Re=()=>{const s=f(),e=d(n=>n.crmCustomers.data.customerList),a=d(n=>n.crmCustomers.data.loading),r=d(n=>n.crmCustomers.data.filterData),{pageIndex:c,pageSize:l,sort:o,query:i,total:g}=d(n=>n.crmCustomers.data.tableData),p=u.useCallback(()=>{s(j({pageIndex:c,pageSize:l,sort:o,query:i,filterData:r}))},[c,l,o,i,r,s]);u.useEffect(()=>{p()},[p,c,l,o,r]);const C=u.useMemo(()=>({pageIndex:c,pageSize:l,sort:o,query:i,total:g}),[c,l,o,i,g]),w=u.useMemo(()=>[{header:"Name",accessorKey:"name",cell:n=>{const m=n.row.original;return t.jsx(Oe,{row:m})}},{header:"Email",accessorKey:"email"},{header:"Status",accessorKey:"status",cell:n=>{const m=n.row.original;return t.jsxs("div",{className:"flex items-center",children:[t.jsx(I,{className:Ae[m.status]}),t.jsx("span",{className:"ml-2 rtl:mr-2 capitalize",children:m.status})]})}},{header:"Last online",accessorKey:"lastOnline",cell:n=>{const m=n.row.original;return t.jsx("div",{className:"flex items-center",children:R.unix(m.lastOnline).format("MM/DD/YYYY")})}},{header:"",id:"action",cell:n=>t.jsx(Ie,{row:n.row.original})}],[]),v=n=>{const m=h(C);m.pageIndex=n,s(b(m))},y=n=>{const m=h(C);m.pageSize=Number(n),m.pageIndex=1,s(b(m))},S=n=>{const m=h(C);m.sort=n,s(b(m))};return t.jsxs(t.Fragment,{children:[t.jsx(Z,{columns:w,data:e,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:a,pagingData:{total:C.total,pageIndex:C.pageIndex,pageSize:C.pageSize},onPaginationChange:v,onSelectChange:y,onSort:S}),t.jsx(Le,{})]})},B=u.forwardRef((s,e)=>{const{onInputChange:a}=s,r=ue(c,500);function c(o){a==null||a(o)}const l=o=>{r(o.target.value)};return t.jsx(ne,{ref:e,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:t.jsx(ie,{className:"text-lg"}),onChange:l})});B.displayName="CustomerTableSearch";const{Control:ze}=Ce,O=[{value:"",label:"All",color:"bg-gray-500"},{value:"active",label:"Active",color:"bg-emerald-500"},{value:"blocked",label:"Blocked",color:"bg-red-500"}],Fe=({innerProps:s,label:e,data:a,isSelected:r})=>t.jsxs("div",{className:`flex items-center justify-between p-2 cursor-pointer ${r?"bg-gray-100 dark:bg-gray-500":"hover:bg-gray-50 dark:hover:bg-gray-600"}`,...s,children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(I,{innerClass:a.color}),t.jsx("span",{children:e})]}),r&&t.jsx(le,{className:"text-emerald-500 text-xl"})]}),Ee=({children:s,...e})=>{const a=e.getValue()[0];return t.jsxs(ze,{...e,children:[a&&t.jsx(I,{className:"ltr:ml-4 rtl:mr-4",innerClass:a.color}),s]})},Me=()=>{const s=f(),{status:e}=d(r=>r.crmCustomers.data.filterData),a=r=>{s(M({status:r==null?void 0:r.value}))};return t.jsx(pe,{options:O,size:"sm",className:"mb-4 min-w-[130px]",components:{Option:Fe,Control:Ee},value:O.filter(r=>r.value===e),onChange:a})},Ye=()=>{const s=f(),e=u.useRef(null),a=d(o=>o.crmCustomers.data.tableData),r=o=>{const i=h(a);i.query=o,i.pageIndex=1,typeof o=="string"&&o.length>1&&c(i),typeof o=="string"&&o.length===0&&c(i)},c=o=>{s(b(o)),s(j(o))},l=()=>{const o=h(a);o.query="",e.current&&(e.current.value=""),s(M({status:""})),c(o)};return t.jsxs("div",{className:"md:flex items-center justify-between",children:[t.jsxs("div",{className:"md:flex items-center gap-4",children:[t.jsx(B,{ref:e,onInputChange:r}),t.jsx(Me,{})]}),t.jsx("div",{className:"mb-4",children:t.jsx(T,{size:"sm",onClick:l,children:"Clear All"})})]})},k=s=>{const{icon:e,avatarClass:a,label:r,value:c,growthRate:l,loading:o}=s,i=55;return t.jsx(ge,{bordered:!0,children:t.jsx(Q,{loading:o,customLoader:t.jsx(fe,{avatarProps:{className:"rounded",width:i,height:i}}),children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx(z,{className:a,size:i,icon:e}),t.jsxs("div",{children:[t.jsx("span",{children:r}),t.jsx("h3",{children:t.jsx(he,{thousandSeparator:!0,displayType:"text",value:c})})]})]}),t.jsx(xe,{value:l,suffix:"%"})]})})})},$e=()=>{var r,c,l,o,i,g;const s=f(),e=d(p=>p.crmCustomers.data.statisticData),a=d(p=>p.crmCustomers.data.statisticLoading);return u.useEffect(()=>{s(L())},[]),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4 mb-6",children:[t.jsx(k,{icon:t.jsx(ce,{}),avatarClass:"!bg-indigo-600",label:"Total Customers",value:(r=e==null?void 0:e.totalCustomers)==null?void 0:r.value,growthRate:(c=e==null?void 0:e.totalCustomers)==null?void 0:c.growShrink,loading:a}),t.jsx(k,{icon:t.jsx(me,{}),avatarClass:"!bg-blue-500",label:"Active Customers",value:(l=e==null?void 0:e.activeCustomers)==null?void 0:l.value,growthRate:(o=e==null?void 0:e.activeCustomers)==null?void 0:o.growShrink,loading:a}),t.jsx(k,{icon:t.jsx(de,{}),avatarClass:"!bg-emerald-500",label:"New Customers",value:(i=e==null?void 0:e.newCustomers)==null?void 0:i.value,growthRate:(g=e==null?void 0:e.newCustomers)==null?void 0:g.growShrink,loading:a})]})};W("crmCustomers",ke);const qe=()=>t.jsxs(t.Fragment,{children:[t.jsx($e,{}),t.jsxs(X,{className:"h-full",bodyClass:"h-full",children:[t.jsx(Ye,{}),t.jsx(Re,{})]})]}),Zt=qe;export{Zt as default};
