import{j as e,r as l,a9 as T,a8 as E,aa as R}from"./index-O97KD1XJ.js";import{C as k}from"./Card-pE1gTaeJ.js";import{B as q}from"./Badge-_LYGoG9s.js";import{C as G}from"./Chart-wmlMHYNf.js";import{C as O,_ as J}from"./chart.constant-tkkK2XvD.js";import{B}from"./Button-n3c8cB2K.js";import{a as A}from"./Views-iRCRASdY.js";import{P as Q}from"./index-jA5814E-.js";import{u as Y,f as I,g as Z,a as ee,b as te}from"./index-MIIiIwpj.js";import{s as se,v as ae,F as oe}from"./index.esm-fVIXAgam.js";import{T as $}from"./index-rlKC0YRg.js";import"./chart.config-vcr98x1w.js";import"./index-kAodoiZN.js";import"./context-BS4LvZM6.js";const re=({data:a={labels:[],data:[],colors:[]}})=>e.jsx(k,{children:e.jsx("div",{className:"mt-6",children:a.data.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(G,{donutTitle:`${a.data.reduce((c,i)=>c+i,0)}`,donutText:"Cantidad de Talleres",series:a.data,customOptions:{labels:a.labels,colors:a.colors.length?a.colors:O},type:"donut"}),a.data.length===a.labels.length&&e.jsx("div",{className:"mt-6 grid grid-cols-2 gap-4 max-w-[180px] mx-auto",children:a.labels.map((c,i)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(q,{badgeStyle:{backgroundColor:a.colors[i]||O[i]}}),e.jsx("span",{className:"font-semibold",children:c})]},c))})]})})}),ne=()=>{const[a,c]=l.useState([]),[i,y]=l.useState([]),[r,u]=l.useState(0);return l.useEffect(()=>{(async()=>{try{const m=(await R(E(T,"Subscripciones"))).docs.map(s=>s.data()),w=new Date,f=new Date(w);f.setDate(w.getDate()-(w.getDay()+7*r)),new Date(f).setDate(f.getDate()+6);const F=s=>s.toISOString().split("T")[0],j=Array.from({length:7},(s,p)=>{const b=new Date(f);return b.setDate(f.getDate()+p),F(b)}),S={},C={};j.forEach(s=>{S[s]=0,C[s]=0}),m.forEach(s=>{const p=s.fechaCreacion?s.fechaCreacion.toDate().toISOString().split("T")[0]:void 0,b=s.fecha_inicio?s.fecha_inicio.toDate().toISOString().split("T")[0]:void 0;p&&S[p]!==void 0&&S[p]++,b&&s.comprobante_pago&&C[b]!==void 0&&C[b]++});const D=j.map(s=>S[s]),v=j.map(s=>C[s]);c([{name:"Subscripciones Diarias",data:D},{name:"Subscripciones Pagas",data:v}]),y(j)}catch(d){console.error("Error al obtener datos de subscripciones:",d)}})()},[r]),e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between"},children:[e.jsx(B,{onClick:()=>u(r+1),style:{backgroundColor:"#000B7E"},className:"text-white hover:opacity-80",children:"Semana Anterior"}),e.jsx(B,{onClick:()=>u(0),style:{backgroundColor:"#000B7E"},className:"text-white hover:opacity-80",children:"Semana Actual"}),e.jsx(B,{onClick:()=>u(r-1),style:{backgroundColor:"#000B7E"},className:"text-white hover:opacity-80",children:"Semana Siguiente"})]}),e.jsx(J,{options:{chart:{id:"spline-area-chart"},dataLabels:{enabled:!1},colors:O,stroke:{curve:"smooth"},xaxis:{type:"datetime",categories:i,labels:{formatter:function(x){const d=new Date(x);return new Intl.DateTimeFormat("es-ES",{day:"2-digit",month:"short",year:"numeric"}).format(d)}}},tooltip:{x:{format:"yyyy-MM-dd"}}},series:a,type:"area",height:300})]})},ce=async()=>{const a=await R(E(T,"Usuarios")),c=await R(E(T,"Subscripciones"));let i=0,y=0,r={aprobados:0,pendientes:0,rechazados:0,espera:0},u=0,x=0;return a.forEach(d=>{const m=d.data();if(m.typeUser==="Cliente"&&i++,m.typeUser==="Taller")switch(y++,m.status){case"Aprobado":r.aprobados++;break;case"Pendiente":r.pendientes++;break;case"Rechazado":r.rechazados++;break;case"En espera por aprobación":r.espera++;break}}),c.forEach(d=>{const m=d.data();x+=m.monto||0}),u=c.size,{clientesCount:i,tallerCount:y,talleresStats:r,subscripcionesCount:u,totalMonto:x}},ie=()=>{const[a,c]=l.useState({clientesCount:0,tallerCount:0,talleresStats:{aprobados:0,pendientes:0,rechazados:0,espera:0},subscripcionesCount:0,totalMonto:0});l.useEffect(()=>{(async()=>{try{const t=await ce();c(t)}catch(t){console.error("Error al obtener los datos del dashboard:",t)}})()},[]);const[i,y]=l.useState([]),r=async()=>{try{const o=await R(E(T,"Servicios")),t=[];await Promise.all(o.docs.map(async n=>{const N=n.data(),g=n.id,M=(await R(E(T,"Servicios",g,"calificaciones"))).docs.map(z=>({...z.data(),id:z.id}));t.push({nombre_servicio:N.nombre_servicio,taller:N.taller||"Sin taller",uid_servicio:g,calificaciones:M})}));const _=t.map(n=>{const N=n.calificaciones.reduce((P,M)=>P+(M.puntuacion??0),0),g=n.calificaciones.length>0?N/n.calificaciones.length:0;return{nombre_servicio:n.nombre_servicio,taller:n.taller,promedio_puntuacion:g}}).filter(n=>n.promedio_puntuacion>0);y(_)}catch(o){console.error("Error obteniendo los datos:",o)}};l.useEffect(()=>{r()},[]);const u=[{header:"Taller",accessorKey:"taller"},{header:"Servicio",accessorKey:"nombre_servicio"},{header:"Promedio de Calificación",cell:({row:o})=>{const t=o.original.promedio_puntuacion||0,_=5,n=Array.from({length:_},(N,g)=>{const P=g+1;return P<=t?e.jsx(se,{color:"gold",style:{marginRight:"2px"}},g):P-.5<=t?e.jsx(ae,{color:"gold",style:{marginRight:"2px"}},g):e.jsx(oe,{color:"gray",style:{marginRight:"2px"}},g)});return e.jsxs("div",{style:{display:"flex",gap:"2px",alignItems:"center"},children:[e.jsx("div",{style:{display:"flex"},children:n}),e.jsx("span",{style:{marginLeft:"8px"},children:t.toFixed(1)})," "]})}}],{Tr:x,Th:d,Td:m,THead:w,TBody:f,Sorter:H}=$,[F,j]=l.useState([]),[S,C]=l.useState([]),D=Y({data:i,columns:u,state:{sorting:F,columnFilters:S},onSortingChange:j,onColumnFiltersChange:C,getCoreRowModel:Z(),getSortedRowModel:ee(),getFilteredRowModel:te()}),[v,s]=l.useState(1),p=4,K=D.getRowModel().rows.length,W=o=>{console.log("onPaginationChange",o),s(o)},{clientesCount:L,tallerCount:le,talleresStats:h,subscripcionesCount:U,totalMonto:V}=a,X={labels:["Aprobados","Pendientes","Rechazados","En espera por aprobación"],data:[h.aprobados,h.pendientes,h.rechazados,h.espera],colors:["#15803D","#FFC107","#C22F1C","#2196F3"]};return e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsx("a",{href:`${A}/users`,className:"hover:shadow-lg ease-in-out p-4",children:e.jsxs(k,{className:"bg-gray-50 shadow",children:[e.jsx("h5",{className:"text-gray-500 text-base font-semibold",children:"Clientes"}),e.jsx("div",{className:"flex items-center justify-between mt-3",children:e.jsx("p",{className:"text-4xl font-bold text-gray-900",children:L})}),e.jsx("p",{className:"text-base text-gray-500 mt-2",children:"Total de clientes"})]})}),e.jsx("a",{href:`${A}/garages`,className:"hover:shadow-lg ease-in-out p-4",children:e.jsxs(k,{className:"bg-gray-50 shadow",children:[e.jsx("h5",{className:"text-gray-500 text-base font-semibold",children:"Talleres"}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsx("p",{className:"text-4xl font-bold text-gray-900",children:h.aprobados+h.pendientes+h.rechazados+h.espera}),e.jsxs("span",{className:"text-base font-semibold text-red-700 bg-red-100 px-3 py-1 rounded-full",children:[h.espera," en espera"]})]}),e.jsx("p",{className:"text-base text-gray-500 mt-2",children:"Total Talleres"})]})}),e.jsx("a",{href:`${A}/subscriptions`,className:"hover:shadow-lg ease-in-out p-4",children:e.jsxs(k,{className:"bg-gray-50 shadow",children:[e.jsx("h5",{className:"text-gray-500 text-base font-semibold",children:"Subscripciones"}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsx("p",{className:"text-4xl font-bold text-gray-900",children:U}),e.jsxs("span",{className:"text-base font-semibold text-green-700 bg-green-100 px-3 py-1 rounded-full",children:["$",V.toFixed(2)," Total"]})]}),e.jsx("p",{className:"text-base text-gray-500 mt-2",children:"Subscripciones y monto total"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mt-6",children:[e.jsx(ne,{}),e.jsx(re,{data:X})]}),e.jsxs("div",{className:"p-1 rounded-lg shadow",children:[e.jsx("h2",{className:"mb-4",children:"Calificaciones de los Servicios"}),e.jsxs($,{className:"w-full rounded-lg",children:[e.jsx(w,{children:D.getHeaderGroups().map(o=>e.jsx(x,{children:o.headers.map(t=>e.jsx(d,{colSpan:t.colSpan,children:t.isPlaceholder?null:e.jsx("div",{className:t.column.getCanSort()?"cursor-pointer select-none":"",onClick:t.column.getToggleSortingHandler(),children:I(t.column.columnDef.header,t.getContext())})},t.id))},o.id))}),e.jsx(f,{children:D.getRowModel().rows.slice((v-1)*p,v*p).map(o=>e.jsx(x,{children:o.getVisibleCells().map(t=>e.jsx(m,{children:I(t.column.columnDef.cell,t.getContext())},t.id))},o.id))})]}),e.jsx(Q,{onChange:W,currentPage:v,totalRows:K,rowsPerPage:p})]})]})},De=ie;export{De as default};
