import{a0 as P,a1 as ee,a2 as se,a3 as te,a as f,r as h,j as e,au as S,a4 as ae,c as re,a5 as oe,b2 as ie,T as le}from"./index-50rgKX9S.js";import{A as ne}from"./AdaptableCard-LFMvjwtD.js";import{C as ce,i as E}from"./Views-A7x8nqpb.js";import{D as de}from"./DoubleSidedImage-KmoSWStK.js";import{C as z}from"./Card-vqKpG-UA.js";import{A as Y}from"./index-_GS3LEUB.js";import{B as u}from"./Button-xRLYDkxn.js";import{t as me,N as ue}from"./toast-X0ZD5_pK.js";import{C as O}from"./ConfirmDialog-qhUioY7a.js";import{x as pe,y as xe,z as he,A as ge}from"./index.esm-BzTP7NzC.js";import{S as fe,ao as V,ap as je}from"./index.esm-CTp4r0U4.js";import{f as Ce,g as De,e as ye}from"./CrmService-z4pbjIpN.js";import{D as be}from"./Drawer-o2AIGSQ4.js";import{C as Ne}from"./CustomerForm-vH8kldrC.js";import{c as w}from"./cloneDeep-5XeEZjui.js";import{T as q}from"./index-X3G8Yg8B.js";import{B as ve}from"./Badge-R0b3axTj.js";import{d as Me,u as Pe,g as Se,a as we,f as F}from"./index-CcDhNinj.js";import{N as $}from"./react-number-format.es-56BQjFH8.js";import{T as B}from"./Tag-BtOgoHK3.js";import{I as ke}from"./Input--puSdvxq.js";import{D as Ee}from"./Dialog-Z-1LJbm8.js";import{F as Fe,a as j}from"./FormItem-tcv8UMxq.js";import{F as Ie,a as He,b as y}from"./formik.esm-Y7Bmnko2.js";import{F as Te}from"./FormCustomFormatInput-XSlatxfl.js";import{F as I}from"./FormPatternInput-5XLYJNqg.js";import{c as Re,a as b}from"./index.esm-1NCRVz3q.js";import{i as Ae}from"./isLastChild-6BXlVJ47.js";import"./useMergeRef-Rt_Crb27.js";import"./Tooltip-GIYbDsiP.js";import"./index.esm-opZQsgq7.js";import"./floating-ui.react-bRmrURkd.js";import"./floating-ui.dom-0rLBacrf.js";import"./index-oREErx12.js";import"./motion-QExVqk61.js";import"./context-S2-woICp.js";import"./useTimeout-wgPWIlQI.js";import"./CloseButton-NICPh_Cl.js";import"./StatusIcon-HZtVKaUR.js";import"./chainedFunction-ltcSYACe.js";import"./ApiService-5KN9i4Cg.js";import"./index-E7L2uv60.js";import"./index-q4uYtSHq.js";import"./index-vTIpNX8M.js";import"./useControllableState-DOzhx4PK.js";import"./index-v66BEvdr.js";import"./Calendar-3cZ-sm7M.js";import"./RangeCalendar-X9TLkpWI.js";import"./TimeInput-yjgONFtu.js";import"./useUniqueId-ShSZumYL.js";import"./toString-6lQZz3FR.js";import"./useDidUpdate-12688dYZ.js";import"./Upload-J1c4aH1-.js";import"./index.esm-oiqqRY0R.js";import"./_getAllKeys-1s2zq0dU.js";import"./_MapCache-2XbJC0-4.js";import"./isNil-tsmo4mGH.js";import"./get-werKe3PL.js";const N="crmCustomerDetails",M=P(N+"/getCustomer",async s=>(await Ce(s)).data),ze=P(N+"/deleteCustomer",async s=>(await De(s)).data),Ye=P(N+"/putCustomer",async s=>(await ye(s)).data),Oe={loading:!0,profileData:{},subscriptionData:[],paymentHistoryData:[],paymentMethodData:[],deletePaymentMethodDialog:!1,editPaymentMethodDialog:!1,editCustomerDetailDialog:!1,selectedCard:{}},L=ee({name:`${N}/state`,initialState:Oe,reducers:{updatePaymentMethodData:(s,t)=>{s.paymentMethodData=t.payload},updateProfileData:(s,t)=>{s.profileData=t.payload},openDeletePaymentMethodDialog:s=>{s.deletePaymentMethodDialog=!0},closeDeletePaymentMethodDialog:s=>{s.deletePaymentMethodDialog=!1},openEditPaymentMethodDialog:s=>{s.editPaymentMethodDialog=!0},closeEditPaymentMethodDialog:s=>{s.editPaymentMethodDialog=!1},openEditCustomerDetailDialog:s=>{s.editCustomerDetailDialog=!0},closeEditCustomerDetailDialog:s=>{s.editCustomerDetailDialog=!1},updateSelectedCard:(s,t)=>{s.selectedCard=t.payload}},extraReducers:s=>{s.addCase(M.fulfilled,(t,i)=>{var l,a,r;t.loading=!1,t.profileData=i.payload,t.subscriptionData=((l=i.payload)==null?void 0:l.subscription)||[],t.paymentHistoryData=((a=i.payload)==null?void 0:a.orderHistory)||[],t.paymentMethodData=((r=i.payload)==null?void 0:r.paymentMethod)||[]}).addCase(M.pending,t=>{t.loading=!0})}}),{updatePaymentMethodData:J,updateProfileData:Ve,openDeletePaymentMethodDialog:qe,closeDeletePaymentMethodDialog:H,openEditPaymentMethodDialog:$e,closeEditPaymentMethodDialog:Be,openEditCustomerDetailDialog:Le,closeEditCustomerDetailDialog:Je,updateSelectedCard:T}=L.actions,Ue=L.reducer,Ge=se({data:Ue}),m=te,Qe=({onSaveClick:s,onCancel:t})=>e.jsxs("div",{className:"text-right w-full",children:[e.jsx(u,{size:"sm",className:"mr-2",onClick:t,children:"Cancel"}),e.jsx(u,{size:"sm",variant:"solid",onClick:s,children:"Save"})]}),_e=()=>{const s=f(),t=h.useRef(null),i=m(o=>o.crmCustomerDetails.data.editCustomerDetailDialog),l=m(o=>o.crmCustomerDetails.data.profileData),a=()=>{s(Je())},r=()=>{var o;(o=t.current)==null||o.submitForm()},c=o=>{const n=w(l),{name:p,birthday:d,email:x,img:v,location:g,title:U,phoneNumber:G,facebook:Q,twitter:_,pinterest:K,linkedIn:W}=o,X={name:p,email:x,img:v},Z={location:g,title:U,birthday:S(d).format("DD/MM/YYYY"),phoneNumber:G,facebook:Q,twitter:_,pinterest:K,linkedIn:W};n.personalInfo={...n.personalInfo,...Z};const k={...n,...X};s(Ve(k)),s(Ye(k)),a()};return e.jsx(be,{isOpen:i,closable:!1,bodyClass:"p-0",footer:e.jsx(Qe,{onCancel:a,onSaveClick:r}),onClose:a,onRequestClose:a,children:e.jsx(Ne,{ref:t,customer:l,onFormSubmit:c})})},C=({title:s,value:t})=>e.jsxs("div",{children:[e.jsx("span",{children:s}),e.jsx("p",{className:"text-gray-700 dark:text-gray-200 font-semibold",children:t})]}),Ke=({id:s})=>{const t=f(),[i,l]=h.useState(!1),a=ae(),r=()=>{l(!1)},c=()=>{l(!0)},o=()=>{l(!1),s&&t(ze({id:s})),a("/app/crm/customers"),me.push(e.jsx(ue,{title:"Successfuly Deleted",type:"success",children:"Customer successfuly deleted"}))},n=()=>{t(Le())};return e.jsxs(e.Fragment,{children:[e.jsx(u,{block:!0,icon:e.jsx(fe,{}),onClick:c,children:"Delete"}),e.jsx(u,{block:!0,icon:e.jsx(V,{}),variant:"solid",onClick:n,children:"Edit"}),e.jsx(O,{isOpen:i,type:"danger",title:"Delete customer",confirmButtonColor:"red-600",onClose:r,onRequestClose:r,onCancel:r,onConfirm:o,children:e.jsx("p",{children:"Are you sure you want to delete this customer? All record related to this customer will be deleted as well. This action cannot be undone."})}),e.jsx(_e,{})]})},We=({data:s={}})=>{var t,i,l,a;return e.jsx(z,{children:e.jsxs("div",{className:"flex flex-col xl:justify-between h-full 2xl:min-w-[360px] mx-auto",children:[e.jsxs("div",{className:"flex xl:flex-col items-center gap-4",children:[e.jsx(Y,{size:90,shape:"circle",src:s.img}),e.jsx("h4",{className:"font-bold",children:s.name})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-1 gap-y-7 gap-x-4 mt-8",children:[e.jsx(C,{title:"Email",value:s.email}),e.jsx(C,{title:"Phone",value:(t=s.personalInfo)==null?void 0:t.phoneNumber}),e.jsx(C,{title:"Location",value:(i=s.personalInfo)==null?void 0:i.location}),e.jsx(C,{title:"Date of birth",value:(l=s.personalInfo)==null?void 0:l.birthday}),e.jsx(C,{title:"Title",value:(a=s.personalInfo)==null?void 0:a.title}),e.jsxs("div",{className:"mb-7",children:[e.jsx("span",{children:"Social"}),e.jsxs("div",{className:"flex mt-4",children:[e.jsx(u,{className:"mr-2",shape:"circle",size:"sm",icon:e.jsx(pe,{className:"text-[#1773ea]"})}),e.jsx(u,{className:"mr-2",shape:"circle",size:"sm",icon:e.jsx(xe,{className:"text-[#1da1f3]"})}),e.jsx(u,{className:"mr-2",shape:"circle",size:"sm",icon:e.jsx(he,{className:"text-[#0077b5]"})}),e.jsx(u,{className:"mr-2",shape:"circle",size:"sm",icon:e.jsx(ge,{className:"text-[#df0018]"})})]})]})]}),e.jsx("div",{className:"mt-4 flex flex-col xl:flex-row gap-2",children:e.jsx(Ke,{id:s.id})})]})})},{Tr:R,Th:Xe,Td:Ze,THead:es,TBody:ss,Sorter:ts}=q,as={paid:"bg-emerald-500",pending:"bg-amber-400"},D=Me(),rs=[D.accessor("id",{header:"Reference",cell:s=>{const t=s.row.original;return e.jsx("div",{children:e.jsx("span",{className:"cursor-pointer",children:t.id})})}}),D.accessor("item",{header:"Product"}),D.accessor("status",{header:"Status",cell:s=>{const t=s.row.original;return e.jsxs("div",{className:"flex items-center",children:[e.jsx(ve,{className:as[t.status]}),e.jsx("span",{className:"ml-2 rtl:mr-2 capitalize",children:t.status})]})}}),D.accessor("date",{header:"Date",cell:s=>{const t=s.row.original;return e.jsx("div",{className:"flex items-center",children:S.unix(t.date).format("MM/DD/YYYY")})}}),D.accessor("amount",{header:"Amount",cell:s=>{const t=s.row.original;return e.jsx("div",{className:"flex items-center",children:e.jsx($,{displayType:"text",value:(Math.round(t.amount*100)/100).toFixed(2),prefix:"$",thousandSeparator:!0})})}})],os=()=>{const s=m(a=>a.crmCustomerDetails.data.paymentHistoryData),[t,i]=h.useState([]),l=Pe({data:s,columns:rs,state:{sorting:t},onSortingChange:i,getCoreRowModel:Se(),getSortedRowModel:we()});return e.jsxs("div",{className:"mb-8",children:[e.jsx("h6",{className:"mb-4",children:"Payment History"}),e.jsxs(q,{children:[e.jsx(es,{children:l.getHeaderGroups().map(a=>e.jsx(R,{children:a.headers.map(r=>e.jsx(Xe,{colSpan:r.colSpan,children:r.isPlaceholder?null:e.jsxs("div",{className:r.column.getCanSort()?"cursor-pointer select-none":"",onClick:r.column.getToggleSortingHandler(),children:[F(r.column.columnDef.header,r.getContext()),e.jsx(ts,{sort:r.column.getIsSorted()})]})},r.id))},a.id))}),e.jsx(ss,{children:l.getRowModel().rows.slice(0,10).map(a=>e.jsx(R,{children:a.getVisibleCells().map(r=>e.jsx(Ze,{children:F(r.column.columnDef.cell,r.getContext())},r.id))},a.id))})]})]})},is=()=>{const[s,t]=h.useState(!0),i=m(r=>r.crmCustomerDetails.data.subscriptionData),l=h.useCallback(()=>{t(!1)},[]),a=h.useCallback(()=>{t(!0)},[]);return e.jsxs("div",{className:"mb-8",children:[e.jsx("h6",{className:"mb-4",children:"Subscription"}),i.map(r=>e.jsx(z,{bordered:!0,className:"mb-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{children:e.jsx(Y,{className:"bg-emerald-500",shape:"circle",icon:e.jsx(je,{})})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("h6",{children:r.plan}),e.jsx(B,{className:"bg-emerald-100 text-emerald-600 dark:bg-emerald-500/20 dark:text-emerald-100 rounded-md border-0 mx-2",children:e.jsx("span",{className:"capitalize",children:r.status})})]}),e.jsxs("div",{children:[e.jsxs("span",{children:["Billing ",r.billing]}),e.jsx("span",{children:" | "}),e.jsxs("span",{children:["Next payment on"," ",S.unix(r.nextPaymentDate).format("MM/DD/YYYY")]}),e.jsxs("span",{children:[e.jsx("span",{className:"mx-1",children:"for"}),e.jsx($,{className:"font-semibold text-gray-900 dark:text-gray-100",displayType:"text",value:(Math.round(r.amount*100)/100).toFixed(2),prefix:"$",thousandSeparator:!0})]})]})]})]}),e.jsxs("div",{className:"flex",children:[s&&e.jsx(u,{size:"sm",variant:"plain",onClick:l,children:"Cancel plan"}),e.jsxs(u,{size:"sm",className:"ml-2 rtl:mr-2",onClick:a,children:[s?"Update":"Subscribe"," Plan"]})]})]})},r.plan))]})},ls=Re().shape({cardHolderName:b().required("Card holder name required"),ccNumber:b().required("Credit card number required").matches(/^(?:4[0-9]{12}(?:[0-9]{3})?|[25][1-7][0-9]{14}|6(?:011|5[0-9][0-9])[0-9]{12}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|(?:2131|1800|35\d{3})\d{11})$/,"Invalid credit card number"),cardExpiry:b().required("Card holder name required").matches(/^(0[1-9]|1[0-2])\/?([0-9]{4}|[0-9]{2})$/,"Invalid Date"),code:b().required().matches(/^[0-9]{3}$/,"Invalid CVV")});function A(s,t){return s.length===1&&s[0]>t[0]&&(s="0"+s),s.length===2&&(Number(s)===0?s="01":s>t&&(s=t)),s}function ns(s){const t=A(s.substring(0,2),"12"),i=A(s.substring(2,4),"31");return t+(i.length?"/"+i:"")}const cs=()=>{const s=f(),t=m(o=>o.crmCustomerDetails.data.selectedCard),i=m(o=>o.crmCustomerDetails.data.paymentMethodData),l=m(o=>o.crmCustomerDetails.data.editPaymentMethodDialog),a=m(o=>o.crmCustomerDetails.data.selectedCard),r=o=>{let n=w(i)||[];const{cardHolderName:p,ccNumber:d,cardExpiry:x}=o,v={cardHolderName:p,last4Number:d.substr(d.length-4),expYear:x.substr(x.length-2),expMonth:x.substring(0,2)};n=n.map(g=>(g.last4Number===a.last4Number&&(g={...g,...v}),g)),c(),s(J(n))},c=()=>{s(Be())};return e.jsxs(Ee,{isOpen:l,onClose:c,onRequestClose:c,children:[e.jsx("h4",{children:"Edit Credit Card"}),e.jsx("div",{className:"mt-6",children:e.jsx(Ie,{initialValues:{cardHolderName:t.cardHolderName||"",ccNumber:"",cardExpiry:(t==null?void 0:t.expMonth)+t.expYear||"",code:""},validationSchema:ls,onSubmit:(o,{setSubmitting:n})=>{r(o),n(!1)},children:({touched:o,errors:n})=>e.jsx(He,{children:e.jsxs(Fe,{children:[e.jsx(j,{label:"Card holder name",invalid:n.cardHolderName&&o.cardHolderName,errorMessage:n.cardHolderName,children:e.jsx(y,{type:"text",autoComplete:"off",name:"cardHolderName",component:ke})}),e.jsx(j,{label:"Credit Card Number",invalid:n.ccNumber&&o.ccNumber,errorMessage:n.ccNumber,children:e.jsx(y,{name:"ccNumber",children:({field:p,form:d})=>e.jsx(I,{form:d,field:p,placeholder:"•••• •••• •••• ••••",format:"#### #### #### ####",onValueChange:x=>{d.setFieldValue(p.name,x.value)}})})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(j,{label:"Expiration date",invalid:n.cardExpiry&&o.cardExpiry,errorMessage:n.cardExpiry,children:e.jsx(y,{name:"cardExpiry",children:({field:p,form:d})=>e.jsx(Te,{form:d,field:p,placeholder:"••/••",format:ns,defaultValue:d.values.cardExpiry,onValueChange:x=>{d.setFieldValue(p.name,x.value)}})})}),e.jsx(j,{label:"CVV",invalid:n.code&&o.code,errorMessage:n.code,children:e.jsx(y,{name:"code",children:({field:p,form:d})=>e.jsx(I,{form:d,field:p,placeholder:"•••",format:"###",onValueChange:x=>{d.setFieldValue(p.name,x.value)}})})})]}),e.jsx(j,{className:"mb-0 text-right",children:e.jsx(u,{block:!0,variant:"solid",type:"submit",children:"Update"})})]})})})})]})},ds=()=>{const s=f(),t=m(c=>c.crmCustomerDetails.data.paymentMethodData),i=m(c=>c.crmCustomerDetails.data.deletePaymentMethodDialog),l=m(c=>c.crmCustomerDetails.data.selectedCard),a=()=>{let c=w(t)||[];c=c.filter(o=>o.last4Number!==l.last4Number),s(H()),s(J(c))},r=()=>{s(H())};return e.jsx(O,{isOpen:i,type:"danger",title:"Remove payment method",confirmButtonColor:"red-600",onClose:r,onRequestClose:r,onCancel:r,onConfirm:a,children:e.jsx("p",{children:" Are you sure you want to remove this payment method? "})})},ms=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],us=()=>{const s=f(),t=m(a=>a.crmCustomerDetails.data.paymentMethodData),i=a=>{s(T(a)),s($e())},l=a=>{s(T(a)),s(qe())};return e.jsxs(e.Fragment,{children:[t.length>0&&e.jsxs("div",{children:[e.jsx("h6",{className:"mb-4",children:"Payment Methods"}),e.jsx("div",{className:"rounded-lg border border-gray-200 dark:border-gray-600",children:t.map((a,r)=>e.jsxs("div",{className:re("flex flex-col lg:flex-row lg:items-center justify-between gap-3 p-4",!Ae(t,r)&&"border-b border-gray-200 dark:border-gray-600"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[a.cardType==="VISA"&&e.jsx("img",{src:"/img/others/img-8.png",alt:"visa"}),a.cardType==="MASTER"&&e.jsx("img",{src:"/img/others/img-9.png",alt:"master"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"text-gray-900 dark:text-gray-100 font-semibold",children:[a.cardHolderName," ••••"," ",a.last4Number]}),a.primary&&e.jsx(B,{className:"bg-sky-100 text-sky-600 dark:bg-sky-500/20 dark:text-sky-100 rounded-md border-0 mx-2",children:e.jsxs("span",{className:"capitalize",children:[" ","Primary"," "]})})]}),e.jsxs("span",{children:["Expired"," ",ms[parseInt(a.expMonth)-1]," ","20",a.expYear]})]})]}),e.jsxs("div",{className:"flex",children:[e.jsx(u,{className:"mr-2 rtl:ml-2",variant:"plain",size:"sm",onClick:()=>l(a),children:"Delete"}),e.jsx(u,{icon:e.jsx(V,{}),size:"sm",onClick:()=>i(a),children:"Edit"})]})]},a.last4Number))})]}),e.jsx(cs,{}),e.jsx(ds,{})]})};oe("crmCustomerDetails",Ge);const ps=()=>{const s=f(),t=ie(),i=m(r=>r.crmCustomerDetails.data.profileData),l=m(r=>r.crmCustomerDetails.data.loading);h.useEffect(()=>{a()},[]);const a=()=>{const r=t.get("id");r&&s(M({id:r}))};return e.jsxs(ce,{className:"h-full",children:[e.jsx(le,{loading:l,children:!E(i)&&e.jsxs("div",{className:"flex flex-col xl:flex-row gap-4",children:[e.jsx("div",{children:e.jsx(We,{data:i})}),e.jsx("div",{className:"w-full",children:e.jsxs(ne,{children:[e.jsx(is,{}),e.jsx(os,{}),e.jsx(us,{})]})})]})}),!l&&E(i)&&e.jsxs("div",{className:"h-full flex flex-col items-center justify-center",children:[e.jsx(de,{src:"/img/others/img-2.png",darkModeSrc:"/img/others/img-2-dark.png",alt:"No user found!"}),e.jsx("h3",{className:"mt-8",children:"No user found!"})]})]})},jt=ps;export{jt as default};
