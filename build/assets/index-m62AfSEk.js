import{r as i,j as e,an as m,a7 as ge,a8 as be,a9 as p,aa as he,ap as xe,ag as h,af as y}from"./index-iN9gC56E.js";import{P as fe}from"./index-xABk_TlO.js";import{T as V}from"./index-r5HDIMlV.js";import{u as je,f as q,g as ye,a as ve,b as Ne}from"./index-8HUqQ9E-.js";import{h as _e,j as De,k as Ce,l as we}from"./index.esm-PsQ9NYiK.js";import{B as O}from"./Button-GMmR06Qd.js";import{t as c,N as d}from"./toast-HJ8K8y0z.js";import"./Alert-LlceXwYL.js";import"./index-Fydigyd4.js";import"./Badge-vvlEJWRb.js";import"./Calendar-hhufCyb5.js";import"./Card-UeUwmQGm.js";import"./index-IAmspJ9h.js";import"./index-VZr96vPs.js";import{D as Se}from"./Dialog-SHzepYae.js";import{D as Fe}from"./Drawer-8GaBA5L4.js";import"./index-vqYIuH0r.js";import"./FormItem-V-RELuuV.js";import"./Input-R6rTBLWw.js";import"./index-vs4f0Vpa.js";import"./index-b7aa8jZD.js";import"./index-PT_GBNge.js";import"./Progress-dcTLE2Rf.js";import"./index-eEe_2u56.js";import"./RangeCalendar-ywpVpjXC.js";import"./ScrollBar-zRlLtpFG.js";import"./index-yruqur_y.js";import"./Select-zgc7IBVd.js";import"./Skeleton-cGbYy1OS.js";import"./index-bVzFXgEv.js";import{S as Te}from"./Switcher-ecGn0LbT.js";import"./index-PmJD9w6w.js";import"./Tag-bE0W86aB.js";import"./index-FfRD292H.js";import"./index-1VCW4Tc_.js";import"./Tooltip-LTk8tIBU.js";import"./Upload-Imtp3r6n.js";import{O as Ee,D as Oe}from"./index.esm-G_R2Qahq.js";import{u as k,w as ke}from"./xlsx-b-y62sF7.js";import"./context-sXqbsmVT.js";import"./useTimeout-MHc2JTpQ.js";import"./CloseButton-zzyKko4s.js";import"./StatusIcon-6rTTjLCc.js";import"./chainedFunction-ltcSYACe.js";import"./motion-VuSiHn-Z.js";import"./useMergeRef-Rt_Crb27.js";import"./useControllableState-lu9_zM1n.js";import"./cloneDeep-_gU2iCJo.js";import"./_getAllKeys-ApDm4Tf9.js";import"./_MapCache-4mJOcdK2.js";import"./Views-fqLBZTLn.js";import"./_baseIsEqual-fjp1tii0.js";import"./get-inEoy5Zc.js";import"./toString-bt5ytiDl.js";import"./floating-ui.react-238fQh4A.js";import"./floating-ui.dom-0rLBacrf.js";import"./TimeInput-XUWaHv6c.js";import"./useUniqueId-XYO99xE6.js";import"./useDidUpdate-jFUEdr0C.js";import"./index-TjZOp8Le.js";import"./index-q_0ZF6Cq.js";import"./useRootClose-gdfvYoB1.js";import"./isNil-SNmDFRvm.js";import"./index-snVep3pU.js";import"./toConsumableArray-YYxflNc8.js";import"./objectWithoutPropertiesLoose-pdUxmcoj.js";import"./setPrototypeOf-ahVgEFUp.js";import"./mapCloneElement-AQOGZkYh.js";import"./index.esm-qnYcV-k-.js";import"./index.esm-0_6ypcHy.js";const Re=()=>{const[R,P]=i.useState([]),[$,v]=i.useState([]),[G,I]=i.useState(!1),[M,J]=i.useState("nombre"),[N,Q]=i.useState(""),[a,_]=i.useState(null),[W,x]=i.useState(!1),[D,B]=i.useState(""),[C,H]=i.useState(""),f=async()=>{const o=ge(be(p,"Subscripciones")),n=(await he(o)).docs.map(async u=>{const g=u.data();let j="Taller no encontrado",b="Correo no encontrado";if(g.taller_uid){const s=await xe(h(p,"Usuarios",g.taller_uid));if(s.exists()){const r=s.data();j=r.nombre||"Taller no encontrado",b=r.email||"Correo no encontrado"}}return{...g,uid:u.id,nombre_taller:j,correo_taller:b}}),l=await Promise.all(n);console.log("Data de suscripciones:",l),P(l)};i.useEffect(()=>{f()},[]);const X=async()=>{await f(),c.push(e.jsx(d,{title:"Datos actualizados",children:"La tabla ha sido actualizada con éxito."}))},Y=()=>{I(!0)},w=()=>{I(!1),B(""),H("")},Z=o=>{_(o),x(!0)},ee=async()=>{if(a)try{let o;if(a.status==="Por Aprobar"){o={status:a.status,fecha_inicio:null,fecha_fin:null,monto:a.monto??"",nombre:a.nombre,vigencia:a.vigencia},await y(h(p,"Subscripciones",a.uid),o),a.taller_uid&&await y(h(p,"Usuarios",a.taller_uid),{subscripcion_actual:o}),c.push(e.jsx(d,{title:"Éxito",children:"Subscripción actualizada con éxito."})),x(!1),f();return}const t=new Date,n=parseInt(a.vigencia,10);if(isNaN(n)){c.push(e.jsx(d,{title:"Error",children:"La vigencia proporcionada no es válida."}));return}const l=new Date(t);l.setDate(t.getDate()+n),o={nombre:a.nombre,vigencia:a.vigencia,fecha_inicio:m.fromDate(t),fecha_fin:m.fromDate(l),status:a.status,cantidad_servicios:a.cantidad_servicios,monto:a.monto},await y(h(p,"Subscripciones",a.uid),o),a.taller_uid&&await y(h(p,"Usuarios",a.taller_uid),{subscripcion_actual:o}),c.push(e.jsx(d,{title:"Éxito",children:"Subscripción actualizada con éxito."})),x(!1),f()}catch(o){console.error("Error actualizando la subscripción:",o),c.push(e.jsx(d,{title:"Error",children:"Hubo un error al actualizar la subscripción."}))}},S=o=>o instanceof m?o.toDate().toLocaleDateString("es-ES"):"-",{Tr:A,Th:ae,Td:oe,THead:te,TBody:re,Sorter:Ie}=V,se=o=>{console.log("Drawer cerrado",o),x(!1),_(null)},[K,ne]=i.useState(1),F=6,le=o=>{console.log("onPaginationChange",o),ne(o)},z=(K-1)*F,ie=z+F,ce=o=>{const t=o.target.value;Q(t),v([{id:M,value:t}])},de=o=>{const t=o.target.value;J(t),N!==""&&v([{id:t,value:N}])},me=()=>{if(!D||!C){c.push(e.jsx(d,{title:"Fechas incompletas",children:"Por favor, selecciona ambas fechas para continuar."}));return}const o=new Date(D);o.setUTCHours(0,0,0,0);const t=new Date(C);t.setUTCHours(23,59,59,999),console.log({startDate:o,endDate:t});const n=["nombre","nombre_taller","cantidad_servicios","monto","fecha_inicio","fecha_fin","status"],l={nombre:"Nombre Cliente",nombre_taller:"Nombre Taller",cantidad_servicios:"Cantidad de Servicios",monto:"Monto Total",fecha_inicio:"Fecha de Inicio",fecha_fin:"Fecha de Fin",status:"Estado"},u=R.filter(s=>{const r=s.fecha_inicio instanceof m?s.fecha_inicio.toDate():new Date(s.fecha_inicio);return!(r instanceof Date)||isNaN(r.getTime())?!1:(console.log("Fecha Inicio:",r,"Inicio Range:",o,"End Range:",t),r.getTime()>=o.getTime()&&r.getTime()<=t.getTime())});if(u.length===0){c.push(e.jsx(d,{title:"Sin datos para exportar",children:"No hay datos disponibles en el rango de fechas seleccionado."}));return}const g=u.map(s=>{const r={};return n.forEach(T=>{const E=s[T],ue=l[T]||T;r[ue]=E instanceof m?E.toDate().toISOString().split("T")[0]:E??""}),s.comprobante_pago&&(r["Método Comprobante"]=s.comprobante_pago.metodo||"",r["Banco Origen"]=s.comprobante_pago.bancoOrigen||"",r["Banco Destino"]=s.comprobante_pago.bancoDestino||"",r.Cédula=s.comprobante_pago.cedula||"",r["Teléfono Comprobante"]=s.comprobante_pago.telefono||"",r.Monto=s.comprobante_pago.monto||"",r.Recibo=s.comprobante_pago.receiptFile||"",r["Número Referencia"]=s.comprobante_pago.numReferencia||"",r["Fecha Pago"]=s.comprobante_pago.fechaPago?S(s.comprobante_pago.fechaPago):"-",r["Correo Comprobante"]=s.comprobante_pago.correo||""),r}),j=k.json_to_sheet(g),b=k.book_new();k.book_append_sheet(b,j,"Subscripciones"),ke(b,"subscripciones.xlsx"),c.push(e.jsx(d,{title:"Exportación exitosa",children:"El archivo Excel se ha descargado correctamente."})),w()},L=je({data:R,columns:[{header:"Plan",accessorKey:"nombre"},{header:"Taller Subscrito",accessorKey:"nombre_taller"},{header:"Correo Taller",accessorKey:"correo_taller"},{header:"Cantidad de Servicios",accessorKey:"cantidad_servicios"},{header:"Monto",accessorKey:"monto"},{header:"Fecha de Aprobacion",accessorKey:"fecha_inicio",cell:({row:o})=>{const t=o.original.fecha_inicio;return t?S(t):"-"}},{header:"Vigente Hasta",accessorKey:"fecha_fin",cell:({row:o})=>{const t=o.original.fecha_fin;return t?S(t):"-"}},{header:"Estado",accessorKey:"status",cell:({row:o})=>{const t=o.getValue("status");let n,l;switch(t){case"Aprobado":n=e.jsx(we,{className:"text-green-500 mr-1"}),l="text-green-500";break;case"Vencido":n=e.jsx(Ce,{className:"text-red-500 mr-1"}),l="text-red-500";break;case"Por Aprobar":n=e.jsx(De,{className:"text-yellow-500 mr-1"}),l="text-yellow-500";break;default:n=null}return e.jsxs("div",{className:`flex items-center ${l}`,children:[n,e.jsx("span",{children:t})]})}},{header:" ",cell:({row:o})=>{const t=o.original;return t.status!=="Vencido"&&t.comprobante_pago?e.jsx("div",{className:"gap-2",children:e.jsx("button",{onClick:()=>Z(t),className:"text-blue-900",children:e.jsx(_e,{})})}):null}}],state:{columnFilters:$},onColumnFiltersChange:v,getCoreRowModel:ye(),getSortedRowModel:ve(),getFilteredRowModel:Ne()}),U=L.getRowModel().rows,pe=U.length;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsxs("h1",{className:"mb-6 flex justify-start items-center space-x-4",children:[e.jsx("span",{className:"text-[#000B7E]",children:"Subscripciones"}),e.jsx("button",{className:"p-2 bg-slate-100 hover:bg-slate-200 active:bg-slate-300 transition-all duration-200 shadow-md transform hover:scale-105 rounded-md",onClick:X,children:e.jsx(Ee,{className:"w-5 h-5 text-gray-700 hover:text-blue-500 transition-colors duration-200"})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"relative w-24",children:e.jsxs("select",{className:"h-10 w-full py-2 px-4 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:de,value:M,children:[e.jsx("option",{value:"",disabled:!0,children:"Seleccionar columna..."}),e.jsx("option",{value:"nombre",children:"Plan"}),e.jsx("option",{value:"nombre_taller",children:"Taller"}),e.jsx("option",{value:"status",children:"Estado"})]})}),e.jsxs("div",{className:"relative w-80 ml-4",children:[e.jsx("input",{type:"text",placeholder:"Buscar...",className:"w-full py-2 px-4 pl-10 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 h-10",value:N,onChange:ce}),e.jsx(Oe,{className:"absolute left-3 top-5 transform -translate-y-1/2 text-gray-500 w-5 h-5"})]}),e.jsx("button",{style:{backgroundColor:"#000B7E"},className:"p-2 ml-4 bg-blue-500 text-white rounded-md shadow-md hover:bg-blue-600 active:bg-blue-700 transition duration-200 hover:opacity-80",onClick:Y,children:"Exportar a Excel"})]})})]}),e.jsxs("div",{className:"p-1 rounded-lg shadow",children:[e.jsxs(V,{className:"w-full  rounded-lg",children:[e.jsx(te,{children:L.getHeaderGroups().map(o=>e.jsx(A,{children:o.headers.map(t=>e.jsx(ae,{colSpan:t.colSpan,children:t.isPlaceholder?null:e.jsx("div",{className:t.column.getCanSort()?"cursor-pointer select-none":"",onClick:t.column.getToggleSortingHandler(),children:q(t.column.columnDef.header,t.getContext())})},t.id))},o.id))}),e.jsx(re,{children:U.slice(z,ie).map(o=>e.jsx(A,{children:o.getVisibleCells().map(t=>e.jsx(oe,{children:q(t.column.columnDef.cell,t.getContext())},t.id))},o.id))})]}),e.jsx(fe,{onChange:le,currentPage:K,totalRows:pe,rowsPerPage:F})]}),e.jsxs(Fe,{isOpen:W,onClose:se,className:"rounded-md shadow",children:[e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsx("h2",{className:"flex mb-4 text-xl font-bold",children:"Revisión de Pago"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Te,{defaultChecked:(a==null?void 0:a.status)==="Aprobado",onChange:o=>_(t=>({...t??{nombre:"",cantidad_servicios:"",monto:"",uid:"",vigencia:"",id:"",status:""},status:o?"Aprobado":"Por Aprobar"})),color:(a==null?void 0:a.status)==="Aprobado"?"green-500":"red-500"}),e.jsx("span",{className:"ml-2 text-gray-700",children:a==null?void 0:a.status})," "]})]}),e.jsxs("div",{className:"flex flex-col space-y-6",children:[" ",(a==null?void 0:a.comprobante_pago.metodo)&&e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Metodo de Pago:"}),e.jsx("input",{type:"text",value:a.comprobante_pago.metodo,readOnly:!0,className:"mt-1 p-3 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed"})]}),(a==null?void 0:a.comprobante_pago.fechaPago)&&e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Fecha de Pago:"}),e.jsx("input",{type:"text",value:a.comprobante_pago.fechaPago instanceof m?new Date(a.comprobante_pago.fechaPago.toDate()).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):new Date(a.comprobante_pago.fechaPago).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),readOnly:!0,className:"mt-1 p-3 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed"})]}),(a==null?void 0:a.comprobante_pago.bancoOrigen)&&e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Banco Origen:"}),e.jsx("input",{type:"text",value:a.comprobante_pago.bancoOrigen,readOnly:!0,className:"mt-1 p-3 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed"})]}),(a==null?void 0:a.comprobante_pago.bancoDestino)&&e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Banco Destino:"}),e.jsx("input",{type:"text",value:a.comprobante_pago.bancoDestino,readOnly:!0,className:"mt-1 p-3 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed"})]}),(a==null?void 0:a.comprobante_pago.correo)&&e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Correo:"}),e.jsx("input",{type:"text",value:a.comprobante_pago.correo,readOnly:!0,className:"mt-1 p-3 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed"})]}),(a==null?void 0:a.comprobante_pago.cedula)!==void 0&&a.comprobante_pago.cedula!==0&&e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Cédula:"}),e.jsx("input",{type:"text",value:a.comprobante_pago.cedula,readOnly:!0,className:"mt-1 p-3 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed"})]}),(a==null?void 0:a.comprobante_pago.telefono)!==void 0&&a.comprobante_pago.telefono!==0&&e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Telefono:"}),e.jsx("input",{type:"text",value:a.comprobante_pago.telefono,readOnly:!0,className:"mt-1 p-3 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed"})]}),(a==null?void 0:a.comprobante_pago.monto)!==void 0&&a.comprobante_pago.monto!==0&&e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Monto:"}),e.jsx("input",{type:"text",value:a.comprobante_pago.monto,readOnly:!0,className:"mt-1 p-3 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed"})]}),(a==null?void 0:a.comprobante_pago.numReferencia)&&e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Numero de referencia:"}),e.jsx("input",{type:"text",value:a.comprobante_pago.numReferencia,readOnly:!0,className:"mt-1 p-3 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed"})]}),(a==null?void 0:a.comprobante_pago.receiptFile)&&e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Comprobante de pago:"}),e.jsx("input",{type:"text",value:a.comprobante_pago.receiptFile,readOnly:!0,className:"mt-1 p-3 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed"})]})]}),e.jsx("div",{className:"text-center mt-6 ",children:e.jsx(O,{onClick:ee,style:{backgroundColor:"#000B7E"},className:"text-white hover:opacity-80",children:"Guardar Cambios"})})]}),e.jsx(Se,{isOpen:G,onClose:w,children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Seleccionar Rango de Fechas"}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"startDate",className:"block text-sm",children:"Desde:"}),e.jsx("input",{id:"startDate",type:"date",value:D,onChange:o=>B(o.target.value),className:"w-full border border-gray-300 rounded-md p-2"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"endDate",className:"block text-sm",children:"Hasta:"}),e.jsx("input",{id:"endDate",type:"date",value:C,onChange:o=>H(o.target.value),className:"w-full border border-gray-300 rounded-md p-2"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-4",children:[e.jsx(O,{onClick:w,children:"Cancelar"}),e.jsx(O,{onClick:me,className:"text-white hover:opacity-80",style:{backgroundColor:"#000B7E"},children:"Exportar"})]})]})})]})},Ya=Re;export{Ya as default};
