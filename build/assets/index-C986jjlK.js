import{r as o,j as e,a9 as E,a8 as R,aa as T}from"./index-ATNefdVG.js";import{P as se}from"./index-Rjm_CfUD.js";import{T as k}from"./index-1QBWWPtH.js";import{B as M}from"./Button-m8cr7QK0.js";import{D as oe}from"./Dialog-01bjbLh0.js";import{u as re,f as A,g as ne,a as le,b as ce}from"./index-mu3rsG90.js";import{t as d,N as u}from"./toast-ArUM2hkn.js";import{O as ie,D as de}from"./index.esm-RzyebFAI.js";import{u as v,w as ue}from"./xlsx-b-y62sF7.js";import{s as me,F as he}from"./index.esm-SLyUBwzt.js";import"./context-GUUKwgTl.js";import"./index-lc_qXIiG.js";import"./index-D5lh9mO-.js";import"./CloseButton-27bnAAMk.js";import"./motion-qY3QHwHT.js";import"./useTimeout-1ykP9PCU.js";import"./StatusIcon-yBHceAv6.js";import"./chainedFunction-ltcSYACe.js";const ge=()=>{const[B,H]=o.useState([]),[O,m]=o.useState([]);o.useState(null);const[S,U]=o.useState("nombre_taller"),[h,K]=o.useState(""),[w,L]=o.useState([]),[g,C]=o.useState(""),[x,y]=o.useState(""),N=async()=>{try{const t=await T(R(E,"Servicios")),a=[];await Promise.all(t.docs.map(async r=>{const c=r.data(),s=r.id,i=(await T(R(E,"Servicios",s,"calificaciones"))).docs.map(_=>({..._.data(),id:_.id}));a.push({nombre_servicio:c.nombre_servicio,uid_servicio:s,calificaciones:i})}));const n=a.flatMap(r=>r.calificaciones.map(c=>({...c,nombre_servicio:r.nombre_servicio})));L(n)}catch(t){console.error("Error obteniendo los datos:",t)}};o.useEffect(()=>{N()},[]);const q=async()=>{await N(),d.push(e.jsx(u,{title:"Datos actualizados",children:"La tabla ha sido actualizada con éxito."}))},I=t=>{const a=t.target.value;K(a),m([{id:S,value:a}])},z=t=>{const a=t.target.value;U(a),h!==""&&m([{id:a,value:h}])},[V,D]=o.useState(!1),G=()=>{D(!0)},p=()=>{D(!1),C(""),y("")},J=[{header:"Taller",accessorKey:"nombre_taller"},{header:"Servicio",accessorKey:"nombre_servicio"},{header:"Fecha de Creación",cell:({row:t})=>{const a=t.original.fecha_creacion;if(a){if(a.toDate)return a.toDate().toLocaleString();if(a instanceof Date)return a.toLocaleString()}return"Sin fecha"}},{header:"Nombre del Usuario",accessorKey:"usuario.nombre"},{header:"Correo del Usuario",accessorKey:"usuario.email"},{header:"Puntuación",cell:({row:t})=>{const a=t.original.puntuacion||0,n=5,r=Array.from({length:n},(c,s)=>s<a?e.jsx(me,{color:"gold"},s):e.jsx(he,{color:"gray"},s));return e.jsx("div",{style:{display:"flex",gap:"2px"},children:r})}},{header:"Comentario",accessorKey:"comentario"}],{Tr:F,Th:Q,Td:W,THead:X,TBody:Y,Sorter:xe}=k,f=re({data:w,columns:J,state:{sorting:B,columnFilters:O},onSortingChange:H,onColumnFiltersChange:m,getCoreRowModel:ne(),getSortedRowModel:le(),getFilteredRowModel:ce()}),[b,P]=o.useState(1),[j,Z]=o.useState(10),$=f.getRowModel().rows.length,ee=t=>{P(t)},ae=t=>{Z(t),P(1)},te=()=>{if(!g||!x){d.push(e.jsx(u,{title:"Fechas incompletas",children:"Por favor, selecciona ambas fechas para continuar."}));return}const t=new Date(g);t.setUTCHours(0,0,0,0);const a=new Date(x);a.setUTCHours(23,59,59,999),console.log({startDate:t,endDate:a});const n=w.filter(s=>{var i;const l=(i=s.fecha_creacion)==null?void 0:i.toDate();return console.log("Creation date aquí",l),l&&l>=t&&l<=a}).map(s=>{var l,i;return{"Nombre del taller":s.nombre_taller||"N/A",Puntuación:s.puntuacion||"N/A","Fecha de Creación":s.fecha_creacion?s.fecha_creacion.toDate().toLocaleString():"N/A","Nombre del Usuario":((l=s.usuario)==null?void 0:l.nombre)||"N/A","Correo del Usuario":((i=s.usuario)==null?void 0:i.email)||"N/A"}});if(n.length===0){d.push(e.jsx(u,{title:"Sin datos para exportar",children:"No hay datos disponibles en el rango de fechas seleccionado."}));return}const r=v.json_to_sheet(n),c=v.book_new();v.book_append_sheet(c,r,"Servicios"),ue(c,"ServiciosSolicitados.xlsx"),d.push(e.jsx(u,{title:"Exportación exitosa",children:"El archivo Excel se ha descargado correctamente."})),p(),console.log("Start date aquí: ",t,"End date aquí",a)};return e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsxs("h1",{className:"mb-6 flex justify-start items-center space-x-4",children:[" ",e.jsx("span",{className:"text-[#000B7E]",children:"Puntuación de talleres"}),e.jsx("button",{className:"p-2  bg-slate-100 hover:bg-slate-200 active:bg-slate-300 transition-all duration-200 shadow-md transform hover:scale-105 rounded-md",onClick:q,children:e.jsx(ie,{className:"w-5 h-5 text-gray-700 hover:text-blue-500 transition-colors duration-200"})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"relative w-32",children:[" ",e.jsx("select",{className:"h-10 w-full py-2 px-4 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:z,value:S,children:e.jsx("option",{value:"nombre_taller",children:"Taller"})})]}),e.jsxs("div",{className:"relative w-80 ml-4",children:[e.jsx("input",{type:"text",placeholder:"Buscar...",className:"w-full py-2 px-4 pl-10 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 h-10",value:h,onChange:I}),e.jsx(de,{className:"absolute left-3 top-5 transform -translate-y-1/2 text-gray-500 w-5 h-5"})]}),e.jsx("button",{style:{backgroundColor:"#000B7E"},className:"p-2 ml-4 bg-blue-500 text-white rounded-md shadow-md hover:bg-blue-600 active:bg-blue-700 transition duration-200 hover:opacity-80",onClick:G,children:"Exportar a Excel"})]})})]}),e.jsxs("div",{className:"p-1 rounded-lg shadow",children:[e.jsxs(k,{className:"w-full rounded-lg",children:[e.jsx(X,{children:f.getHeaderGroups().map(t=>e.jsx(F,{children:t.headers.map(a=>e.jsx(Q,{colSpan:a.colSpan,children:a.isPlaceholder?null:e.jsx("div",{className:a.column.getCanSort()?"cursor-pointer select-none":"",onClick:a.column.getToggleSortingHandler(),children:A(a.column.columnDef.header,a.getContext())})},a.id))},t.id))}),e.jsx(Y,{children:f.getRowModel().rows.slice((b-1)*j,b*j).map(t=>e.jsx(F,{children:t.getVisibleCells().map(a=>e.jsx(W,{children:A(a.column.columnDef.cell,a.getContext())},a.id))},t.id))})]}),e.jsx(se,{onChange:ee,currentPage:b,totalRows:$,rowsPerPage:j,onRowsPerPageChange:ae})]}),e.jsx(oe,{isOpen:V,onClose:p,children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Seleccionar Rango de Fechas"}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"startDate",className:"block text-sm",children:"Fecha de Inicio:"}),e.jsx("input",{id:"startDate",type:"date",value:g,onChange:t=>C(t.target.value),className:"w-full border border-gray-300 rounded-md p-2"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"endDate",className:"block text-sm",children:"Fecha de Fin:"}),e.jsx("input",{id:"endDate",type:"date",value:x,onChange:t=>y(t.target.value),className:"w-full border border-gray-300 rounded-md p-2"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-4",children:[e.jsx(M,{onClick:p,children:"Cancelar"}),e.jsx(M,{onClick:te,className:"text-white hover:opacity-80",style:{backgroundColor:"#000B7E"},children:"Exportar"})]})]})})]})})},Ae=ge;export{Ae as default};
