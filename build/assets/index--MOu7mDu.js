import{j as e,r as i,a9 as T,a8 as E,aa as R}from"./index-yOh4elUK.js";import{C as k}from"./Card-WaxYct8O.js";import{B as G}from"./Badge-VaOWE5So.js";import{C as J}from"./Chart-i55kugcp.js";import{C as O,_ as Q}from"./chart.constant-gkDtj7gX.js";import{B as A}from"./Button-ESr_rbs6.js";import{a as B}from"./Views-4xLEiuVY.js";import{P as Y}from"./index-c6Y51EyS.js";import{u as Z,f as I,g as ee,a as te,b as se}from"./index-pj93xoiL.js";import{n as ae,A as oe,F as re}from"./index.esm-EH5xtEO9.js";import{T as $}from"./index-VaZYrBm8.js";import"./chart.config-YTE7_seM.js";import"./index-E4eNJ87t.js";import"./context-zGpVC6c9.js";const ne=({data:a={labels:[],data:[],colors:[]}})=>e.jsx(k,{children:e.jsx("div",{className:"mt-6",children:a.data.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(J,{donutTitle:`${a.data.reduce((c,l)=>c+l,0)}`,donutText:"Cantidad de Talleres",series:a.data,customOptions:{labels:a.labels,colors:a.colors.length?a.colors:O},type:"donut"}),a.data.length===a.labels.length&&e.jsx("div",{className:"mt-6 grid grid-cols-2 gap-4 max-w-[180px] mx-auto",children:a.labels.map((c,l)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{badgeStyle:{backgroundColor:a.colors[l]||O[l]}}),e.jsx("span",{className:"font-semibold",children:c})]},c))})]})})}),ce=()=>{const[a,c]=i.useState([]),[l,b]=i.useState([]),[r,g]=i.useState(0);return i.useEffect(()=>{(async()=>{try{const m=(await R(E(T,"Subscripciones"))).docs.map(s=>s.data()),C=new Date,x=new Date(C);x.setDate(C.getDate()-(C.getDay()+7*r)),new Date(x).setDate(x.getDate()+6);const F=s=>s.toISOString().split("T")[0],y=Array.from({length:7},(s,p)=>{const f=new Date(x);return f.setDate(x.getDate()+p),F(f)}),j={},S={};y.forEach(s=>{j[s]=0,S[s]=0}),m.forEach(s=>{const p=s.fechaCreacion?s.fechaCreacion.toDate().toISOString().split("T")[0]:void 0,f=s.fecha_inicio?s.fecha_inicio.toDate().toISOString().split("T")[0]:void 0;p&&j[p]!==void 0&&j[p]++,f&&s.comprobante_pago&&S[f]!==void 0&&S[f]++});const w=y.map(s=>j[s]),D=y.map(s=>S[s]);c([{name:"Subscripciones Diarias",data:w},{name:"Subscripciones Pagas",data:D}]),b(y)}catch(d){console.error("Error al obtener datos de subscripciones:",d)}})()},[r]),e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between"},children:[e.jsx(A,{onClick:()=>g(r+1),style:{backgroundColor:"#000B7E"},className:"text-white hover:opacity-80",children:"Semana Anterior"}),e.jsx(A,{onClick:()=>g(0),style:{backgroundColor:"#000B7E"},className:"text-white hover:opacity-80",children:"Semana Actual"}),e.jsx(A,{onClick:()=>g(r-1),style:{backgroundColor:"#000B7E"},className:"text-white hover:opacity-80",children:"Semana Siguiente"})]}),e.jsx(Q,{options:{chart:{id:"spline-area-chart"},dataLabels:{enabled:!1},colors:O,stroke:{curve:"smooth"},xaxis:{type:"datetime",categories:l,labels:{formatter:function(u){const d=new Date(u);return new Intl.DateTimeFormat("es-ES",{day:"2-digit",month:"short",year:"numeric"}).format(d)}}},tooltip:{x:{format:"yyyy-MM-dd"}}},series:a,type:"area",height:300})]})},le=async()=>{const a=await R(E(T,"Usuarios")),c=await R(E(T,"Subscripciones"));let l=0,b=0,r={aprobados:0,pendientes:0,rechazados:0,espera:0},g=0,u=0;return a.forEach(d=>{const m=d.data();if(m.typeUser==="Cliente"&&l++,m.typeUser==="Taller")switch(b++,m.status){case"Aprobado":r.aprobados++;break;case"Pendiente":r.pendientes++;break;case"Rechazado":r.rechazados++;break;case"En espera por aprobación":r.espera++;break}}),c.forEach(d=>{const m=d.data();u+=m.monto||0}),g=c.size,{clientesCount:l,tallerCount:b,talleresStats:r,subscripcionesCount:g,totalMonto:u}},ie=()=>{const[a,c]=i.useState({clientesCount:0,tallerCount:0,talleresStats:{aprobados:0,pendientes:0,rechazados:0,espera:0},subscripcionesCount:0,totalMonto:0});i.useEffect(()=>{(async()=>{try{const t=await le();c(t)}catch(t){console.error("Error al obtener los datos del dashboard:",t)}})()},[]);const[l,b]=i.useState([]),r=async()=>{try{const o=await R(E(T,"Servicios")),t=[];await Promise.all(o.docs.map(async n=>{const N=n.data(),h=n.id,M=(await R(E(T,"Servicios",h,"calificaciones"))).docs.map(z=>({...z.data(),id:z.id}));t.push({nombre_servicio:N.nombre_servicio,taller:N.taller||"Sin taller",uid_servicio:h,calificaciones:M})}));const _=t.map(n=>{const N=n.calificaciones.reduce((P,M)=>P+(M.puntuacion??0),0),h=n.calificaciones.length>0?N/n.calificaciones.length:0;return{nombre_servicio:n.nombre_servicio,taller:n.taller,promedio_puntuacion:h}}).filter(n=>n.promedio_puntuacion>0);b(_)}catch(o){console.error("Error obteniendo los datos:",o)}};i.useEffect(()=>{r()},[]);const g=[{header:"Taller",accessorKey:"taller"},{header:"Servicio",accessorKey:"nombre_servicio"},{header:"Promedio de Calificación",cell:({row:o})=>{const t=o.original.promedio_puntuacion||0,_=5,n=Array.from({length:_},(N,h)=>{const P=h+1;return P<=t?e.jsx(ae,{color:"gold",style:{marginRight:"2px"}},h):P-.5<=t?e.jsx(oe,{color:"gold",style:{marginRight:"2px"}},h):e.jsx(re,{color:"gray",style:{marginRight:"2px"}},h)});return e.jsxs("div",{style:{display:"flex",gap:"2px",alignItems:"center"},children:[e.jsx("div",{style:{display:"flex"},children:n}),e.jsx("span",{style:{marginLeft:"8px"},children:t.toFixed(1)})," "]})}}],{Tr:u,Th:d,Td:m,THead:C,TBody:x,Sorter:H}=$,[F,y]=i.useState([]),[j,S]=i.useState([]),w=Z({data:l,columns:g,state:{sorting:F,columnFilters:j},onSortingChange:y,onColumnFiltersChange:S,getCoreRowModel:ee(),getSortedRowModel:te(),getFilteredRowModel:se()}),[D,s]=i.useState(1),p=4,K=w.getRowModel().rows.length,W=o=>{console.log("onPaginationChange",o),s(o)},{clientesCount:L,tallerCount:U,talleresStats:v,subscripcionesCount:V,totalMonto:X}=a,q={labels:["Aprobados","Pendientes","Rechazados","En espera por aprobación"],data:[v.aprobados,v.pendientes,v.rechazados,v.espera],colors:["#15803D","#FFC107","#C22F1C","#2196F3"]};return e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsx("a",{href:`${B}/users`,className:"hover:shadow-lg ease-in-out p-4",children:e.jsxs(k,{className:"bg-gray-50 shadow",children:[e.jsx("h5",{className:"text-gray-500 text-base font-semibold",children:"Clientes"}),e.jsx("div",{className:"flex items-center justify-between mt-3",children:e.jsx("p",{className:"text-4xl font-bold text-gray-900",children:L})}),e.jsx("p",{className:"text-base text-gray-500 mt-2",children:"Total de clientes"})]})}),e.jsx("a",{href:`${B}/garages`,className:"hover:shadow-lg ease-in-out p-4",children:e.jsxs(k,{className:"bg-gray-50 shadow",children:[e.jsx("h5",{className:"text-gray-500 text-base font-semibold",children:"Talleres"}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsx("p",{className:"text-4xl font-bold text-gray-900",children:U}),e.jsxs("span",{className:"text-base font-semibold text-red-700 bg-red-100 px-3 py-1 rounded-full",children:[v.espera," en espera"]})]}),e.jsx("p",{className:"text-base text-gray-500 mt-2",children:"Total Talleres"})]})}),e.jsx("a",{href:`${B}/subscriptions`,className:"hover:shadow-lg ease-in-out p-4",children:e.jsxs(k,{className:"bg-gray-50 shadow",children:[e.jsx("h5",{className:"text-gray-500 text-base font-semibold",children:"Subscripciones"}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsx("p",{className:"text-4xl font-bold text-gray-900",children:V}),e.jsxs("span",{className:"text-base font-semibold text-green-700 bg-green-100 px-3 py-1 rounded-full",children:["$",X.toFixed(2)," Total"]})]}),e.jsx("p",{className:"text-base text-gray-500 mt-2",children:"Subscripciones y monto total"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mt-6",children:[e.jsx(ce,{}),e.jsx(ne,{data:q})]}),e.jsxs("div",{className:"p-1 rounded-lg shadow",children:[e.jsx("h2",{className:"mb-4",children:"Calificaciones de los Servicios"}),e.jsxs($,{className:"w-full rounded-lg",children:[e.jsx(C,{children:w.getHeaderGroups().map(o=>e.jsx(u,{children:o.headers.map(t=>e.jsx(d,{colSpan:t.colSpan,children:t.isPlaceholder?null:e.jsx("div",{className:t.column.getCanSort()?"cursor-pointer select-none":"",onClick:t.column.getToggleSortingHandler(),children:I(t.column.columnDef.header,t.getContext())})},t.id))},o.id))}),e.jsx(x,{children:w.getRowModel().rows.slice((D-1)*p,D*p).map(o=>e.jsx(u,{children:o.getVisibleCells().map(t=>e.jsx(m,{children:I(t.column.columnDef.cell,t.getContext())},t.id))},o.id))})]}),e.jsx(Y,{onChange:W,currentPage:D,totalRows:K,rowsPerPage:p})]})]})},De=ie;export{De as default};
