import{j as e,r as n,a9 as T,a8 as R,aa as E}from"./index-ATNefdVG.js";import{C as _}from"./Card-OSPH2pm3.js";import{B as G}from"./Badge-7j32ABcM.js";import{C as J}from"./Chart-v0VYdSDt.js";import{C as O,_ as Q}from"./chart.constant-XuFGxMOV.js";import{B}from"./Button-m8cr7QK0.js";import{a as A}from"./Views-oxXEUsSY.js";import{P as Y}from"./index-Rjm_CfUD.js";import{u as Z,f as I,g as ee,a as te,b as se}from"./index-mu3rsG90.js";import{s as ae,v as oe,F as re}from"./index.esm-SLyUBwzt.js";import{T as $}from"./index-1QBWWPtH.js";import"./chart.config-kCa32W7p.js";import"./index-D5lh9mO-.js";import"./context-GUUKwgTl.js";const ne=({data:a={labels:[],data:[],colors:[]}})=>e.jsx(_,{children:e.jsx("div",{className:"mt-6",children:a.data.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(J,{donutTitle:`${a.data.reduce((c,l)=>c+l,0)}`,donutText:"Cantidad de Talleres",series:a.data,customOptions:{labels:a.labels,colors:a.colors.length?a.colors:O},type:"donut"}),a.data.length===a.labels.length&&e.jsx("div",{className:"mt-6 grid grid-cols-2 gap-4 max-w-[180px] mx-auto",children:a.labels.map((c,l)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{badgeStyle:{backgroundColor:a.colors[l]||O[l]}}),e.jsx("span",{className:"font-semibold",children:c})]},c))})]})})}),ce=()=>{const[a,c]=n.useState([]),[l,y]=n.useState([]),[i,g]=n.useState(0);return n.useEffect(()=>{(async()=>{try{const m=(await E(R(T,"Subscripciones"))).docs.map(s=>s.data()),w=new Date,f=new Date(w);f.setDate(w.getDate()-(w.getDay()+7*i)),new Date(f).setDate(f.getDate()+6);const k=s=>s.toISOString().split("T")[0],j=Array.from({length:7},(s,h)=>{const x=new Date(f);return x.setDate(f.getDate()+h),k(x)}),S={},C={};j.forEach(s=>{S[s]=0,C[s]=0}),m.forEach(s=>{const h=s.fechaCreacion?s.fechaCreacion.toDate().toISOString().split("T")[0]:void 0,x=s.fecha_inicio?s.fecha_inicio.toDate().toISOString().split("T")[0]:void 0;h&&S[h]!==void 0&&S[h]++,x&&s.comprobante_pago&&C[x]!==void 0&&C[x]++});const D=j.map(s=>S[s]),v=j.map(s=>C[s]);c([{name:"Subscripciones Diarias",data:D},{name:"Subscripciones Pagas",data:v}]),y(j)}catch(d){console.error("Error al obtener datos de subscripciones:",d)}})()},[i]),e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between"},children:[e.jsx(B,{onClick:()=>g(i+1),style:{backgroundColor:"#000B7E"},className:"text-white hover:opacity-80",children:"Semana Anterior"}),e.jsx(B,{onClick:()=>g(0),style:{backgroundColor:"#000B7E"},className:"text-white hover:opacity-80",children:"Semana Actual"}),e.jsx(B,{onClick:()=>g(i-1),style:{backgroundColor:"#000B7E"},className:"text-white hover:opacity-80",children:"Semana Siguiente"})]}),e.jsx(Q,{options:{chart:{id:"spline-area-chart"},dataLabels:{enabled:!1},colors:O,stroke:{curve:"smooth"},xaxis:{type:"datetime",categories:l,labels:{formatter:function(u){const d=new Date(u);return new Intl.DateTimeFormat("es-ES",{day:"2-digit",month:"short",year:"numeric"}).format(d)}}},tooltip:{x:{format:"yyyy-MM-dd"}}},series:a,type:"area",height:300})]})},le=async()=>{const a=await E(R(T,"Usuarios")),c=await E(R(T,"Subscripciones"));let l=0,y=0,i={aprobados:0,rechazados:0,espera:0},g=0,u=0;return a.forEach(d=>{const m=d.data();if(m.typeUser==="Cliente"&&l++,m.typeUser==="Taller")switch(y++,m.status){case"Aprobado":i.aprobados++;break;case"Rechazado":i.rechazados++;break;case"En espera por aprobación":i.espera++;break}}),c.forEach(d=>{const m=d.data();u+=m.monto||0}),g=c.size,{clientesCount:l,tallerCount:y,talleresStats:i,subscripcionesCount:g,totalMonto:u}},ie=()=>{const[a,c]=n.useState({clientesCount:0,tallerCount:0,talleresStats:{aprobados:0,rechazados:0,espera:0},subscripcionesCount:0,totalMonto:0});n.useEffect(()=>{(async()=>{try{const t=await le();c(t)}catch(t){console.error("Error al obtener los datos del dashboard:",t)}})()},[]);const[l,y]=n.useState([]),i=async()=>{try{const o=await E(R(T,"Servicios")),t=[];await Promise.all(o.docs.map(async r=>{const N=r.data(),p=r.id,M=(await E(R(T,"Servicios",p,"calificaciones"))).docs.map(z=>({...z.data(),id:z.id}));t.push({nombre_servicio:N.nombre_servicio,taller:N.taller||"Sin taller",uid_servicio:p,calificaciones:M})}));const F=t.map(r=>{const N=r.calificaciones.reduce((P,M)=>P+(M.puntuacion??0),0),p=r.calificaciones.length>0?N/r.calificaciones.length:0;return{nombre_servicio:r.nombre_servicio,taller:r.taller,promedio_puntuacion:p}}).filter(r=>r.promedio_puntuacion>0);y(F)}catch(o){console.error("Error obteniendo los datos:",o)}};n.useEffect(()=>{i()},[]);const g=[{header:"Taller",accessorKey:"taller"},{header:"Servicio",accessorKey:"nombre_servicio"},{header:"Promedio de Calificación",cell:({row:o})=>{const t=o.original.promedio_puntuacion||0,F=5,r=Array.from({length:F},(N,p)=>{const P=p+1;return P<=t?e.jsx(ae,{color:"gold",style:{marginRight:"2px"}},p):P-.5<=t?e.jsx(oe,{color:"gold",style:{marginRight:"2px"}},p):e.jsx(re,{color:"gray",style:{marginRight:"2px"}},p)});return e.jsxs("div",{style:{display:"flex",gap:"2px",alignItems:"center"},children:[e.jsx("div",{style:{display:"flex"},children:r}),e.jsx("span",{style:{marginLeft:"8px"},children:t.toFixed(1)})," "]})}}],{Tr:u,Th:d,Td:m,THead:w,TBody:f,Sorter:H}=$,[k,j]=n.useState([]),[S,C]=n.useState([]),D=Z({data:l,columns:g,state:{sorting:k,columnFilters:S},onSortingChange:j,onColumnFiltersChange:C,getCoreRowModel:ee(),getSortedRowModel:te(),getFilteredRowModel:se()}),[v,s]=n.useState(1),[h,x]=n.useState(10),K=D.getRowModel().rows.length,W=o=>{s(o)},L=o=>{x(o),s(1)},{clientesCount:U,tallerCount:me,talleresStats:b,subscripcionesCount:V,totalMonto:X}=a,q={labels:["Aprobados","Rechazados","En espera por aprobación"],data:[b.aprobados,b.rechazados,b.espera],colors:["#15803D","#C22F1C","#2196F3"]};return e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsx("a",{href:`${A}/users`,className:"hover:shadow-lg ease-in-out p-4",children:e.jsxs(_,{className:"bg-gray-50 shadow",children:[e.jsx("h5",{className:"text-gray-500 text-base font-semibold",children:"Clientes"}),e.jsx("div",{className:"flex items-center justify-between mt-3",children:e.jsx("p",{className:"text-4xl font-bold text-gray-900",children:U})}),e.jsx("p",{className:"text-base text-gray-500 mt-2",children:"Total de clientes"})]})}),e.jsx("a",{href:`${A}/garages`,className:"hover:shadow-lg ease-in-out p-4",children:e.jsxs(_,{className:"bg-gray-50 shadow",children:[e.jsx("h5",{className:"text-gray-500 text-base font-semibold",children:"Talleres"}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsx("p",{className:"text-4xl font-bold text-gray-900",children:b.aprobados+b.rechazados+b.espera}),e.jsxs("span",{className:"text-base font-semibold text-red-700 bg-red-100 px-3 py-1 rounded-full",children:[b.espera," en espera"]})]}),e.jsx("p",{className:"text-base text-gray-500 mt-2",children:"Total Talleres"})]})}),e.jsx("a",{href:`${A}/subscriptions`,className:"hover:shadow-lg ease-in-out p-4",children:e.jsxs(_,{className:"bg-gray-50 shadow",children:[e.jsx("h5",{className:"text-gray-500 text-base font-semibold",children:"Subscripciones"}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsx("p",{className:"text-4xl font-bold text-gray-900",children:V}),e.jsxs("span",{className:"text-base font-semibold text-green-700 bg-green-100 px-3 py-1 rounded-full",children:["$",X.toFixed(2)," Total"]})]}),e.jsx("p",{className:"text-base text-gray-500 mt-2",children:"Subscripciones y monto total"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mt-6",children:[e.jsx(ce,{}),e.jsx(ne,{data:q})]}),e.jsxs("div",{className:"p-1 rounded-lg shadow",children:[e.jsx("h2",{className:"mb-4",children:"Calificaciones de los Servicios"}),e.jsxs($,{className:"w-full rounded-lg",children:[e.jsx(w,{children:D.getHeaderGroups().map(o=>e.jsx(u,{children:o.headers.map(t=>e.jsx(d,{colSpan:t.colSpan,children:t.isPlaceholder?null:e.jsx("div",{className:t.column.getCanSort()?"cursor-pointer select-none":"",onClick:t.column.getToggleSortingHandler(),children:I(t.column.columnDef.header,t.getContext())})},t.id))},o.id))}),e.jsx(f,{children:D.getRowModel().rows.slice((v-1)*h,v*h).map(o=>e.jsx(u,{children:o.getVisibleCells().map(t=>e.jsx(m,{children:I(t.column.columnDef.cell,t.getContext())},t.id))},o.id))})]}),e.jsx(Y,{onChange:W,currentPage:v,totalRows:K,rowsPerPage:h,onRowsPerPageChange:L})]})]})},Ne=ie;export{Ne as default};
