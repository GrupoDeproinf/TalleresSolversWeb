import{r as t,j as e,a4 as ve,a6 as C,a7 as H,a8 as G,a9 as v,aa as $,ab as Ee,ac as Se,af as J,ah as De,ai as Te,aj as Re,ak as Fe,al as Pe,ae as ke,ag as Le}from"./index-_feUBWkF.js";import{P as Me}from"./index-VNg9U51V.js";import{T as K}from"./index--K6mHtPM.js";import{u as _e,f as Q,g as Ge,a as $e,b as qe}from"./index-IwiwqbVe.js";import{g as Ie,h as Ae,e as Be,i as Ue,j as ze,k as Oe,l as He}from"./index.esm-c6ShvaQW.js";import{B as f}from"./Button-jcq0xEfh.js";import{D as Je}from"./Dialog-v8uTeGhc.js";import{t as l,N as n}from"./toast-GgiGqW4N.js";import{D as Ke}from"./Drawer-psoT67UG.js";import"./Alert-WzJy301q.js";import{A as Qe}from"./index-vYF_FpU2.js";import"./Badge-TmEmdow9.js";import"./Calendar-OEPJiOUd.js";import"./Card-fXn1hgP9.js";import"./index-H_ZscJuo.js";import"./index-CGu17yU7.js";import"./index-5qYT1f9K.js";import"./FormItem-MYXqnsmy.js";import"./Input-E8Xy-NaX.js";import"./index-ep3SI8rj.js";import"./index-oQxwVP1_.js";import"./index-xnMpDD1K.js";import"./Progress-hlvl7h9I.js";import"./index-bOSGx0a4.js";import"./RangeCalendar-E_24dkLH.js";import"./ScrollBar-S0qWNEjk.js";import"./index-F9R31yWw.js";import"./Select-9xvaqg6U.js";import"./Skeleton-v_ck5RJ1.js";import"./index-aTgaXSlK.js";import"./Switcher-umThDEGW.js";import"./index-HTFXVSWF.js";import"./Tag-RmI7uqBT.js";import"./index-iDZU1Tza.js";import"./index-ENU_IEPp.js";import"./Tooltip-tqY3hXOR.js";import"./Upload-caBsJdBw.js";import{O as Ve,D as We}from"./index.esm-CyL_iEBq.js";import{G as Ye}from"./index.esm-o5qTw11C.js";import{c as Ze,a as u,e as Xe}from"./index.esm-XUyKFeu_.js";import{F as ea,a as aa,b as m,E as d}from"./formik.esm-yiEeoVLJ.js";import{G as ra,M as sa}from"./esm-JCjKj5Go.js";import"./context-w88CtZWU.js";import"./index-8Gigl45y.js";import"./index-Xr0iHSGr.js";import"./CloseButton-0JjgPcqS.js";import"./motion-2zhnpuIh.js";import"./useTimeout-lvoBzkZb.js";import"./StatusIcon-mkSwP6mg.js";import"./chainedFunction-ltcSYACe.js";import"./useMergeRef-Rt_Crb27.js";import"./useControllableState-Z5L6i6Et.js";import"./cloneDeep-GJ9f8YIY.js";import"./_getAllKeys-ubi2BvIA.js";import"./_MapCache-HrqL2mpR.js";import"./Views-NoPs0swz.js";import"./_baseIsEqual-d0iTpr48.js";import"./get-iuu1b1Bt.js";import"./toString-LmJFJgEq.js";import"./floating-ui.react-AOig1bqs.js";import"./floating-ui.dom-0rLBacrf.js";import"./TimeInput-9HnXIoua.js";import"./useUniqueId-XtUBe_3h.js";import"./useDidUpdate-SXgnC2jO.js";import"./useRootClose--xQa3G5y.js";import"./isNil-uGA-FeKR.js";import"./index-C1ft9MxP.js";import"./toConsumableArray-YYxflNc8.js";import"./objectWithoutPropertiesLoose-pdUxmcoj.js";import"./setPrototypeOf-ahVgEFUp.js";import"./mapCloneElement-bHmR-YFq.js";import"./index.esm-bIknb-8m.js";import"./index.esm-vV1KXhJ0.js";const oa=g=>{const{data:c,save:E}=g,[S]=t.useState({lat:10.47915,lng:-66.90618}),[D]=t.useState(10),T=async h=>{if(!h.latLng)return;const x={lat:h.latLng.lat(),lng:h.latLng.lng()};console.log(x),E({latiLng:x,zoom:17})};return e.jsx("div",{style:{height:"450px",width:"100%"},children:e.jsx(ra,{center:c?c.latiLng:S,zoom:c?c.zoom:D,mapContainerStyle:{height:"400px",width:"100%",marginTop:"10px"},onClick:T,children:c&&e.jsx(sa,{position:c.latiLng})})})},ta=()=>{const[g,c]=t.useState(null),[E,S]=t.useState([]),[D,T]=t.useState([]),[h,x]=t.useState(!1),[q,V]=t.useState("nombre"),[R,W]=t.useState(""),[Y,F]=t.useState([]),[p,j]=t.useState(null);t.useState(!1);const b=async()=>{const a=C(H(G,"Usuarios")),r=await v(a),o=[];r.forEach(s=>{const i=s.data();i.typeUser==="Taller"&&o.push({...i,id:s.id})}),S(o)},Z=ve();t.useEffect(()=>{b()},[]);const X=async()=>{await b(),l.push(e.jsx(n,{title:"Datos actualizados",children:"La tabla ha sido actualizada con éxito."}))},[ee,y]=t.useState(!1),[ae,re]=t.useState({nombre:"",email:"",rif:"",phone:"",uid:"",typeUser:"Taller",image_perfil:"",image_file:"",status:"Aprobado",Direccion:"",ubicacion:"",id:"",password:"",estado:""}),se=a=>{j(a),x(!0)},oe=Ze().shape({nombre:u().min(3,"El nombre debe tener al menos 3 caracteres").required("El nombre es obligatorio"),email:u().email("Debe ser un email válido").required("El correo electrónico es obligatorio").test("termina-en-com",'El email debe terminar en ".com"',a=>(a==null?void 0:a.endsWith(".com"))??!1),rif:u().matches(/^[V,E,C,G,J,P]-\d{7,10}$/,"tener entre 7 y 10 dígitos").required("El rif es obligatoria"),phone:u().matches(/^(?!0)\d{10}$/,"El teléfono debe tener 11 dígitos y no puede comenzar con 0").required("El teléfono es obligatorio"),password:u().required("Por favor ingrese una contraseña").min(6,"La contraseña debe tener al menos 6 caracteres"),confirmPassword:u().oneOf([Xe("password")],"Las contraseñas no coinciden").required("Por favor confirme su contraseña"),estado:u().required("El estado es obligatorio")});t.useState(!1);const te=async(a,r)=>{var o;if(console.log("Datos del garage a crear",a),a.password!==a.confirmPassword){l.push(e.jsx(n,{title:"Error",children:"Las contraseñas no coinciden. Por favor, verifica los campos."}));return}console.log(r);try{const s=H(G,"Usuarios"),i=a.email.toLowerCase(),N=C(s,$("email","==",i));if(!(await v(N)).empty){l.push(e.jsx(n,{title:"Error",children:"¡El correo electrónico ya está registrado!"}));return}const ye=C(s,$("rif","==",a.rif));if(!(await v(ye)).empty){l.push(e.jsx(n,{title:"Error",children:"¡El RIF ya está registrado!"}));return}const Ne=C(s,$("phone","==",a.phone));if(!(await v(Ne)).empty){l.push(e.jsx(n,{title:"Error",children:"¡El número de teléfono ya está registrado!"}));return}const M=(await Se(Ee,i,a.password)).user,U=J(s,M.uid);await De(U,{uid:M.uid,nombre:a.nombre,email:i,rif:a.rif,phone:a.phone,typeUser:"Taller",status:"Aprobado",Direccion:a.Direccion,ubicacion:r===null?"":r.latiLng,estado:a.estado,image_perfil:""});let z="";if(a.image_file){const _=(o=a.image_file.name.split(".").pop())==null?void 0:o.toLowerCase();if(!_||!["png","jpg","jpeg","webp"].includes(_)){l.push(e.jsx(n,{title:"Error",children:"Tipo de archivo no soportado. Solo se permiten imágenes."}));return}const we=`${M.uid}_1.${_}`,O=Re(Te,`profileImages/${we}`),Ce=a.image_file;await Fe(O,Ce),z=await Pe(O),await ke(U,{image_perfil:z})}l.push(e.jsx(n,{title:"Éxito",children:"Taller creado y autenticado con éxito."})),y(!1),b()}catch(s){console.error("Error creando el taller:",s),l.push(e.jsx(n,{title:"Error",children:"Hubo un error al crear el Taller."}))}},ie=a=>{const r=a.target.value;W(r),F([{id:q,value:r}])},le=a=>{const r=a.target.value;V(r),R!==""&&F([{id:r,value:R}])},ne=a=>{console.log("Drawer cerrado",a),y(!1),c(null),re({nombre:"",email:"",rif:"",phone:"",id:"",Direccion:"",uid:"",estado:"",password:"",image_perfil:""}),j(null)},ce=a=>a?a.split(" ").filter(Boolean).map(o=>typeof o=="string"&&o.length>0?o[0].toUpperCase():"").join(""):"",de=[{header:"Nombre",accessorKey:"nombre",cell:({getValue:a,row:r})=>{const o=r.original.image_perfil;return e.jsxs("div",{className:"flex items-center",children:[o?e.jsx("img",{src:o,alt:"Logo",className:"h-10 w-10 object-cover rounded-full mr-4"}):e.jsxs("div",{className:"h-10 w-10 bg-gray-200 rounded flex items-center justify-center mr-2",children:[e.jsx(Ye,{className:"h-6 w-6 text-gray-400","aria-hidden":"true"})," "]}),a()," "]})},filterFn:"includesString",footer:a=>a.column.id},{header:"RIF",accessorKey:"rif"},{header:"Estado",accessorKey:"estado"},{header:"Email",accessorKey:"email"},{header:"Numero Telefonico",accessorKey:"phone",cell:({row:a})=>{const r=a.original.nombre;return e.jsxs("div",{className:"flex items-center",children:[e.jsx(Qe,{className:"mr-2 w-8 h-8 flex items-center justify-center rounded-full",style:{backgroundColor:"#887677"},children:e.jsx("span",{className:"text-white font-bold",children:ce(r)})}),a.original.phone," "]})}},{header:"Estado",accessorKey:"status",cell:({row:a})=>{const r=a.getValue("status");let o,s;switch(r){case"Aprobado":o=e.jsx(He,{className:"text-green-500 mr-1"}),s="text-green-500";break;case"Rechazado":o=e.jsx(Oe,{className:"text-red-500 mr-1"}),s="text-red-500";break;case"Pendiente":o=e.jsx(ze,{className:"text-yellow-500 mr-1"}),s="text-yellow-500";break;case"En espera por aprobación":o=e.jsx(Ue,{className:"text-blue-500 mr-1"}),s="text-blue-500";break;default:o=null}return e.jsxs("div",{className:`flex items-center ${s}`,children:[o,e.jsx("span",{children:r})]})}},{header:" ",cell:({row:a})=>{const r=a.original;return e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Z(`/profilegarage/${r.uid}`),className:"text-blue-900",children:e.jsx(Ae,{})}),e.jsx("button",{onClick:()=>se(r),className:"text-red-700",children:e.jsx(Be,{})})]})}}],{Tr:I,Th:me,Td:pe,THead:ue,TBody:xe,Sorter:ia}=K,P=a=>{console.log("onDialogClose",a),x(!1),j(null)},ge=async()=>{if(p){console.log("Eliminando a:",p);try{const a=J(G,"Usuarios",p.uid);await Le(a);const r=e.jsxs(n,{title:"Éxito",children:["Taller ",p.nombre," eliminado con éxito."]});l.push(r),b()}catch(a){console.error("Error eliminando el taller:",a);const r=e.jsx(n,{title:"Error",children:"Hubo un error eliminando el taller."});l.push(r)}finally{x(!1),j(null)}}},k=_e({data:E,columns:de,state:{sorting:D,columnFilters:Y},onSortingChange:T,onColumnFiltersChange:F,getCoreRowModel:Ge(),getSortedRowModel:$e(),getFilteredRowModel:qe()}),[A,he]=t.useState(1),L=6,fe=k.getRowModel().rows.length,je=a=>{console.log("onPaginationChange",a),he(a)},B=(A-1)*L,be=B+L;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsxs("h1",{className:"mb-6 flex justify-start items-center space-x-4",children:[" ",e.jsx("span",{className:"text-[#000B7E]",children:"Talleres"}),e.jsx("button",{className:"p-2  bg-slate-100 hover:bg-slate-200 active:bg-slate-300 transition-all duration-200 shadow-md transform hover:scale-105 rounded-md",onClick:X,children:e.jsx(Ve,{className:"w-5 h-5 text-gray-700 hover:text-blue-500 transition-colors duration-200"})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"relative w-32",children:[" ",e.jsxs("select",{className:"h-10 w-full py-2 px-4 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:le,value:q,children:[e.jsx("option",{value:"",disabled:!0,children:"Seleccionar columna..."}),e.jsx("option",{value:"nombre",children:"Nombre"}),e.jsx("option",{value:"rif",children:"Rif"}),e.jsx("option",{value:"email",children:"Email"}),e.jsx("option",{value:"status",children:"Estado"})]})]}),e.jsxs("div",{className:"relative w-80 ml-4",children:[e.jsx("input",{type:"text",placeholder:"Buscar...",className:"w-full py-2 px-4 pl-10 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 h-10",value:R,onChange:ie}),e.jsx(We,{className:"absolute left-3 top-5 transform -translate-y-1/2 text-gray-500 w-5 h-5"})]}),e.jsx(f,{className:"w-40 ml-4 text-white hover:opacity-80",style:{backgroundColor:"#000B7E"},onClick:()=>y(!0),children:"Crear Taller"})]})})]}),e.jsxs("div",{className:"p-3 rounded-lg shadow",children:[e.jsxs(K,{className:"w-full rounded-lg",children:[e.jsx(ue,{children:k.getHeaderGroups().map(a=>e.jsx(I,{children:a.headers.map(r=>e.jsx(me,{colSpan:r.colSpan,children:r.isPlaceholder?null:e.jsx("div",{className:r.column.getCanSort()?"cursor-pointer select-none":"",onClick:r.column.getToggleSortingHandler(),children:Q(r.column.columnDef.header,r.getContext())})},r.id))},a.id))}),e.jsx(xe,{children:k.getRowModel().rows.slice(B,be).map(a=>e.jsx(I,{children:a.getVisibleCells().map(r=>e.jsx(pe,{children:Q(r.column.columnDef.cell,r.getContext())},r.id))},a.id))})]}),e.jsx(Me,{onChange:je,currentPage:A,totalRows:fe,rowsPerPage:L})]}),e.jsxs(Je,{isOpen:h,onClose:P,onRequestClose:P,children:[e.jsx("h5",{className:"mb-4",children:"Confirmar Eliminación"}),e.jsxs("p",{children:["¿Estás seguro de que deseas eliminar a"," ",p==null?void 0:p.nombre,"?"]}),e.jsxs("div",{className:"text-right mt-6",children:[e.jsx(f,{className:"ltr:mr-2 rtl:ml-2",variant:"plain",onClick:P,children:"Cancelar"}),e.jsx(f,{style:{backgroundColor:"#B91C1C"},className:"text-white hover:opacity-80",onClick:ge,children:"Eliminar"})]})]}),e.jsxs(Ke,{isOpen:ee,onClose:ne,className:"rounded-md shadow",children:[e.jsx("h2",{className:"mb-4 text-xl font-bold",children:"Crear Taller"}),e.jsx(ea,{initialValues:{nombre:"",email:"",rif:"J-",phone:"",Direccion:"",ubicacion:"",password:"",image_perfil:"",estado:"",image_file:null},validationSchema:oe,onSubmit:(a,{setSubmitting:r})=>{te(a,g),r(!1),console.log(g),console.log(ae)},children:({values:a,setFieldValue:r,isSubmitting:o})=>e.jsx(aa,{children:e.jsxs("div",{className:"flex flex-col space-y-6",children:[e.jsx("div",{className:"mt-2 flex justify-center rounded-lg border border-dashed border-gray-900/25 px-6 py-10",children:e.jsxs("div",{className:"text-center",children:[a.image_perfil?e.jsx("img",{src:a.image_perfil,alt:"Preview Logo",className:"mx-auto h-32 w-32 object-cover"}):e.jsx(Ie,{className:"mx-auto h-12 w-12 text-gray-300","aria-hidden":"true"}),e.jsx("div",{className:"mt-4 flex text-sm leading-6 text-gray-600 justify-center",children:e.jsxs("label",{htmlFor:"logo-upload",className:"relative cursor-pointer rounded-md bg-white font-semibold text-indigo-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-indigo-600 focus-within:ring-offset-2 hover:text-indigo-500 flex justify-center items-center",children:[e.jsx("span",{children:a.image_perfil?"Cambiar Logo":"Seleccionar Logo"}),e.jsx("input",{id:"logo-upload",name:"logo-upload",type:"file",accept:"image/*",className:"sr-only",onChange:s=>{var N;const i=(N=s.target.files)==null?void 0:N[0];if(i){const w=new FileReader;w.onloadend=()=>{r("image_perfil",w.result),r("image_file",i)},w.readAsDataURL(i)}}})]})})]})}),e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Nombre Taller:"}),e.jsx(m,{type:"text",name:"nombre",className:"mt-1 p-3 border border-gray-300 rounded-lg"}),e.jsx(d,{name:"nombre",component:"div",className:"text-red-500"})]}),e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Email:"}),e.jsx(m,{type:"email",name:"email",className:"mt-1 p-3 border border-gray-300 rounded-lg"}),e.jsx(d,{name:"email",component:"div",className:"text-red-500"})]}),e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"RIF:"}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsxs("select",{name:"rifPrefix",value:a.rif.split("-")[0]||"J",onChange:s=>{const i=`${s.target.value}-${a.rif.split("-")[1]||""}`;r("rif",i)},className:"mx-2 p-3 border border-gray-300 rounded-l-lg",children:[e.jsx("option",{value:"V",children:"V-"}),e.jsx("option",{value:"E",children:"E-"}),e.jsx("option",{value:"C",children:"C-"}),e.jsx("option",{value:"G",children:"G-"}),e.jsx("option",{value:"J",children:"J-"}),e.jsx("option",{value:"P",children:"P-"})]}),e.jsx(m,{type:"text",name:"rif",value:a.rif.split("-")[1]||"",onChange:s=>{const i=`${a.rif.split("-")[0]||"J"}-${s.target.value}`;r("rif",i)},className:"mx-2 p-3 border border-gray-300 rounded-l-lg"})]}),e.jsx(d,{name:"rif",component:"div",className:"text-red-500"})]}),e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Estado:"}),e.jsxs(m,{as:"select",name:"estado",value:a.estado,className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200",children:[e.jsx("option",{value:"",children:"Seleccione un Estado"}),["Amazonas","Anzoátegui","Apure","Aragua","Barinas","Bolívar","Carabobo","Cojedes","Delta Amacuro","Distrito Capital","Falcón","Guárico","Lara","Mérida","Miranda","Monagas","Nueva Esparta","Portuguesa","Sucre","Táchira","Trujillo","Vargas","Yaracuy","Zulia"].map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsx(d,{name:"estado",component:"div",className:"text-red-600 text-sm"})]}),e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Teléfono:"}),e.jsx(m,{type:"text",name:"phone",placeholder:"Ejem (4142611966)",className:"mt-1 p-3 border border-gray-300 rounded-lg"}),e.jsx(d,{name:"phone",component:"div",className:"text-red-500"})]}),e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Dirección:"}),e.jsx(m,{type:"text",name:"Direccion",placeholder:"Indique su direccion",className:"mt-1 p-3 border border-gray-300 rounded-lg"}),e.jsx(d,{name:"Direccion",component:"div",className:"text-red-500"})]}),e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Ubicación:"}),e.jsx("div",{className:"flex items-center mt-1 border border-gray-300 rounded-lg focus-within:ring-2 focus-within:ring-blue-500",children:e.jsx(oa,{data:g,save:c})}),e.jsx(d,{name:"ubicacion",component:"div",className:"text-red-500 text-sm mt-1"})]}),e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Contraseña:"}),e.jsx(m,{type:"password",name:"password",className:"mt-1 p-3 border border-gray-300 rounded-lg"}),e.jsx(d,{name:"password",component:"div",className:"text-red-500"})]}),e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Confirmar Contraseña:"}),e.jsx(m,{type:"password",name:"confirmPassword",className:"mt-1 p-3 border border-gray-300 rounded-lg"}),e.jsx(d,{name:"confirmPassword",component:"div",className:"text-red-500"})]}),e.jsxs("div",{className:"text-right mt-6",children:[e.jsx(f,{variant:"default",onClick:()=>{y(!1)},className:"mr-2",children:"Cancelar"}),e.jsx(f,{type:"submit",style:{backgroundColor:"#000B7E"},className:"text-white hover:opacity-80",children:"Crear Taller"})]})]})})})]})]})},Fr=ta;export{Fr as default};
