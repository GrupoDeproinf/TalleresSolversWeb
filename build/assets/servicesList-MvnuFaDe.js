import{u as A,r as c,j as e,a9 as B,a8 as _,a7 as R,aa as D}from"./index-0JW14Cl4.js";import{P as oe}from"./index-b0erAvUs.js";import{T as E}from"./index-a8YK1BSZ.js";import{B as P}from"./Button-D58LGLsw.js";import{D as ce}from"./Dialog-PNbmhsuG.js";import{t as ne,N as de}from"./toast-BZUDBRx8.js";import{O as me,D as ue,P as ge}from"./index.esm-YV82YYEg.js";import{q as he,p as xe,t as ve,u as pe,s as M,v as je,h as fe}from"./index.esm-WNi23VL7.js";import{u as Ne,f as I,g as be,a as ye,b as Se}from"./index-q-FCLJof.js";import"./context-AxDKAhEU.js";import"./index-pO4z0aep.js";import"./index-Jck-JtMN.js";import"./CloseButton-MFjMnfDD.js";import"./motion-AtCGOUgk.js";import"./useTimeout-1ZYN8nxV.js";import"./StatusIcon-AFB-bwed.js";import"./chainedFunction-ltcSYACe.js";const Ve=()=>{A(s=>s.auth.user.authority),A(s=>s.auth.user.key);const[L,H]=c.useState([]),[we,K]=c.useState([]),[g,O]=c.useState("nombre_servicio"),[m,p]=c.useState(""),[u,$]=c.useState("todos"),[k,j]=c.useState([]),[V,z]=c.useState([]),[f,q]=c.useState(1),[h]=c.useState(10),[i,N]=c.useState(null),[G,b]=c.useState(!1),y=async()=>{try{const s=R(_(B,"Servicios")),a=R(_(B,"Usuarios")),[t,r]=await Promise.all([D(s),D(a)]),n=t.docs.map(l=>({...l.data(),id:l.id})),o=r.docs.map(l=>({...l.data(),id:l.id})).filter(l=>l.typeUser==="Taller");H(n),K(o)}catch(s){console.error("Error fetching data:",s)}};c.useEffect(()=>{y()},[]),c.useEffect(()=>{X()},[m,u,g]);const Q=async()=>{await y(),ne.push(e.jsx(de,{title:"Datos actualizados",children:"La tabla ha sido actualizada con éxito."}))},U=s=>{const a=s.target.value;p(a)},J=s=>{const a=s.target.value;O(a),p("")},W=s=>{const a=s.target.value;$(a)},X=()=>{const s=[];m.trim()&&s.push({id:g,value:m.toLowerCase()}),u!=="todos"&&s.push({id:"estatus",value:u==="activo"}),console.log("Aplicando filtros:",s),j(s)},S=s=>s?e.jsxs("div",{className:"flex items-center text-green-600",children:[e.jsx(he,{className:"mr-1"}),e.jsx("span",{children:"Activo"})]}):e.jsxs("div",{className:"flex items-center text-red-600",children:[e.jsx(xe,{className:"mr-1"}),e.jsx("span",{children:"Inactivo"})]}),w=s=>s==="local"?e.jsxs("div",{className:"flex items-center text-blue-600",children:[e.jsx(ve,{className:"mr-1"}),e.jsx("span",{children:"En el Local"})]}):e.jsxs("div",{className:"flex items-center text-purple-600",children:[e.jsx(pe,{className:"mr-1"}),e.jsx("span",{children:"A Domicilio"})]}),C=s=>{const a=[],t=Math.floor(s),r=s%1!==0;for(let o=0;o<t;o++)a.push(e.jsx(M,{className:"text-yellow-400"},o));r&&a.push(e.jsx(je,{className:"text-yellow-400"},"half"));const n=5-Math.ceil(s);for(let o=0;o<n;o++)a.push(e.jsx(M,{className:"text-gray-300"},`empty-${o}`));return e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex",children:a}),e.jsxs("span",{className:"ml-2 text-sm text-gray-600",children:["(",s,")"]})]})},Y=s=>{N(s),b(!0)},x=()=>{b(!1),N(null)},Z=[{header:"Imagen",accessorKey:"service_image",cell:({row:s})=>{const a=s.original,t=a.service_image;return t&&t.length>0?e.jsx("div",{className:"flex items-center",children:e.jsx("img",{src:t[0],alt:a.nombre_servicio,className:"w-12 h-12 object-cover rounded-lg"})}):e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",children:e.jsx(fe,{className:"text-gray-400"})})})}},{header:"Nombre del Servicio",accessorKey:"nombre_servicio",cell:({row:s})=>{const a=s.original;return e.jsx("div",{className:"font-medium text-gray-900",children:a.nombre_servicio})}},{header:"Taller",accessorKey:"taller",cell:({row:s})=>{const a=s.original;return e.jsx("div",{className:"text-gray-700",children:a.taller})}},{header:"Categoría",accessorKey:"categoria",cell:({row:s})=>{const a=s.original;return e.jsx("div",{className:"text-gray-700",children:a.categoria||a.nombre_categoria})}},{header:"Subcategoría",accessorKey:"subcategoria",cell:({row:s})=>{const t=s.original.subcategoria;return typeof t=="string"?e.jsx("div",{className:"text-gray-700",children:t}):Array.isArray(t)&&t.length>0?e.jsx("div",{className:"text-gray-700",children:t.map((r,n)=>e.jsxs("span",{children:[r.nombre_subcategoria||r.nombre||r,n<t.length-1&&", "]},n))}):t&&typeof t=="object"?e.jsx("div",{className:"text-gray-700",children:t.nombre_subcategoria||t.nombre||"N/A"}):e.jsx("div",{className:"text-gray-700",children:"N/A"})}},{header:"Precio",accessorKey:"precio",cell:({row:s})=>{const a=s.original,t=parseFloat(a.precio||"0");return e.jsxs("div",{className:"font-semibold text-green-600",children:["$",t.toLocaleString()]})}},{header:"Tipo de Servicio",accessorKey:"typeService",cell:({row:s})=>{const a=s.original;return w(a.typeService||"local")}},{header:"Estado",accessorKey:"estatus",cell:({row:s})=>{const a=s.original;return S(a.estatus||!1)}},{header:"Puntuación",accessorKey:"puntuacion",cell:({row:s})=>{const a=s.original;return C(a.puntuacion||0)}},{header:"Acciones",cell:({row:s})=>{const a=s.original;return e.jsx("div",{className:"flex gap-2",children:e.jsxs(P,{size:"sm",variant:"default",onClick:()=>Y(a),className:"flex items-center gap-1",children:[e.jsx(ge,{className:"w-4 h-4"}),"Ver Detalles"]})})}}],{Tr:F,Th:ee,Td:se,THead:ae,TBody:te}=E,v=Ne({data:L,columns:Z,state:{sorting:V,columnFilters:k},onSortingChange:z,onColumnFiltersChange:j,getCoreRowModel:be(),getSortedRowModel:ye(),getFilteredRowModel:Se(),filterFns:{customFilter:(s,a,t)=>{const r=s.getValue(a);if(r==null)return!1;if(a==="estatus"){const l=!!r,d=!!t;return console.log(`Filtro estatus - cellValue: ${r}, cellBool: ${l}, filterValue: ${t}, filterBool: ${d}, resultado: ${l===d}`),l===d}const n=String(r).toLowerCase(),o=String(t).toLowerCase();return Array.isArray(r)?r.some(l=>typeof l=="object"&&l!==null?Object.values(l).some(d=>String(d).toLowerCase().includes(o)):String(l).toLowerCase().includes(o)):typeof r=="object"&&r!==null?Object.values(r).some(l=>String(l).toLowerCase().includes(o)):n.includes(o)}},globalFilterFn:"customFilter"}),re=v.getRowModel().rows.length,le=s=>{q(s)},T=(f-1)*h,ie=T+h;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsxs("h1",{className:"mb-6 flex justify-start items-center space-x-4",children:[e.jsx("span",{className:"text-[#000B7E]",children:"Servicios de Talleres"}),e.jsx("button",{className:"p-2 bg-slate-100 hover:bg-slate-200 active:bg-slate-300 transition-all duration-200 shadow-md transform hover:scale-105 rounded-md",onClick:Q,children:e.jsx(me,{className:"w-5 h-5 text-gray-700 hover:text-blue-500 transition-colors duration-200"})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"relative w-32",children:e.jsxs("select",{className:"h-10 w-full py-2 px-4 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:J,value:g,children:[e.jsx("option",{value:"",disabled:!0,children:"Seleccionar columna..."}),e.jsx("option",{value:"nombre_servicio",children:"Nombre del Servicio"}),e.jsx("option",{value:"taller",children:"Taller"}),e.jsx("option",{value:"categoria",children:"Categoría"}),e.jsx("option",{value:"subcategoria",children:"Subcategoría"}),e.jsx("option",{value:"precio",children:"Precio"})]})}),e.jsx("div",{className:"relative w-32 ml-4",children:e.jsxs("select",{className:"h-10 w-full py-2 px-4 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:W,value:u,children:[e.jsx("option",{value:"todos",children:"Todos"}),e.jsx("option",{value:"activo",children:"Activo"}),e.jsx("option",{value:"inactivo",children:"Inactivo"})]})}),e.jsxs("div",{className:"relative w-70 ml-4",children:[e.jsx("input",{type:"text",placeholder:"Buscar...",className:"w-full py-2 px-4 pl-10 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 h-10",value:m,onChange:U}),e.jsx(ue,{className:"absolute left-3 top-5 transform -translate-y-1/2 text-gray-500 w-5 h-5"})]})]})})]}),e.jsxs("div",{className:"p-3 rounded-lg shadow",children:[e.jsxs(E,{className:"w-full rounded-lg",children:[e.jsx(ae,{children:v.getHeaderGroups().map(s=>e.jsx(F,{children:s.headers.map(a=>e.jsx(ee,{colSpan:a.colSpan,children:a.isPlaceholder?null:e.jsx("div",{className:a.column.getCanSort()?"cursor-pointer select-none":"",onClick:a.column.getToggleSortingHandler(),children:I(a.column.columnDef.header,a.getContext())})},a.id))},s.id))}),e.jsx(te,{children:v.getRowModel().rows.slice(T,ie).map(s=>e.jsx(F,{children:s.getVisibleCells().map(a=>e.jsx(se,{children:I(a.column.columnDef.cell,a.getContext())},a.id))},s.id))})]}),e.jsx(oe,{onChange:le,currentPage:f,totalRows:re,rowsPerPage:h})]}),e.jsx(ce,{isOpen:G,onClose:x,onRequestClose:x,width:"90%",height:"85vh",contentClassName:"max-h-[90vh] overflow-y-auto sm:mt-16 sm:mb-24",closable:!1,children:i&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-[#000B7E]",children:"Detalles del Servicio"}),e.jsx(P,{variant:"default",onClick:x,className:"px-6 py-2 bg-red-500 text-red-500 hover:bg-red-600 border-red-500 hover:text-white hover:border-red-600 transition-all duration-200 shadow-md hover:shadow-lg transform hover:scale-105",children:"✕ Cerrar"})]}),e.jsxs("div",{className:"space-y-6",children:[i.service_image&&i.service_image.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Imágenes del Servicio"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:i.service_image.map((s,a)=>e.jsx("img",{src:s,alt:`Imagen ${a+1}`,className:"w-full h-32 object-cover rounded-lg shadow-md hover:shadow-lg transition-shadow"},a))})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-[#000B7E]",children:"Información Básica"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Nombre:"}),e.jsx("p",{className:"text-gray-900 font-semibold",children:i.nombre_servicio})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Taller:"}),e.jsx("p",{className:"text-gray-900",children:i.taller})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Precio:"}),e.jsxs("p",{className:"text-green-600 font-bold text-lg",children:["$",parseFloat(i.precio||"0").toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Estado:"}),e.jsx("div",{className:"mt-1",children:S(i.estatus||!1)})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-[#000B7E]",children:"Categorización"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Categoría:"}),e.jsx("p",{className:"text-gray-900",children:i.categoria||i.nombre_categoria})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Subcategoría:"}),e.jsx("p",{className:"text-gray-900",children:(()=>{const s=i.subcategoria;return typeof s=="string"?s:Array.isArray(s)&&s.length>0?s.map((a,t)=>e.jsxs("span",{children:[a.nombre_subcategoria||a.nombre||a,t<s.length-1&&", "]},t)):s&&typeof s=="object"&&(s.nombre_subcategoria||s.nombre)||"N/A"})()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Tipo de Servicio:"}),e.jsx("div",{className:"mt-1",children:w(i.typeService||"local")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Puntuación:"}),e.jsx("div",{className:"mt-1",children:C(i.puntuacion||0)})]})]})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-[#000B7E]",children:"Descripción"}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:i.descripcion})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-[#000B7E]",children:"Garantía"}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:i.garantia})]})]})]})})]})};export{Ve as default};
