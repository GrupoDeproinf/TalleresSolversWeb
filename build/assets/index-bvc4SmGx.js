import{r as n,u as U,j as e,a9 as x,a8 as j,a7 as S,aa as C,ag as ke,ap as Me,ae as Be,aj as Le,ak as Ue,al as qe,am as $e,af as Y}from"./index-ATNefdVG.js";import{P as Fe}from"./index-Rjm_CfUD.js";import{T as J}from"./index-1QBWWPtH.js";import"./Alert-YDCIg78L.js";import"./index-74gKM8Gk.js";import"./Badge-7j32ABcM.js";import{B as E}from"./Button-m8cr7QK0.js";import"./Calendar-kXRbY7HP.js";import"./Card-OSPH2pm3.js";import"./index-J2oOIxTS.js";import"./index-Ww4KSR8x.js";import"./Dialog-01bjbLh0.js";import{D as Ge}from"./Drawer-TF5epqni.js";import"./index-OgT6bzbj.js";import"./FormItem-YT9PXtwB.js";import"./Input-esXMioi-.js";import"./index-Yk7DAYzs.js";import"./index-AdZu4ZEf.js";import"./index-Njt5DKLW.js";import{t as b,N as h}from"./toast-ArUM2hkn.js";import"./Progress-8N-5zDn7.js";import"./index-Xj1V1DYV.js";import"./RangeCalendar-KFdi8RAV.js";import"./ScrollBar-wOU87srT.js";import"./index-wOmcTQB3.js";import{d as W}from"./Select-meFjX2OX.js";import"./Skeleton-rqvm5li9.js";import"./index-yyjad8ES.js";import"./Switcher-Q2_gTjX7.js";import"./index-8Ze0HwPQ.js";import"./Tag-jU5n4W4w.js";import"./index-9p-8nnWt.js";import"./index-O5FvOx90.js";import"./Tooltip-RPBixJuV.js";import"./Upload-sm3Naufp.js";import{u as He,f as X,g as Ke,a as Qe,b as ze}from"./index-mu3rsG90.js";import{h as Oe}from"./index.esm-SLyUBwzt.js";import{c as Ye,a as _,b as Je,g as We}from"./index.esm-veTBKOrz.js";import{O as Xe,D as Ze}from"./index.esm-RzyebFAI.js";import{F as Ve,a as ea,b as f,E as v}from"./formik.esm-dqEqoyez.js";import"./useTimeout-1ykP9PCU.js";import"./CloseButton-27bnAAMk.js";import"./StatusIcon-yBHceAv6.js";import"./motion-qY3QHwHT.js";import"./useMergeRef-Rt_Crb27.js";import"./context-GUUKwgTl.js";import"./useControllableState-TaiAnLFv.js";import"./cloneDeep-yGYZIkRg.js";import"./_getAllKeys-eyRctv10.js";import"./_MapCache-_63I7Bc7.js";import"./Views-oxXEUsSY.js";import"./_baseIsEqual-u0EOHXHy.js";import"./get-GDY1XD6s.js";import"./toString-LadLPz1K.js";import"./floating-ui.react-6woUHVe8.js";import"./floating-ui.dom-0rLBacrf.js";import"./TimeInput-EwrvAjFc.js";import"./useUniqueId-q2Q7KHj7.js";import"./useDidUpdate-R-Sv0J0Y.js";import"./index-lc_qXIiG.js";import"./index-D5lh9mO-.js";import"./useRootClose-2Ks0vhqk.js";import"./isNil-qbgWSuln.js";import"./index-LDVYzlxf.js";import"./chainedFunction-ltcSYACe.js";import"./toConsumableArray-YYxflNc8.js";import"./objectWithoutPropertiesLoose-pdUxmcoj.js";import"./setPrototypeOf-ahVgEFUp.js";import"./mapCloneElement-I1EKrR-t.js";import"./index.esm-6sKRXwnY.js";import"./index.esm-5SxxohUP.js";const aa=()=>{n.useState("local");const y=U(a=>a.auth.user.authority),Z=U(a=>a.auth.user.key),V=U(a=>a.auth.user.userName),ee=y==null?void 0:y.includes("Admin"),[R,ae]=n.useState([]),[q,re]=n.useState([]),[se,P]=n.useState([]),[$,oe]=n.useState("nombre_servicio"),[T,ie]=n.useState(""),[ra,te]=n.useState(null),[sa,ce]=n.useState([]),[ne,le]=n.useState([]),I=async()=>{try{const a=S(j(x,"Usuarios")),s=S(j(x,"Categorias")),c=S(j(x,"Servicios")),d=S(j(x,"ServiciosTemplate")),[m,N,r,t]=await Promise.all([C(a),C(s),C(c),C(d)]),l=m.docs.map(i=>({...i.data(),id:i.id})).filter(i=>{var p;return i.typeUser==="Taller"&&((p=i.subscripcion_actual)==null?void 0:p.status)==="Aprobado"}).sort((i,p)=>i.nombre.localeCompare(p.nombre)),u=N.docs.map(i=>({...i.data(),uid_categoria:i.id})),g=r.docs.map(i=>({...i.data(),id:i.id})),D=t.docs.map(i=>({...i.data(),uid_servicio:i.id}));ae(l),re(u),ce(g),le(D)}catch(a){console.error("Error fetching data:",a)}};n.useEffect(()=>{I()},[]);const de=async()=>{await I(),b.push(e.jsx(h,{title:"Datos actualizados",children:"La tabla ha sido actualizada con éxito."}))},me=async a=>{if(te(a),!a){P([]);return}try{const s=S(j(x,"Categorias",a,"Subcategorias")),d=(await C(s)).docs.map(m=>({...m.data(),uid_subcategoria:m.id,nombre_subcategoria:m.data().nombre}));P(d)}catch(s){console.error("Error fetching subcategorias:",s),P([])}},[oa,F]=n.useState(null),[ue,w]=n.useState(!1),[o,A]=n.useState({nombre_servicio:"",descripcion:"",uid_categoria:"",nombre_categoria:"",subcategoria:[],precio:0,uid_servicio:"",typeService:"",estatus:!0,garantia:"",service_image:[],service_image_files:[]}),ge=Ye({nombre_servicio:_().required("El nombre del servicio es obligatorio.").min(3,"El nombre del servicio debe tener al menos 3 caracteres."),descripcion:_().required("La descripción es obligatoria.").min(10,"La descripción debe tener al menos 10 caracteres."),uid_categoria:_().required("La categoría es obligatoria."),subcategoria:Je().min(1,"Debes elegir al menos una subcategoría").required("Las subcategorías son obligatorias."),uid_taller:_().required("El taller es obligatorio."),precio:We().required("El precio es obligatorio.").positive("El precio debe ser un valor positivo.").typeError("El precio debe ser un número."),garantia:_().required("La garantía es obligatoria."),typeService:_().required("Debe seleccionar un tipo de servicio")}),pe=async a=>{var s,c;console.log("Valores enviados a handleCreateService: ",a);try{const d=ke(x,"Usuarios",a.uid_taller),m=await Me(d);if(!m.exists()){b.push(e.jsx(h,{title:"Error",children:"El taller seleccionado no existe."}));return}const r=(s=m.data().subscripcion_actual)==null?void 0:s.cantidad_servicios;if(r<=0){b.push(e.jsx(h,{title:"Error",children:"Este taller no tiene más servicios disponibles para crear."}));return}const t=j(x,"Servicios"),l=await Be(t,{nombre_servicio:a.nombre_servicio,descripcion:a.descripcion,nombre_categoria:a.nombre_categoria,uid_categoria:a.uid_categoria,subcategoria:a.subcategoria,precio:a.precio,uid_taller:a.uid_taller,taller:a.taller,uid_servicio:"",garantia:a.garantia,typeService:a.typeService,estatus:!0,service_image:[]}),u=l.id,g=a.service_image_files;if(console.log("Aquí están las imagenes: ",g),!g||g.length===0){b.push(e.jsx(h,{title:"Error",children:"Debes seleccionar al menos una imagen."}));return}const D=[];for(let i=0;i<g.length;i++){const p=g[i],L=(c=p.name.split(".").pop())==null?void 0:c.toLowerCase();if(!L||!["png","jpg","jpeg","webp"].includes(L)){b.push(e.jsx(h,{title:"Error",children:"Tipo de archivo no soportado. Solo se permiten imágenes."}));return}const O=Ue(Le,`service_images/${u}_${i+1}.${L}`);await qe(O,p);const Ae=await $e(O);D.push(Ae)}await Y(l,{uid_servicio:u,service_image:D}),await Y(d,{"subscripcion_actual.cantidad_servicios":r-1}),b.push(e.jsx(h,{title:"Éxito",children:"Servicio creado con éxito."})),A({nombre_servicio:"",descripcion:"",uid_servicio:"",uid_categoria:"",nombre_categoria:"",subcategoria:[],precio:0,uid_taller:"",taller:"",garantia:"",typeService:"",estatus:!0,service_image:[],service_image_files:[]}),Ie(!1),w(!1),I()}catch(d){console.error("Error creando Servicio:",d),b.push(e.jsx(h,{title:"Error",children:"Hubo un error al crear el Servicio."}))}},xe=()=>{F(null),A({nombre_servicio:"",descripcion:"",uid_categoria:"",nombre_categoria:"",subcategoria:[],precio:0,uid_servicio:"",garantia:"",typeService:""}),w(!0)},be=a=>{F(a),A({nombre_servicio:a.nombre_servicio||"",descripcion:a.descripcion||"",uid_categoria:a.uid_categoria||"",nombre_categoria:a.nombre_categoria||"",subcategoria:a.subcategoria||[],precio:a.precio||0,uid_servicio:a.uid_servicio||"",garantia:a.garantia||""}),w(!0)},[he,k]=n.useState([]),fe=a=>{const s=a.target.value;ie(s),k([{id:$,value:s}])},ve=a=>{const s=a.target.value;oe(s),T!==""&&k([{id:s,value:T}])},je=[{header:"Nombre del Servicio",accessorKey:"nombre_servicio"},{header:"Descripción",accessorKey:"descripcion"},{header:"Categoría",accessorKey:"nombre_categoria"},{header:"Subcategorías",accessorKey:"subcategoria",cell:({row:a})=>{const s=a.original.subcategoria;return!Array.isArray(s)||s.length===0?e.jsx("span",{children:"No posee"}):e.jsx("ul",{children:s.map(c=>e.jsx("li",{children:c.nombre_subcategoria},c.uid_subcategoria))})}},{header:"Garantía",accessorKey:"garantia"},{header:"Precio",accessorKey:"precio"},{header:" ",cell:({row:a})=>{const s=a.original;return e.jsx("div",{className:"flex gap-2",children:e.jsx(E,{style:{backgroundColor:"#000B7E"},className:"text-white hover:opacity-80",onClick:()=>be(s),children:"Usar Plantilla"})})}}],{Tr:G,Th:_e,Td:ye,THead:Ne,TBody:Se,Sorter:ia}=J,[Ce,we]=n.useState([]),M=He({data:ne,columns:je,state:{sorting:Ce,columnFilters:he},onSortingChange:we,onColumnFiltersChange:k,getCoreRowModel:Ke(),getSortedRowModel:Qe(),getFilteredRowModel:ze()}),[H,K]=n.useState(1),[B,De]=n.useState(10),Ee=M.getRowModel().rows.length,Re=a=>{K(a)},Pe=a=>{De(a),K(1)},Q=(H-1)*B,Te=Q+B,[ca,Ie]=n.useState(!1),z=a=>{console.log("Drawer cerrado",a),w(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsxs("h1",{className:"mb-6 flex justify-start items-center space-x-4",children:[" ",e.jsx("span",{className:"text-[#000B7E]",children:"Asignar Servicios a Talleres"}),e.jsx("button",{className:"p-2  bg-slate-100 hover:bg-slate-200 active:bg-slate-300 transition-all duration-200 shadow-md transform hover:scale-105 rounded-md",onClick:de,children:e.jsx(Xe,{className:"w-5 h-5 text-gray-700 hover:text-blue-500 transition-colors duration-200"})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"relative w-32",children:[" ",e.jsxs("select",{className:"h-10 w-full py-2 px-4 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:ve,value:$,children:[e.jsx("option",{value:"",disabled:!0,children:"Seleccionar columna..."}),e.jsx("option",{value:"nombre_servicio",children:"Nombre"}),e.jsx("option",{value:"nombre_categoria",children:"Categoria"}),e.jsx("option",{value:"typeService",children:"Tipo de Servicio"})]})]}),e.jsxs("div",{className:"relative w-70 ml-4",children:[e.jsx("input",{type:"text",placeholder:"Buscar...",className:"w-full py-2 px-4 pl-10 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 h-10",value:T,onChange:fe}),e.jsx(Ze,{className:"absolute left-3 top-5 transform -translate-y-1/2 text-gray-500 w-5 h-5"})]}),e.jsx(E,{style:{backgroundColor:"#000B7E"},className:"w-40 ml-4 text-white hover:opacity-80",onClick:xe,children:"Crear Servicio"})]})})]}),e.jsxs("div",{className:"p-3 rounded-lg shadow",children:[e.jsxs(J,{className:"w-full  rounded-lg",children:[e.jsx(Ne,{children:M.getHeaderGroups().map(a=>e.jsx(G,{children:a.headers.map(s=>e.jsx(_e,{colSpan:s.colSpan,children:s.isPlaceholder?null:e.jsx("div",{className:s.column.getCanSort()?"cursor-pointer select-none":"",onClick:s.column.getToggleSortingHandler(),children:X(s.column.columnDef.header,s.getContext())})},s.id))},a.id))}),e.jsx(Se,{children:M.getRowModel().rows.slice(Q,Te).map(a=>e.jsx(G,{children:a.getVisibleCells().map(s=>e.jsx(ye,{children:X(s.column.columnDef.cell,s.getContext())},s.id))},a.id))})]}),e.jsx(Fe,{onChange:Re,currentPage:H,totalRows:Ee,rowsPerPage:B,onRowsPerPageChange:Pe})]}),e.jsxs(Ge,{isOpen:ue,onClose:z,className:"rounded-md shadow",children:[e.jsx("h2",{className:"mb-4 text-xl font-bold",children:"Crear Servicio"}),e.jsx(Ve,{initialValues:{nombre_servicio:(o==null?void 0:o.nombre_servicio)||"",descripcion:(o==null?void 0:o.descripcion)||"",uid_categoria:(o==null?void 0:o.uid_categoria)||"",nombre_categoria:(o==null?void 0:o.nombre_categoria)||"",service_image:[],service_image_files:[],uid_taller:y==="Admin"?(o==null?void 0:o.uid_taller)||"":Z,taller:y==="Admin"?(o==null?void 0:o.taller)||"":V,precio:(o==null?void 0:o.precio)||"",garantia:(o==null?void 0:o.garantia)||"",typeService:"local",subcategoria:(o==null?void 0:o.subcategoria)||[]},validationSchema:ge,onSubmit:pe,children:({values:a,handleChange:s,setFieldValue:c,errors:d,touched:m})=>{var N;return e.jsxs(ea,{className:"flex flex-col space-y-6",children:[e.jsx("div",{className:"mt-2 flex flex-col items-center rounded-lg border border-dashed border-gray-900/25 px-6 py-10",children:e.jsxs("div",{className:"text-center",children:[Array.isArray(a.service_image)&&a.service_image.length>0?e.jsx("div",{className:"grid grid-cols-3 gap-4",children:a.service_image.map((r,t)=>e.jsx("img",{src:r,alt:`Preview ${t+1}`,className:"h-32 w-32 object-cover rounded-md"},t))}):e.jsx(Oe,{className:"mx-auto h-12 w-12 text-gray-300","aria-hidden":"true"}),e.jsxs("div",{className:"mt-4 flex flex-col text-sm leading-6 text-gray-600 justify-center",children:[e.jsxs("label",{htmlFor:"images-upload",className:"relative cursor-pointer rounded-md bg-white font-semibold text-indigo-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-indigo-600 focus-within:ring-offset-2 hover:text-indigo-500 flex justify-center items-center",children:[e.jsx("span",{children:"Agregar otra imagen"}),e.jsx("input",{id:"images-upload",name:"images-upload",type:"file",accept:"image/*",multiple:!0,className:"sr-only",onChange:r=>{const t=Array.from(r.target.files||[]),l=t.map(u=>URL.createObjectURL(u));c("service_image",[...a.service_image||[],...l]),c("service_image_files",[...a.service_image_files||[],...t])}})]}),((N=a.service_image_files)==null?void 0:N.length)===0&&e.jsx("p",{className:"text-red-600 mt-2",children:"Debes seleccionar al menos una imagen."})]})]})}),e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Nombre Servicio:"}),e.jsx(f,{type:"text",name:"nombre_servicio",value:a.nombre_servicio,onChange:s,className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200"}),e.jsx(v,{name:"nombre_servicio",component:"div",className:"text-red-600 text-sm"})]}),ee&&e.jsx("div",{children:e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Taller:"}),e.jsx("div",{className:"relative",children:e.jsx(W,{name:"uid_taller",options:R.map(r=>({label:r.nombre,value:r.uid})),value:R.map(r=>({label:r.nombre,value:r.uid})).find(r=>r.value===a.uid_taller)||null,onChange:r=>{const t=R.find(l=>l.uid===(r==null?void 0:r.value));c("uid_taller",(r==null?void 0:r.value)||""),c("taller",(t==null?void 0:t.nombre)||"")},placeholder:"Buscar taller...",className:"w-full mt-1 p-3 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200",isClearable:!0,isSearchable:!0})}),e.jsx(v,{name:"uid_taller",component:"div",className:"text-red-600 text-sm"})]})}),e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Tipo de Servicio:"}),e.jsxs("div",{className:"flex items-center space-x-10",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx(f,{type:"radio",name:"typeService",value:"local",className:"form-radio"}),e.jsx("span",{children:"En el Local"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx(f,{type:"radio",name:"typeService",value:"domicilio",className:"form-radio"}),e.jsx("span",{children:"A Domicilio"})]})]}),e.jsx(v,{name:"typeService",component:"div",className:"text-red-600 text-sm"})]}),e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Categoría:"}),e.jsxs(f,{as:"select",name:"uid_categoria",value:a.uid_categoria,onChange:r=>{const t=r.target.value,l=q.find(u=>u.uid_categoria===t);c("uid_categoria",t),c("nombre_categoria",(l==null?void 0:l.nombre)||""),c("subcategoria",[]),me(t)},className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200",children:[e.jsx("option",{value:"",children:"Seleccione una categoría"}),q.map(r=>e.jsx("option",{value:r.uid_categoria,children:r.nombre},r.uid_categoria))]}),e.jsx(v,{name:"uid_categoria",component:"div",className:"text-red-600 text-sm"})]}),e.jsx("label",{className:"font-semibold text-gray-700",children:"Subcategorías:"}),e.jsx(W,{isMulti:!0,placeholder:"Selecciona subcategorías",noOptionsMessage:()=>"No hay Subcategorías disponibles",options:a.uid_categoria?se.map(r=>({value:r.uid_subcategoria,label:r.nombre})):[],value:a.subcategoria.map(r=>({value:r.uid_subcategoria,label:r.nombre_subcategoria})),onChange:r=>c("subcategoria",r.map(t=>({uid_subcategoria:t.value,nombre_subcategoria:t.label}))),className:"mt-1"}),e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Descripción:"}),e.jsx(f,{as:"textarea",name:"descripcion",value:a.descripcion,onChange:s,rows:1,className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 resize-none overflow-hidden",style:{maxHeight:"150px",overflowY:"auto"},onInput:r=>{r.target.style.height="auto",r.target.style.height=`${r.target.scrollHeight}px`}}),e.jsx(v,{name:"descripcion",component:"div",className:"text-red-600 text-sm"})]}),e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Precio:"}),e.jsx(f,{type:"text",name:"precio",value:a.precio,onChange:s,className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200"}),e.jsx(v,{name:"precio",component:"div",className:"text-red-600 text-sm"})]}),e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Garantía:"}),e.jsx(f,{type:"text",name:"garantia",value:a.garantia,onChange:s,className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200"}),e.jsx(v,{name:"garantia",component:"div",className:"text-red-600 text-sm"})]}),e.jsxs("div",{className:"text-right mt-6",children:[e.jsx(E,{variant:"default",onClick:z,className:"mr-2",children:"Cancelar"}),e.jsx(E,{type:"submit",style:{backgroundColor:"#000B7E"},className:"text-white hover:opacity-80",children:"Guardar"})]})]})}})]})]})},Cr=aa;export{Cr as default};
