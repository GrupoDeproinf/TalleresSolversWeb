import{j as e,r as c,a9 as T,a8 as R,aa as E}from"./index-539wkWb6.js";import{C as k}from"./Card-3d2Ny-JF.js";import{B as G}from"./Badge-wxO0V_gq.js";import{C as J}from"./Chart-lC7p_EZg.js";import{C as O,_ as Q}from"./chart.constant-5IF0PaJE.js";import{B}from"./Button-lbbOHDaq.js";import{a as A}from"./Views-NOUPq-xv.js";import{P as Y}from"./index-8q23-vPJ.js";import{u as Z,f as I,g as ee,a as te,b as se}from"./index-0CnzlX3U.js";import{s as ae,v as oe,F as re}from"./index.esm-SfcosvjZ.js";import{T as $}from"./index-vfq4_N5K.js";import"./chart.config-ygnLHE4M.js";import"./index-1cVp-vaj.js";import"./context-GzcGESCG.js";const ne=({data:a={labels:[],data:[],colors:[]}})=>e.jsx(k,{children:e.jsx("div",{className:"mt-6",children:a.data.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(J,{donutTitle:`${a.data.reduce((i,l)=>i+l,0)}`,donutText:"Cantidad de Talleres",series:a.data,customOptions:{labels:a.labels,colors:a.colors.length?a.colors:O},type:"donut"}),a.data.length===a.labels.length&&e.jsx("div",{className:"mt-6 grid grid-cols-2 gap-4 max-w-[180px] mx-auto",children:a.labels.map((i,l)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{badgeStyle:{backgroundColor:a.colors[l]||O[l]}}),e.jsx("span",{className:"font-semibold",children:i})]},i))})]})})}),ce=()=>{const[a,i]=c.useState([]),[l,y]=c.useState([]),[r,u]=c.useState(0);return c.useEffect(()=>{(async()=>{try{const m=(await E(R(T,"Subscripciones"))).docs.map(s=>s.data()),w=new Date,b=new Date(w);b.setDate(w.getDate()-(w.getDay()+7*r)),new Date(b).setDate(b.getDate()+6);const F=s=>s.toISOString().split("T")[0],j=Array.from({length:7},(s,p)=>{const f=new Date(b);return f.setDate(b.getDate()+p),F(f)}),S={},C={};j.forEach(s=>{S[s]=0,C[s]=0}),m.forEach(s=>{const p=s.fechaCreacion?s.fechaCreacion.toDate().toISOString().split("T")[0]:void 0,f=s.fecha_inicio?s.fecha_inicio.toDate().toISOString().split("T")[0]:void 0;p&&S[p]!==void 0&&S[p]++,f&&s.comprobante_pago&&C[f]!==void 0&&C[f]++});const D=j.map(s=>S[s]),v=j.map(s=>C[s]);i([{name:"Subscripciones Diarias",data:D},{name:"Subscripciones Pagas",data:v}]),y(j)}catch(d){console.error("Error al obtener datos de subscripciones:",d)}})()},[r]),e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between"},children:[e.jsx(B,{onClick:()=>u(r+1),style:{backgroundColor:"#000B7E"},className:"text-white hover:opacity-80",children:"Semana Anterior"}),e.jsx(B,{onClick:()=>u(0),style:{backgroundColor:"#000B7E"},className:"text-white hover:opacity-80",children:"Semana Actual"}),e.jsx(B,{onClick:()=>u(r-1),style:{backgroundColor:"#000B7E"},className:"text-white hover:opacity-80",children:"Semana Siguiente"})]}),e.jsx(Q,{options:{chart:{id:"spline-area-chart"},dataLabels:{enabled:!1},colors:O,stroke:{curve:"smooth"},xaxis:{type:"datetime",categories:l,labels:{formatter:function(x){const d=new Date(x);return new Intl.DateTimeFormat("es-ES",{day:"2-digit",month:"short",year:"numeric"}).format(d)}}},tooltip:{x:{format:"yyyy-MM-dd"}}},series:a,type:"area",height:300})]})},ie=async()=>{const a=await E(R(T,"Usuarios")),i=await E(R(T,"Subscripciones"));let l=0,y=0,r={aprobados:0,pendientes:0,rechazados:0,espera:0},u=0,x=0;return a.forEach(d=>{const m=d.data();if(m.typeUser==="Cliente"&&l++,m.typeUser==="Taller")switch(y++,m.status){case"Aprobado":r.aprobados++;break;case"Pendiente":r.pendientes++;break;case"Rechazado":r.rechazados++;break;case"En espera por aprobación":r.espera++;break}}),i.forEach(d=>{const m=d.data();x+=m.monto||0}),u=i.size,{clientesCount:l,tallerCount:y,talleresStats:r,subscripcionesCount:u,totalMonto:x}},le=()=>{const[a,i]=c.useState({clientesCount:0,tallerCount:0,talleresStats:{aprobados:0,pendientes:0,rechazados:0,espera:0},subscripcionesCount:0,totalMonto:0});c.useEffect(()=>{(async()=>{try{const t=await ie();i(t)}catch(t){console.error("Error al obtener los datos del dashboard:",t)}})()},[]);const[l,y]=c.useState([]),r=async()=>{try{const o=await E(R(T,"Servicios")),t=[];await Promise.all(o.docs.map(async n=>{const N=n.data(),g=n.id,M=(await E(R(T,"Servicios",g,"calificaciones"))).docs.map(z=>({...z.data(),id:z.id}));t.push({nombre_servicio:N.nombre_servicio,taller:N.taller||"Sin taller",uid_servicio:g,calificaciones:M})}));const _=t.map(n=>{const N=n.calificaciones.reduce((P,M)=>P+(M.puntuacion??0),0),g=n.calificaciones.length>0?N/n.calificaciones.length:0;return{nombre_servicio:n.nombre_servicio,taller:n.taller,promedio_puntuacion:g}}).filter(n=>n.promedio_puntuacion>0);y(_)}catch(o){console.error("Error obteniendo los datos:",o)}};c.useEffect(()=>{r()},[]);const u=[{header:"Taller",accessorKey:"taller"},{header:"Servicio",accessorKey:"nombre_servicio"},{header:"Promedio de Calificación",cell:({row:o})=>{const t=o.original.promedio_puntuacion||0,_=5,n=Array.from({length:_},(N,g)=>{const P=g+1;return P<=t?e.jsx(ae,{color:"gold",style:{marginRight:"2px"}},g):P-.5<=t?e.jsx(oe,{color:"gold",style:{marginRight:"2px"}},g):e.jsx(re,{color:"gray",style:{marginRight:"2px"}},g)});return e.jsxs("div",{style:{display:"flex",gap:"2px",alignItems:"center"},children:[e.jsx("div",{style:{display:"flex"},children:n}),e.jsx("span",{style:{marginLeft:"8px"},children:t.toFixed(1)})," "]})}}],{Tr:x,Th:d,Td:m,THead:w,TBody:b,Sorter:H}=$,[F,j]=c.useState([]),[S,C]=c.useState([]),D=Z({data:l,columns:u,state:{sorting:F,columnFilters:S},onSortingChange:j,onColumnFiltersChange:C,getCoreRowModel:ee(),getSortedRowModel:te(),getFilteredRowModel:se()}),[v,s]=c.useState(1),[p,f]=c.useState(10),K=D.getRowModel().rows.length,W=o=>{s(o)},L=o=>{f(o),s(1)},{clientesCount:U,tallerCount:me,talleresStats:h,subscripcionesCount:V,totalMonto:X}=a,q={labels:["Aprobados","Pendientes","Rechazados","En espera por aprobación"],data:[h.aprobados,h.pendientes,h.rechazados,h.espera],colors:["#15803D","#FFC107","#C22F1C","#2196F3"]};return e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsx("a",{href:`${A}/users`,className:"hover:shadow-lg ease-in-out p-4",children:e.jsxs(k,{className:"bg-gray-50 shadow",children:[e.jsx("h5",{className:"text-gray-500 text-base font-semibold",children:"Clientes"}),e.jsx("div",{className:"flex items-center justify-between mt-3",children:e.jsx("p",{className:"text-4xl font-bold text-gray-900",children:U})}),e.jsx("p",{className:"text-base text-gray-500 mt-2",children:"Total de clientes"})]})}),e.jsx("a",{href:`${A}/garages`,className:"hover:shadow-lg ease-in-out p-4",children:e.jsxs(k,{className:"bg-gray-50 shadow",children:[e.jsx("h5",{className:"text-gray-500 text-base font-semibold",children:"Talleres"}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsx("p",{className:"text-4xl font-bold text-gray-900",children:h.aprobados+h.pendientes+h.rechazados+h.espera}),e.jsxs("span",{className:"text-base font-semibold text-red-700 bg-red-100 px-3 py-1 rounded-full",children:[h.espera," en espera"]})]}),e.jsx("p",{className:"text-base text-gray-500 mt-2",children:"Total Talleres"})]})}),e.jsx("a",{href:`${A}/subscriptions`,className:"hover:shadow-lg ease-in-out p-4",children:e.jsxs(k,{className:"bg-gray-50 shadow",children:[e.jsx("h5",{className:"text-gray-500 text-base font-semibold",children:"Subscripciones"}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsx("p",{className:"text-4xl font-bold text-gray-900",children:V}),e.jsxs("span",{className:"text-base font-semibold text-green-700 bg-green-100 px-3 py-1 rounded-full",children:["$",X.toFixed(2)," Total"]})]}),e.jsx("p",{className:"text-base text-gray-500 mt-2",children:"Subscripciones y monto total"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mt-6",children:[e.jsx(ce,{}),e.jsx(ne,{data:q})]}),e.jsxs("div",{className:"p-1 rounded-lg shadow",children:[e.jsx("h2",{className:"mb-4",children:"Calificaciones de los Servicios"}),e.jsxs($,{className:"w-full rounded-lg",children:[e.jsx(w,{children:D.getHeaderGroups().map(o=>e.jsx(x,{children:o.headers.map(t=>e.jsx(d,{colSpan:t.colSpan,children:t.isPlaceholder?null:e.jsx("div",{className:t.column.getCanSort()?"cursor-pointer select-none":"",onClick:t.column.getToggleSortingHandler(),children:I(t.column.columnDef.header,t.getContext())})},t.id))},o.id))}),e.jsx(b,{children:D.getRowModel().rows.slice((v-1)*p,v*p).map(o=>e.jsx(x,{children:o.getVisibleCells().map(t=>e.jsx(m,{children:I(t.column.columnDef.cell,t.getContext())},t.id))},o.id))})]}),e.jsx(Y,{onChange:W,currentPage:v,totalRows:K,rowsPerPage:p,onRowsPerPageChange:L})]})]})},Ne=le;export{Ne as default};
