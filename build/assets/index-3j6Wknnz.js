import{r as c,j as e,a9 as p,a8 as N,a7 as M,aa as O,ae as ye,af as q,ag as z,ah as _e}from"./index-NsbKStwV.js";import{P as Ce}from"./index-51j1pD1k.js";import{T as G}from"./index-WaLOIBvG.js";import{S as K}from"./Select-aNPQ1OPY.js";import{u as Se,f as T,g as we,a as De,b as Ee}from"./index-MFIG_bXP.js";import{e as Re,f as Pe}from"./index.esm-orl39wdU.js";import{B as x}from"./Button-XnwKhdvE.js";import{D as ke}from"./Dialog-M1Ajs5BG.js";import{t as u,N as g}from"./toast-xWR8t_2g.js";import"./Alert-SMRHUaiv.js";import"./index-LXScpEcU.js";import"./Badge-CKoNnQYV.js";import"./Calendar-Z19pUmfw.js";import"./Card-VqsFwQIo.js";import"./index-XuLXFUW7.js";import"./index-bABZBMXE.js";import{D as $}from"./Drawer-kAauoAEG.js";import"./index-1__fuqPr.js";import"./FormItem-a3aLHqrY.js";import"./Input-BlRH7Tqm.js";import"./index-taQNVGTU.js";import"./index-XtR_CO3S.js";import"./index-9eKqhUCi.js";import"./Progress-aKyPi4WI.js";import"./index-N2TpchCk.js";import"./RangeCalendar-ijReFoaZ.js";import"./ScrollBar-CtQyAJP5.js";import"./index-xDsJSmdq.js";import"./Skeleton-2gEbp5HC.js";import"./index-706hdkS9.js";import"./Switcher-XI3kw8Fv.js";import"./index-mAElvMN0.js";import"./Tag-jyrf7RmZ.js";import"./index-R4Junk9C.js";import"./index-1CjGwnct.js";import"./Tooltip-i9ud1ENZ.js";import"./Upload-x6WrsXGM.js";import{c as Me,a as y,V as Oe}from"./index.esm-tcsgx5EQ.js";import{F as L,a as A,b as d,E as l}from"./formik.esm-tsJTNbUL.js";import{O as He,D as Fe}from"./index.esm-DPuKpfEd.js";import"./toConsumableArray-YYxflNc8.js";import"./objectWithoutPropertiesLoose-pdUxmcoj.js";import"./setPrototypeOf-ahVgEFUp.js";import"./floating-ui.dom-0rLBacrf.js";import"./Views-I29_hvdt.js";import"./get-drGJYnu9.js";import"./_MapCache-15Rnayr1.js";import"./toString-HU3AUEZ4.js";import"./context-oRCGbGnv.js";import"./index-L2easzUG.js";import"./index-yS24mju4.js";import"./CloseButton-Nfvz1DXb.js";import"./motion-6wXtmffM.js";import"./useTimeout-xAxzieo9.js";import"./StatusIcon-fXUWXxss.js";import"./chainedFunction-ltcSYACe.js";import"./useMergeRef-Rt_Crb27.js";import"./useControllableState-SENCq9yh.js";import"./cloneDeep-F0eSWZ4E.js";import"./_getAllKeys-J38wVtFO.js";import"./_baseIsEqual-KqoMd6iA.js";import"./floating-ui.react-VCMzFDFm.js";import"./TimeInput-_Q1jn0vG.js";import"./useUniqueId-LIkNGYYo.js";import"./useDidUpdate-hcwSAfYk.js";import"./useRootClose-5GjeXLpt.js";import"./isNil-q3dwsIaU.js";import"./index-7Af8_Ef6.js";import"./mapCloneElement-0IiWevpj.js";import"./index.esm-2Q-50ffC.js";import"./index.esm-U128aQcn.js";const Ie=()=>{const[Q,Y]=c.useState([]),[J,_]=c.useState([]),[U,C]=c.useState(!1),[s,h]=c.useState(null),[H,V]=c.useState("nombre_servicio"),[S,W]=c.useState(""),[X,f]=c.useState(!1),[j,Z]=c.useState([]),[F,w]=c.useState([]),[ee,ae]=c.useState([]),b=async()=>{try{const a=M(N(p,"Categorias")),o=M(N(p,"ServiciosTemplate")),[t,r]=await Promise.all([O(a),O(o)]),i=t.docs.map(m=>({...m.data(),uid_categoria:m.id})),n=r.docs.map(m=>({...m.data(),uid_servicio:m.id}));Z(i),ae(n)}catch(a){console.error("Error obteniendo los datos:",a)}};c.useEffect(()=>{b()},[]);const oe=async()=>{await b(),u.push(e.jsx(g,{title:"Datos actualizados",children:"La tabla ha sido actualizada con éxito."}))},[Be,re]=c.useState(null),I=async a=>{if(re(a),!a){w([]);return}try{const o=M(N(p,"Categorias",a,"Subcategorias")),r=(await O(o)).docs.map(i=>({...i.data(),uid_subcategoria:i.id,nombre_subcategoria:i.data().nombre}));w(r)}catch(o){console.error("Error fetching subcategorias:",o),w([])}},se=a=>{h(a),C(!0)},te=a=>{h(a),f(!0)},[ie,v]=c.useState(!1),[qe,ne]=c.useState({nombre_servicio:"",descripcion:"",uid_servicio:"",uid_categoria:"",nombre_categoria:"",subcategoria:[],id:"",garantia:"",precio:0}),D=Me().shape({nombre_servicio:y().required("El nombre del servicio es obligatorio").min(3,"El nombre debe tener al menos 3 caracteres"),descripcion:y().required("La descripción es obligatoria").min(5,"La descripción debe tener al menos 5 caracteres"),uid_categoria:y().required("Debe seleccionar una categoría válida"),garantia:y().required("La garantía es obligatoria")}),ce=async a=>{try{await D.validate(a,{abortEarly:!1});const o=N(p,"ServiciosTemplate"),t=await ye(o,{nombre_servicio:a.nombre_servicio,descripcion:a.descripcion,nombre_categoria:a.nombre_categoria,uid_categoria:a.uid_categoria,subcategoria:a.subcategoria,uid_servicio:"",garantia:a.garantia,precio:a.precio});await q(t,{uid_servicio:t.id}),u.push(e.jsx(g,{title:"Éxito",children:"Servicio creado con éxito."})),ne({nombre_servicio:"",descripcion:"",uid_servicio:"",uid_categoria:"",nombre_categoria:"",subcategoria:[],garantia:"",precio:0}),v(!1),b()}catch(o){if(o instanceof Oe){const t=o.errors.join(", ");u.push(e.jsx(g,{title:"Error",children:t}))}else console.error("Error creando Servicio:",o),u.push(e.jsx(g,{title:"Error",children:"Hubo un error al crear el Servicio."}))}},le=a=>{const o=a.target.value;W(o),_([{id:H,value:o}])},de=a=>{const o=a.target.value;V(o),S!==""&&_([{id:o,value:S}])},me=async a=>{if(s)try{const o=z(p,"ServiciosTemplate",s==null?void 0:s.uid_servicio);await q(o,{nombre_servicio:a.nombre_servicio,descripcion:a.descripcion,uid_categoria:a.uid_categoria,nombre_categoria:a.nombre_categoria,subcategoria:a.subcategoria||[],garantia:a.garantia,precio:a.precio}),u.push(e.jsx(g,{title:"Éxito",children:"Servicio actualizado con éxito."})),f(!1),b()}catch(o){console.error("Error actualizando el servicio:",o),u.push(e.jsx(g,{title:"Error",children:"Hubo un error al actualizar el servicio."}))}},ue=[{header:"Nombre del Servicio",accessorKey:"nombre_servicio"},{header:"Descripción",accessorKey:"descripcion"},{header:"Categoría",accessorKey:"nombre_categoria"},{header:"Subcategorías",accessorKey:"subcategoria",cell:({row:a})=>{const o=a.original.subcategoria;return!Array.isArray(o)||o.length===0?e.jsx("span",{children:"No posee"}):e.jsx("ul",{children:o.map(t=>e.jsx("li",{children:t.nombre_subcategoria},t.uid_subcategoria))})}},{header:"Garantía",accessorKey:"garantia"},{header:"precio",accessorKey:"precio"},{header:" ",cell:({row:a})=>{const o=a.original;return e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>te(o),className:"text-blue-900",children:e.jsx(Re,{})}),e.jsx("button",{onClick:()=>se(o),className:"text-red-700",children:e.jsx(Pe,{})})]})}}],{Tr:B,Th:ge,Td:xe,THead:pe,TBody:be,Sorter:ze}=G,E=a=>{console.log("onDialogClose",a),C(!1),h(null)},he=a=>{console.log("Drawer cerrado",a),f(!1)},fe=async()=>{if(s){console.log("Eliminando el servicio:",s);try{const a=z(p,"ServiciosTemplate",s.uid_servicio);await _e(a);const o=e.jsxs(g,{title:"Éxito",children:["Servicio ",s.nombre_servicio," eliminado con éxito."]});u.push(o),b()}catch(a){console.error("Error eliminando el servicio:",a);const o=e.jsx(g,{title:"Error",children:"Hubo un error eliminando el servicio."});u.push(o)}finally{C(!1),h(null)}}},R=Se({data:ee,columns:ue,state:{sorting:Q,columnFilters:J},onSortingChange:Y,onColumnFiltersChange:_,getCoreRowModel:we(),getSortedRowModel:De(),getFilteredRowModel:Ee()}),[P,je]=c.useState(1),k=6,ve=R.getRowModel().rows.length,Ne=a=>{console.log("onPaginationChange",a),je(a)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsxs("h1",{className:"mb-6 flex justify-start items-center space-x-4",children:[" ",e.jsx("span",{className:"text-[#000B7E]",children:"Planilla de Servicios"}),e.jsx("button",{className:"p-2  bg-slate-100 hover:bg-slate-200 active:bg-slate-300 transition-all duration-200 shadow-md transform hover:scale-105 rounded-md",onClick:oe,children:e.jsx(He,{className:"w-5 h-5 text-gray-700 hover:text-blue-500 transition-colors duration-200"})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"relative w-32",children:[" ",e.jsxs("select",{className:"h-10 w-full py-2 px-4 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:de,value:H,children:[e.jsx("option",{value:"",disabled:!0,children:"Seleccionar columna..."}),e.jsx("option",{value:"nombre_servicio",children:"Nombre"}),e.jsx("option",{value:"nombre_categoria",children:"Categoria"})]})]}),e.jsxs("div",{className:"relative w-80 ml-4",children:[e.jsx("input",{type:"text",placeholder:"Buscar...",className:"w-full py-2 px-4 pl-10 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 h-10",value:S,onChange:le}),e.jsx(Fe,{className:"absolute left-3 top-5 transform -translate-y-1/2 text-gray-500 w-5 h-5"})]}),e.jsx(x,{style:{backgroundColor:"#000B7E"},className:"w-40 ml-4 text-white hover:opacity-80",onClick:()=>v(!0),children:"Crear Plantilla"})]})})]}),e.jsxs("div",{className:"p-1 rounded-lg shadow",children:[e.jsxs(G,{className:"w-full rounded-lg",children:[e.jsx(pe,{children:R.getHeaderGroups().map(a=>e.jsx(B,{children:a.headers.map(o=>e.jsx(ge,{colSpan:o.colSpan,children:o.isPlaceholder?null:e.jsx("div",{className:o.column.getCanSort()?"cursor-pointer select-none":"",onClick:o.column.getToggleSortingHandler(),children:T(o.column.columnDef.header,o.getContext())})},o.id))},a.id))}),e.jsx(be,{children:R.getRowModel().rows.slice((P-1)*k,P*k).map(a=>e.jsx(B,{children:a.getVisibleCells().map(o=>e.jsx(xe,{children:T(o.column.columnDef.cell,o.getContext())},o.id))},a.id))})]}),e.jsx(Ce,{onChange:Ne,currentPage:P,totalRows:ve,rowsPerPage:k})]})]}),e.jsxs(ke,{isOpen:U,onClose:E,onRequestClose:E,children:[e.jsx("h5",{className:"mb-4",children:"Confirmar Eliminación"}),e.jsxs("p",{children:["¿Estás seguro de que deseas eliminar el servicio"," ",s==null?void 0:s.nombre_servicio,"?"]}),e.jsxs("div",{className:"text-right mt-6",children:[e.jsx(x,{className:"ltr:mr-2 rtl:ml-2",variant:"plain",onClick:E,children:"Cancelar"}),e.jsx(x,{style:{backgroundColor:"#B91C1C"},className:"text-white hover:opacity-80",onClick:fe,children:"Eliminar"})]})]}),e.jsxs($,{isOpen:X,onClose:he,className:"rounded-md shadow",children:[e.jsx("h2",{className:"mb-4 text-xl font-bold",children:"Editar Plantilla"}),e.jsx(L,{initialValues:{nombre_servicio:(s==null?void 0:s.nombre_servicio)||"",descripcion:(s==null?void 0:s.descripcion)||"",nombre_categoria:(s==null?void 0:s.nombre_categoria)||"",uid_categoria:(s==null?void 0:s.uid_categoria)||"",subcategoria:(s==null?void 0:s.subcategoria)||[],garantia:(s==null?void 0:s.garantia)||"",precio:(s==null?void 0:s.precio)||""},validationSchema:D,onSubmit:a=>{console.log("Valores enviados:",a),me(a)},children:({isSubmitting:a,setFieldValue:o,values:t})=>e.jsxs(A,{className:"flex flex-col space-y-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"Nombre Servicio:"}),e.jsx(d,{type:"text",name:"nombre_servicio",className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx(l,{name:"nombre_servicio",component:"div",className:"text-red-600 text-sm mt-1"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"Categoría:"}),e.jsxs(d,{as:"select",name:"uid_categoria",onChange:r=>{const i=r.target.value,n=j.find(m=>m.uid_categoria===i);o("uid_categoria",i),o("nombre_categoria",n==null?void 0:n.nombre),o("subcategoria",[]),I(i)},className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Seleccione una categoría"}),j.map(r=>e.jsx("option",{value:r.uid_categoria,children:r.nombre},r.uid_categoria))]}),e.jsx(l,{name:"uid_categoria",component:"div",className:"text-red-600 text-sm mt-1"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"Subcategorías:"}),e.jsx(K,{placeholder:"Seleccione una o más subcategorías",isMulti:!0,noOptionsMessage:()=>"No hay Subcategorías disponibles",options:t.uid_categoria?F.map(r=>({value:r.uid_subcategoria,label:r.nombre})):[],value:t.subcategoria.map(r=>({value:r.uid_subcategoria,label:r.nombre_subcategoria})),onChange:r=>{const i=r.map(n=>({uid_subcategoria:n.value,nombre_subcategoria:n.label}));o("subcategoria",i)},className:"mt-1"}),e.jsx(l,{name:"subcategoria",component:"div",className:"text-red-600 text-sm mt-1"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"Descripción:"}),e.jsx(d,{as:"textarea",name:"descripcion",className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",rows:1,style:{maxHeight:"150px",overflowY:"auto"},onInput:r=>{r.target.style.height="auto",r.target.style.height=`${r.target.scrollHeight}px`}}),e.jsx(l,{name:"descripcion",component:"div",className:"text-red-600 text-sm mt-1"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"Garantía:"}),e.jsx(d,{type:"text",name:"garantia",className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx(l,{name:"garantia",component:"div",className:"text-red-600 text-sm mt-1"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"Precio:"}),e.jsx(d,{type:"text",name:"precio",className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx(l,{name:"precio",component:"div",className:"text-red-600 text-sm mt-1"})]}),e.jsxs("div",{className:"text-right mt-6",children:[e.jsx(x,{variant:"default",onClick:()=>f(!1),className:"mr-2",children:"Cancelar"}),e.jsx(x,{type:"submit",style:{backgroundColor:"#000B7E"},className:"text-white hover:opacity-80",disabled:a,children:a?"Guardando...":"Guardar"})]})]})})]}),e.jsxs($,{isOpen:ie,onClose:()=>v(!1),className:"rounded-md shadow",children:[e.jsx("h2",{className:"mb-4 text-xl font-bold",children:"Crear Plantilla"}),e.jsx(L,{initialValues:{nombre_servicio:"",descripcion:"",uid_categoria:"",subcategoria:[],garantia:"",precio:""},validationSchema:D,onSubmit:(a,{setSubmitting:o})=>{ce(a),o(!1)},children:({isSubmitting:a,setFieldValue:o,values:t})=>e.jsxs(A,{className:"flex flex-col space-y-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"Nombre Servicio:"}),e.jsx(d,{type:"text",name:"nombre_servicio",className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx(l,{name:"nombre_servicio",component:"div",className:"text-red-600 text-sm mt-1"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"Categoría:"}),e.jsxs(d,{as:"select",name:"uid_categoria",onChange:r=>{const i=r.target.value,n=j.find(m=>m.uid_categoria===i);o("uid_categoria",i),o("nombre_categoria",(n==null?void 0:n.nombre)||""),o("subcategoria",[]),I(i)},className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Seleccione una categoría"}),j.map(r=>e.jsx("option",{value:r.uid_categoria,children:r.nombre},r.uid_categoria))]}),e.jsx(l,{name:"uid_categoria",component:"div",className:"text-red-600 text-sm mt-1"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"Subcategorías:"}),e.jsx(K,{placeholder:"Seleccione una o más subcategorías",isMulti:!0,noOptionsMessage:()=>"No hay Subcategorías disponibles",options:t.uid_categoria?F.map(r=>({value:r.uid_subcategoria,label:r.nombre})):[],value:t.subcategoria.map(r=>({value:r.uid_subcategoria,label:r.nombre_subcategoria})),onChange:r=>{const i=r.map(n=>({uid_subcategoria:n.value,nombre_subcategoria:n.label}));o("subcategoria",i)},className:"mt-1"}),e.jsx(l,{name:"subcategoria",component:"div",className:"text-red-600 text-sm mt-1"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"Descripción:"}),e.jsx(d,{as:"textarea",name:"descripcion",className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",rows:1,style:{maxHeight:"150px",overflowY:"auto"},onInput:r=>{r.target.style.height="auto",r.target.style.height=`${r.target.scrollHeight}px`}}),e.jsx(l,{name:"descripcion",component:"div",className:"text-red-600 text-sm mt-1"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"Garantía:"}),e.jsx(d,{type:"text",name:"garantia",className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx(l,{name:"garantia",component:"div",className:"text-red-600 text-sm mt-1"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"Precio:"}),e.jsx(d,{type:"text",name:"precio",className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx(l,{name:"precio",component:"div",className:"text-red-600 text-sm mt-1"})]}),e.jsxs("div",{className:"text-right mt-6",children:[e.jsx(x,{variant:"default",onClick:()=>v(!1),className:"mr-2",children:"Cancelar"}),e.jsx(x,{type:"submit",style:{backgroundColor:"#000B7E"},className:"text-white hover:opacity-80",disabled:a,children:a?"Guardando...":"Guardar"})]})]})})]})]})},so=Ie;export{so as default};
