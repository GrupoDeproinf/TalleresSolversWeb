import{r as n,j as e,a9 as p,a8 as N,a7 as M,aa as O,ae as Ce,af as z,ag as G,ah as Se}from"./index-ATNefdVG.js";import{P as we}from"./index-Rjm_CfUD.js";import{T as K}from"./index-1QBWWPtH.js";import{S as T}from"./Select-meFjX2OX.js";import{u as De,f as $,g as Ee,a as Pe,b as Re}from"./index-mu3rsG90.js";import{e as ke,f as Me}from"./index.esm-SLyUBwzt.js";import{B as x}from"./Button-m8cr7QK0.js";import{D as Oe}from"./Dialog-01bjbLh0.js";import{t as u,N as g}from"./toast-ArUM2hkn.js";import"./Alert-YDCIg78L.js";import"./index-74gKM8Gk.js";import"./Badge-7j32ABcM.js";import"./Calendar-kXRbY7HP.js";import"./Card-OSPH2pm3.js";import"./index-J2oOIxTS.js";import"./index-Ww4KSR8x.js";import{D as L}from"./Drawer-TF5epqni.js";import"./index-OgT6bzbj.js";import"./FormItem-YT9PXtwB.js";import"./Input-esXMioi-.js";import"./index-Yk7DAYzs.js";import"./index-AdZu4ZEf.js";import"./index-Njt5DKLW.js";import"./Progress-8N-5zDn7.js";import"./index-Xj1V1DYV.js";import"./RangeCalendar-KFdi8RAV.js";import"./ScrollBar-wOU87srT.js";import"./index-wOmcTQB3.js";import"./Skeleton-rqvm5li9.js";import"./index-yyjad8ES.js";import"./Switcher-Q2_gTjX7.js";import"./index-8Ze0HwPQ.js";import"./Tag-jU5n4W4w.js";import"./index-9p-8nnWt.js";import"./index-O5FvOx90.js";import"./Tooltip-RPBixJuV.js";import"./Upload-sm3Naufp.js";import{c as He,a as y,V as Fe}from"./index.esm-veTBKOrz.js";import{F as A,a as Q,b as d,E as l}from"./formik.esm-dqEqoyez.js";import{O as Ie,D as Be}from"./index.esm-RzyebFAI.js";import"./toConsumableArray-YYxflNc8.js";import"./objectWithoutPropertiesLoose-pdUxmcoj.js";import"./setPrototypeOf-ahVgEFUp.js";import"./floating-ui.dom-0rLBacrf.js";import"./Views-oxXEUsSY.js";import"./get-GDY1XD6s.js";import"./_MapCache-_63I7Bc7.js";import"./toString-LadLPz1K.js";import"./context-GUUKwgTl.js";import"./index-lc_qXIiG.js";import"./index-D5lh9mO-.js";import"./CloseButton-27bnAAMk.js";import"./motion-qY3QHwHT.js";import"./useTimeout-1ykP9PCU.js";import"./StatusIcon-yBHceAv6.js";import"./chainedFunction-ltcSYACe.js";import"./useMergeRef-Rt_Crb27.js";import"./useControllableState-TaiAnLFv.js";import"./cloneDeep-yGYZIkRg.js";import"./_getAllKeys-eyRctv10.js";import"./_baseIsEqual-u0EOHXHy.js";import"./floating-ui.react-6woUHVe8.js";import"./TimeInput-EwrvAjFc.js";import"./useUniqueId-q2Q7KHj7.js";import"./useDidUpdate-R-Sv0J0Y.js";import"./useRootClose-2Ks0vhqk.js";import"./isNil-qbgWSuln.js";import"./index-LDVYzlxf.js";import"./mapCloneElement-I1EKrR-t.js";import"./index.esm-6sKRXwnY.js";import"./index.esm-5SxxohUP.js";const qe=()=>{const[Y,J]=n.useState([]),[U,_]=n.useState([]),[V,C]=n.useState(!1),[s,h]=n.useState(null),[H,W]=n.useState("nombre_servicio"),[S,X]=n.useState(""),[Z,f]=n.useState(!1),[j,ee]=n.useState([]),[F,w]=n.useState([]),[ae,oe]=n.useState([]),b=async()=>{try{const a=M(N(p,"Categorias")),o=M(N(p,"ServiciosTemplate")),[t,r]=await Promise.all([O(a),O(o)]),i=t.docs.map(m=>({...m.data(),uid_categoria:m.id})),c=r.docs.map(m=>({...m.data(),uid_servicio:m.id}));ee(i),oe(c)}catch(a){console.error("Error obteniendo los datos:",a)}};n.useEffect(()=>{b()},[]);const re=async()=>{await b(),u.push(e.jsx(g,{title:"Datos actualizados",children:"La tabla ha sido actualizada con éxito."}))},[ze,se]=n.useState(null),I=async a=>{if(se(a),!a){w([]);return}try{const o=M(N(p,"Categorias",a,"Subcategorias")),r=(await O(o)).docs.map(i=>({...i.data(),uid_subcategoria:i.id,nombre_subcategoria:i.data().nombre}));w(r)}catch(o){console.error("Error fetching subcategorias:",o),w([])}},te=a=>{h(a),C(!0)},ie=a=>{h(a),f(!0)},[ne,v]=n.useState(!1),[Ge,ce]=n.useState({nombre_servicio:"",descripcion:"",uid_servicio:"",uid_categoria:"",nombre_categoria:"",subcategoria:[],id:"",garantia:"",precio:0}),D=He().shape({nombre_servicio:y().required("El nombre del servicio es obligatorio").min(3,"El nombre debe tener al menos 3 caracteres"),descripcion:y().required("La descripción es obligatoria").min(5,"La descripción debe tener al menos 5 caracteres"),uid_categoria:y().required("Debe seleccionar una categoría válida"),garantia:y().required("La garantía es obligatoria")}),le=async a=>{try{await D.validate(a,{abortEarly:!1});const o=N(p,"ServiciosTemplate"),t=await Ce(o,{nombre_servicio:a.nombre_servicio,descripcion:a.descripcion,nombre_categoria:a.nombre_categoria,uid_categoria:a.uid_categoria,subcategoria:a.subcategoria,uid_servicio:"",garantia:a.garantia,precio:a.precio});await z(t,{uid_servicio:t.id}),u.push(e.jsx(g,{title:"Éxito",children:"Servicio creado con éxito."})),ce({nombre_servicio:"",descripcion:"",uid_servicio:"",uid_categoria:"",nombre_categoria:"",subcategoria:[],garantia:"",precio:0}),v(!1),b()}catch(o){if(o instanceof Fe){const t=o.errors.join(", ");u.push(e.jsx(g,{title:"Error",children:t}))}else console.error("Error creando Servicio:",o),u.push(e.jsx(g,{title:"Error",children:"Hubo un error al crear el Servicio."}))}},de=a=>{const o=a.target.value;X(o),_([{id:H,value:o}])},me=a=>{const o=a.target.value;W(o),S!==""&&_([{id:o,value:S}])},ue=async a=>{if(s)try{const o=G(p,"ServiciosTemplate",s==null?void 0:s.uid_servicio);await z(o,{nombre_servicio:a.nombre_servicio,descripcion:a.descripcion,uid_categoria:a.uid_categoria,nombre_categoria:a.nombre_categoria,subcategoria:a.subcategoria||[],garantia:a.garantia,precio:a.precio}),u.push(e.jsx(g,{title:"Éxito",children:"Servicio actualizado con éxito."})),f(!1),b()}catch(o){console.error("Error actualizando el servicio:",o),u.push(e.jsx(g,{title:"Error",children:"Hubo un error al actualizar el servicio."}))}},ge=[{header:"Nombre del Servicio",accessorKey:"nombre_servicio"},{header:"Descripción",accessorKey:"descripcion"},{header:"Categoría",accessorKey:"nombre_categoria"},{header:"Subcategorías",accessorKey:"subcategoria",cell:({row:a})=>{const o=a.original.subcategoria;return!Array.isArray(o)||o.length===0?e.jsx("span",{children:"No posee"}):e.jsx("ul",{children:o.map(t=>e.jsx("li",{children:t.nombre_subcategoria},t.uid_subcategoria))})}},{header:"Garantía",accessorKey:"garantia"},{header:"precio",accessorKey:"precio"},{header:" ",cell:({row:a})=>{const o=a.original;return e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>ie(o),className:"text-blue-900",children:e.jsx(ke,{})}),e.jsx("button",{onClick:()=>te(o),className:"text-red-700",children:e.jsx(Me,{})})]})}}],{Tr:B,Th:xe,Td:pe,THead:be,TBody:he,Sorter:Ke}=K,E=a=>{console.log("onDialogClose",a),C(!1),h(null)},fe=a=>{console.log("Drawer cerrado",a),f(!1)},je=async()=>{if(s){console.log("Eliminando el servicio:",s);try{const a=G(p,"ServiciosTemplate",s.uid_servicio);await Se(a);const o=e.jsxs(g,{title:"Éxito",children:["Servicio ",s.nombre_servicio," eliminado con éxito."]});u.push(o),b()}catch(a){console.error("Error eliminando el servicio:",a);const o=e.jsx(g,{title:"Error",children:"Hubo un error eliminando el servicio."});u.push(o)}finally{C(!1),h(null)}}},P=De({data:ae,columns:ge,state:{sorting:Y,columnFilters:U},onSortingChange:J,onColumnFiltersChange:_,getCoreRowModel:Ee(),getSortedRowModel:Pe(),getFilteredRowModel:Re()}),[R,q]=n.useState(1),[k,ve]=n.useState(10),Ne=P.getRowModel().rows.length,ye=a=>{q(a)},_e=a=>{ve(a),q(1)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsxs("h1",{className:"mb-6 flex justify-start items-center space-x-4",children:[" ",e.jsx("span",{className:"text-[#000B7E]",children:"Planilla de Servicios"}),e.jsx("button",{className:"p-2  bg-slate-100 hover:bg-slate-200 active:bg-slate-300 transition-all duration-200 shadow-md transform hover:scale-105 rounded-md",onClick:re,children:e.jsx(Ie,{className:"w-5 h-5 text-gray-700 hover:text-blue-500 transition-colors duration-200"})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"relative w-32",children:[" ",e.jsxs("select",{className:"h-10 w-full py-2 px-4 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:me,value:H,children:[e.jsx("option",{value:"",disabled:!0,children:"Seleccionar columna..."}),e.jsx("option",{value:"nombre_servicio",children:"Nombre"}),e.jsx("option",{value:"nombre_categoria",children:"Categoria"})]})]}),e.jsxs("div",{className:"relative w-80 ml-4",children:[e.jsx("input",{type:"text",placeholder:"Buscar...",className:"w-full py-2 px-4 pl-10 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 h-10",value:S,onChange:de}),e.jsx(Be,{className:"absolute left-3 top-5 transform -translate-y-1/2 text-gray-500 w-5 h-5"})]}),e.jsx(x,{style:{backgroundColor:"#000B7E"},className:"w-40 ml-4 text-white hover:opacity-80",onClick:()=>v(!0),children:"Crear Plantilla"})]})})]}),e.jsxs("div",{className:"p-1 rounded-lg shadow",children:[e.jsxs(K,{className:"w-full rounded-lg",children:[e.jsx(be,{children:P.getHeaderGroups().map(a=>e.jsx(B,{children:a.headers.map(o=>e.jsx(xe,{colSpan:o.colSpan,children:o.isPlaceholder?null:e.jsx("div",{className:o.column.getCanSort()?"cursor-pointer select-none":"",onClick:o.column.getToggleSortingHandler(),children:$(o.column.columnDef.header,o.getContext())})},o.id))},a.id))}),e.jsx(he,{children:P.getRowModel().rows.slice((R-1)*k,R*k).map(a=>e.jsx(B,{children:a.getVisibleCells().map(o=>e.jsx(pe,{children:$(o.column.columnDef.cell,o.getContext())},o.id))},a.id))})]}),e.jsx(we,{onChange:ye,currentPage:R,totalRows:Ne,rowsPerPage:k,onRowsPerPageChange:_e})]})]}),e.jsxs(Oe,{isOpen:V,onClose:E,onRequestClose:E,children:[e.jsx("h5",{className:"mb-4",children:"Confirmar Eliminación"}),e.jsxs("p",{children:["¿Estás seguro de que deseas eliminar el servicio"," ",s==null?void 0:s.nombre_servicio,"?"]}),e.jsxs("div",{className:"text-right mt-6",children:[e.jsx(x,{className:"ltr:mr-2 rtl:ml-2",variant:"plain",onClick:E,children:"Cancelar"}),e.jsx(x,{style:{backgroundColor:"#B91C1C"},className:"text-white hover:opacity-80",onClick:je,children:"Eliminar"})]})]}),e.jsxs(L,{isOpen:Z,onClose:fe,className:"rounded-md shadow",children:[e.jsx("h2",{className:"mb-4 text-xl font-bold",children:"Editar Plantilla"}),e.jsx(A,{initialValues:{nombre_servicio:(s==null?void 0:s.nombre_servicio)||"",descripcion:(s==null?void 0:s.descripcion)||"",nombre_categoria:(s==null?void 0:s.nombre_categoria)||"",uid_categoria:(s==null?void 0:s.uid_categoria)||"",subcategoria:(s==null?void 0:s.subcategoria)||[],garantia:(s==null?void 0:s.garantia)||"",precio:(s==null?void 0:s.precio)||""},validationSchema:D,onSubmit:a=>{console.log("Valores enviados:",a),ue(a)},children:({isSubmitting:a,setFieldValue:o,values:t})=>e.jsxs(Q,{className:"flex flex-col space-y-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"Nombre Servicio:"}),e.jsx(d,{type:"text",name:"nombre_servicio",className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx(l,{name:"nombre_servicio",component:"div",className:"text-red-600 text-sm mt-1"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"Categoría:"}),e.jsxs(d,{as:"select",name:"uid_categoria",onChange:r=>{const i=r.target.value,c=j.find(m=>m.uid_categoria===i);o("uid_categoria",i),o("nombre_categoria",c==null?void 0:c.nombre),o("subcategoria",[]),I(i)},className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Seleccione una categoría"}),j.map(r=>e.jsx("option",{value:r.uid_categoria,children:r.nombre},r.uid_categoria))]}),e.jsx(l,{name:"uid_categoria",component:"div",className:"text-red-600 text-sm mt-1"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"Subcategorías:"}),e.jsx(T,{placeholder:"Seleccione una o más subcategorías",isMulti:!0,noOptionsMessage:()=>"No hay Subcategorías disponibles",options:t.uid_categoria?F.map(r=>({value:r.uid_subcategoria,label:r.nombre})):[],value:t.subcategoria.map(r=>({value:r.uid_subcategoria,label:r.nombre_subcategoria})),onChange:r=>{const i=r.map(c=>({uid_subcategoria:c.value,nombre_subcategoria:c.label}));o("subcategoria",i)},className:"mt-1"}),e.jsx(l,{name:"subcategoria",component:"div",className:"text-red-600 text-sm mt-1"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"Descripción:"}),e.jsx(d,{as:"textarea",name:"descripcion",className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",rows:1,style:{maxHeight:"150px",overflowY:"auto"},onInput:r=>{r.target.style.height="auto",r.target.style.height=`${r.target.scrollHeight}px`}}),e.jsx(l,{name:"descripcion",component:"div",className:"text-red-600 text-sm mt-1"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"Garantía:"}),e.jsx(d,{type:"text",name:"garantia",className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx(l,{name:"garantia",component:"div",className:"text-red-600 text-sm mt-1"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"Precio:"}),e.jsx(d,{type:"text",name:"precio",className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx(l,{name:"precio",component:"div",className:"text-red-600 text-sm mt-1"})]}),e.jsxs("div",{className:"text-right mt-6",children:[e.jsx(x,{variant:"default",onClick:()=>f(!1),className:"mr-2",children:"Cancelar"}),e.jsx(x,{type:"submit",style:{backgroundColor:"#000B7E"},className:"text-white hover:opacity-80",disabled:a,children:a?"Guardando...":"Guardar"})]})]})})]}),e.jsxs(L,{isOpen:ne,onClose:()=>v(!1),className:"rounded-md shadow",children:[e.jsx("h2",{className:"mb-4 text-xl font-bold",children:"Crear Plantilla"}),e.jsx(A,{initialValues:{nombre_servicio:"",descripcion:"",uid_categoria:"",subcategoria:[],garantia:"",precio:""},validationSchema:D,onSubmit:(a,{setSubmitting:o})=>{le(a),o(!1)},children:({isSubmitting:a,setFieldValue:o,values:t})=>e.jsxs(Q,{className:"flex flex-col space-y-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"Nombre Servicio:"}),e.jsx(d,{type:"text",name:"nombre_servicio",className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx(l,{name:"nombre_servicio",component:"div",className:"text-red-600 text-sm mt-1"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"Categoría:"}),e.jsxs(d,{as:"select",name:"uid_categoria",onChange:r=>{const i=r.target.value,c=j.find(m=>m.uid_categoria===i);o("uid_categoria",i),o("nombre_categoria",(c==null?void 0:c.nombre)||""),o("subcategoria",[]),I(i)},className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Seleccione una categoría"}),j.map(r=>e.jsx("option",{value:r.uid_categoria,children:r.nombre},r.uid_categoria))]}),e.jsx(l,{name:"uid_categoria",component:"div",className:"text-red-600 text-sm mt-1"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"Subcategorías:"}),e.jsx(T,{placeholder:"Seleccione una o más subcategorías",isMulti:!0,noOptionsMessage:()=>"No hay Subcategorías disponibles",options:t.uid_categoria?F.map(r=>({value:r.uid_subcategoria,label:r.nombre})):[],value:t.subcategoria.map(r=>({value:r.uid_subcategoria,label:r.nombre_subcategoria})),onChange:r=>{const i=r.map(c=>({uid_subcategoria:c.value,nombre_subcategoria:c.label}));o("subcategoria",i)},className:"mt-1"}),e.jsx(l,{name:"subcategoria",component:"div",className:"text-red-600 text-sm mt-1"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"Descripción:"}),e.jsx(d,{as:"textarea",name:"descripcion",className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",rows:1,style:{maxHeight:"150px",overflowY:"auto"},onInput:r=>{r.target.style.height="auto",r.target.style.height=`${r.target.scrollHeight}px`}}),e.jsx(l,{name:"descripcion",component:"div",className:"text-red-600 text-sm mt-1"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"Garantía:"}),e.jsx(d,{type:"text",name:"garantia",className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx(l,{name:"garantia",component:"div",className:"text-red-600 text-sm mt-1"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"Precio:"}),e.jsx(d,{type:"text",name:"precio",className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx(l,{name:"precio",component:"div",className:"text-red-600 text-sm mt-1"})]}),e.jsxs("div",{className:"text-right mt-6",children:[e.jsx(x,{variant:"default",onClick:()=>v(!1),className:"mr-2",children:"Cancelar"}),e.jsx(x,{type:"submit",style:{backgroundColor:"#000B7E"},className:"text-white hover:opacity-80",disabled:a,children:a?"Guardando...":"Guardar"})]})]})})]})]})},io=qe;export{io as default};
