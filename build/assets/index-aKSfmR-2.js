import{r as n,u as U,j as e,a8 as x,a7 as j,a6 as S,a9 as C,af as Pe,ao as Ae,ad as ke,ai as Me,aj as Be,ak as Le,al as Ue,ae as O}from"./index-_feUBWkF.js";import{P as qe}from"./index-VNg9U51V.js";import{T as Y}from"./index--K6mHtPM.js";import"./Alert-WzJy301q.js";import"./index-vYF_FpU2.js";import"./Badge-TmEmdow9.js";import{B as E}from"./Button-jcq0xEfh.js";import"./Calendar-OEPJiOUd.js";import"./Card-fXn1hgP9.js";import"./index-H_ZscJuo.js";import"./index-CGu17yU7.js";import"./Dialog-v8uTeGhc.js";import{D as $e}from"./Drawer-psoT67UG.js";import"./index-5qYT1f9K.js";import"./FormItem-MYXqnsmy.js";import"./Input-E8Xy-NaX.js";import"./index-ep3SI8rj.js";import"./index-oQxwVP1_.js";import"./index-xnMpDD1K.js";import{t as b,N as h}from"./toast-GgiGqW4N.js";import"./Progress-hlvl7h9I.js";import"./index-bOSGx0a4.js";import"./RangeCalendar-E_24dkLH.js";import"./ScrollBar-S0qWNEjk.js";import"./index-F9R31yWw.js";import{d as J}from"./Select-9xvaqg6U.js";import"./Skeleton-v_ck5RJ1.js";import"./index-aTgaXSlK.js";import"./Switcher-umThDEGW.js";import"./index-HTFXVSWF.js";import"./Tag-RmI7uqBT.js";import"./index-iDZU1Tza.js";import"./index-ENU_IEPp.js";import"./Tooltip-tqY3hXOR.js";import"./Upload-caBsJdBw.js";import{u as Fe,f as W,g as Ge,a as He,b as Ke}from"./index-IwiwqbVe.js";import{g as Qe}from"./index.esm-c6ShvaQW.js";import{c as ze,a as _,b as Oe,f as Ye}from"./index.esm-XUyKFeu_.js";import{O as Je,D as We}from"./index.esm-CyL_iEBq.js";import{F as Xe,a as Ze,b as f,E as v}from"./formik.esm-yiEeoVLJ.js";import"./useTimeout-lvoBzkZb.js";import"./CloseButton-0JjgPcqS.js";import"./StatusIcon-mkSwP6mg.js";import"./motion-2zhnpuIh.js";import"./useMergeRef-Rt_Crb27.js";import"./context-w88CtZWU.js";import"./useControllableState-Z5L6i6Et.js";import"./cloneDeep-GJ9f8YIY.js";import"./_getAllKeys-ubi2BvIA.js";import"./_MapCache-HrqL2mpR.js";import"./Views-NoPs0swz.js";import"./_baseIsEqual-d0iTpr48.js";import"./get-iuu1b1Bt.js";import"./toString-LmJFJgEq.js";import"./floating-ui.react-AOig1bqs.js";import"./floating-ui.dom-0rLBacrf.js";import"./TimeInput-9HnXIoua.js";import"./useUniqueId-XtUBe_3h.js";import"./useDidUpdate-SXgnC2jO.js";import"./index-8Gigl45y.js";import"./index-Xr0iHSGr.js";import"./useRootClose--xQa3G5y.js";import"./isNil-uGA-FeKR.js";import"./index-C1ft9MxP.js";import"./chainedFunction-ltcSYACe.js";import"./toConsumableArray-YYxflNc8.js";import"./objectWithoutPropertiesLoose-pdUxmcoj.js";import"./setPrototypeOf-ahVgEFUp.js";import"./mapCloneElement-bHmR-YFq.js";import"./index.esm-bIknb-8m.js";import"./index.esm-vV1KXhJ0.js";const Ve=()=>{n.useState("local");const y=U(a=>a.auth.user.authority),X=U(a=>a.auth.user.key),Z=U(a=>a.auth.user.userName),V=y==null?void 0:y.includes("Admin"),[R,ee]=n.useState([]),[q,ae]=n.useState([]),[re,T]=n.useState([]),[$,se]=n.useState("nombre_servicio"),[I,oe]=n.useState(""),[ea,ie]=n.useState(null),[aa,te]=n.useState([]),[ce,ne]=n.useState([]),P=async()=>{try{const a=S(j(x,"Usuarios")),s=S(j(x,"Categorias")),c=S(j(x,"Servicios")),d=S(j(x,"ServiciosTemplate")),[m,N,r,t]=await Promise.all([C(a),C(s),C(c),C(d)]),l=m.docs.map(i=>({...i.data(),id:i.id})).filter(i=>{var p;return i.typeUser==="Taller"&&((p=i.subscripcion_actual)==null?void 0:p.status)==="Aprobado"}).sort((i,p)=>i.nombre.localeCompare(p.nombre)),u=N.docs.map(i=>({...i.data(),uid_categoria:i.id})),g=r.docs.map(i=>({...i.data(),id:i.id})),D=t.docs.map(i=>({...i.data(),uid_servicio:i.id}));ee(l),ae(u),te(g),ne(D)}catch(a){console.error("Error fetching data:",a)}};n.useEffect(()=>{P()},[]);const le=async()=>{await P(),b.push(e.jsx(h,{title:"Datos actualizados",children:"La tabla ha sido actualizada con éxito."}))},de=async a=>{if(ie(a),!a){T([]);return}try{const s=S(j(x,"Categorias",a,"Subcategorias")),d=(await C(s)).docs.map(m=>({...m.data(),uid_subcategoria:m.id,nombre_subcategoria:m.data().nombre}));T(d)}catch(s){console.error("Error fetching subcategorias:",s),T([])}},[ra,F]=n.useState(null),[me,w]=n.useState(!1),[o,A]=n.useState({nombre_servicio:"",descripcion:"",uid_categoria:"",nombre_categoria:"",subcategoria:[],precio:0,uid_servicio:"",typeService:"",estatus:!0,garantia:"",service_image:[],service_image_files:[]}),ue=ze({nombre_servicio:_().required("El nombre del servicio es obligatorio.").min(3,"El nombre del servicio debe tener al menos 3 caracteres."),descripcion:_().required("La descripción es obligatoria.").min(10,"La descripción debe tener al menos 10 caracteres."),uid_categoria:_().required("La categoría es obligatoria."),subcategoria:Oe().min(1,"Debes elegir al menos una subcategoría").required("Las subcategorías son obligatorias."),uid_taller:_().required("El taller es obligatorio."),precio:Ye().required("El precio es obligatorio.").positive("El precio debe ser un valor positivo.").typeError("El precio debe ser un número."),garantia:_().required("La garantía es obligatoria."),typeService:_().required("Debe seleccionar un tipo de servicio")}),ge=async a=>{var s,c;console.log("Valores enviados a handleCreateService: ",a);try{const d=Pe(x,"Usuarios",a.uid_taller),m=await Ae(d);if(!m.exists()){b.push(e.jsx(h,{title:"Error",children:"El taller seleccionado no existe."}));return}const r=(s=m.data().subscripcion_actual)==null?void 0:s.cantidad_servicios;if(r<=0){b.push(e.jsx(h,{title:"Error",children:"Este taller no tiene más servicios disponibles para crear."}));return}const t=j(x,"Servicios"),l=await ke(t,{nombre_servicio:a.nombre_servicio,descripcion:a.descripcion,nombre_categoria:a.nombre_categoria,uid_categoria:a.uid_categoria,subcategoria:a.subcategoria,precio:a.precio,uid_taller:a.uid_taller,taller:a.taller,uid_servicio:"",garantia:a.garantia,typeService:a.typeService,estatus:!0,service_image:[]}),u=l.id,g=a.service_image_files;if(console.log("Aquí están las imagenes: ",g),!g||g.length===0){b.push(e.jsx(h,{title:"Error",children:"Debes seleccionar al menos una imagen."}));return}const D=[];for(let i=0;i<g.length;i++){const p=g[i],L=(c=p.name.split(".").pop())==null?void 0:c.toLowerCase();if(!L||!["png","jpg","jpeg","webp"].includes(L)){b.push(e.jsx(h,{title:"Error",children:"Tipo de archivo no soportado. Solo se permiten imágenes."}));return}const z=Be(Me,`service_images/${u}_${i+1}.${L}`);await Le(z,p);const Ie=await Ue(z);D.push(Ie)}await O(l,{uid_servicio:u,service_image:D}),await O(d,{"subscripcion_actual.cantidad_servicios":r-1}),b.push(e.jsx(h,{title:"Éxito",children:"Servicio creado con éxito."})),A({nombre_servicio:"",descripcion:"",uid_servicio:"",uid_categoria:"",nombre_categoria:"",subcategoria:[],precio:0,uid_taller:"",taller:"",garantia:"",typeService:"",estatus:!0,service_image:[],service_image_files:[]}),Te(!1),w(!1),P()}catch(d){console.error("Error creando Servicio:",d),b.push(e.jsx(h,{title:"Error",children:"Hubo un error al crear el Servicio."}))}},pe=()=>{F(null),A({nombre_servicio:"",descripcion:"",uid_categoria:"",nombre_categoria:"",subcategoria:[],precio:0,uid_servicio:"",garantia:"",typeService:""}),w(!0)},xe=a=>{F(a),A({nombre_servicio:a.nombre_servicio||"",descripcion:a.descripcion||"",uid_categoria:a.uid_categoria||"",nombre_categoria:a.nombre_categoria||"",subcategoria:a.subcategoria||[],precio:a.precio||0,uid_servicio:a.uid_servicio||"",garantia:a.garantia||""}),w(!0)},[be,k]=n.useState([]),he=a=>{const s=a.target.value;oe(s),k([{id:$,value:s}])},fe=a=>{const s=a.target.value;se(s),I!==""&&k([{id:s,value:I}])},ve=[{header:"Nombre del Servicio",accessorKey:"nombre_servicio"},{header:"Descripción",accessorKey:"descripcion"},{header:"Categoría",accessorKey:"nombre_categoria"},{header:"Subcategorías",accessorKey:"subcategoria",cell:({row:a})=>{const s=a.original.subcategoria;return!Array.isArray(s)||s.length===0?e.jsx("span",{children:"No posee"}):e.jsx("ul",{children:s.map(c=>e.jsx("li",{children:c.nombre_subcategoria},c.uid_subcategoria))})}},{header:"Garantía",accessorKey:"garantia"},{header:"Precio",accessorKey:"precio"},{header:" ",cell:({row:a})=>{const s=a.original;return e.jsx("div",{className:"flex gap-2",children:e.jsx(E,{style:{backgroundColor:"#000B7E"},className:"text-white hover:opacity-80",onClick:()=>xe(s),children:"Usar Plantilla"})})}}],{Tr:G,Th:je,Td:_e,THead:ye,TBody:Ne,Sorter:sa}=Y,[Se,Ce]=n.useState([]),M=Fe({data:ce,columns:ve,state:{sorting:Se,columnFilters:be},onSortingChange:Ce,onColumnFiltersChange:k,getCoreRowModel:Ge(),getSortedRowModel:He(),getFilteredRowModel:Ke()}),[H,we]=n.useState(1),B=6,De=M.getRowModel().rows.length,Ee=a=>{console.log("onPaginationChange",a),we(a)},K=(H-1)*B,Re=K+B,[ia,Te]=n.useState(!1),Q=a=>{console.log("Drawer cerrado",a),w(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsxs("h1",{className:"mb-6 flex justify-start items-center space-x-4",children:[" ",e.jsx("span",{className:"text-[#000B7E]",children:"Asignar Servicios a Talleres"}),e.jsx("button",{className:"p-2  bg-slate-100 hover:bg-slate-200 active:bg-slate-300 transition-all duration-200 shadow-md transform hover:scale-105 rounded-md",onClick:le,children:e.jsx(Je,{className:"w-5 h-5 text-gray-700 hover:text-blue-500 transition-colors duration-200"})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"relative w-32",children:[" ",e.jsxs("select",{className:"h-10 w-full py-2 px-4 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:fe,value:$,children:[e.jsx("option",{value:"",disabled:!0,children:"Seleccionar columna..."}),e.jsx("option",{value:"nombre_servicio",children:"Nombre"}),e.jsx("option",{value:"nombre_categoria",children:"Categoria"}),e.jsx("option",{value:"typeService",children:"Tipo de Servicio"})]})]}),e.jsxs("div",{className:"relative w-70 ml-4",children:[e.jsx("input",{type:"text",placeholder:"Buscar...",className:"w-full py-2 px-4 pl-10 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 h-10",value:I,onChange:he}),e.jsx(We,{className:"absolute left-3 top-5 transform -translate-y-1/2 text-gray-500 w-5 h-5"})]}),e.jsx(E,{style:{backgroundColor:"#000B7E"},className:"w-40 ml-4 text-white hover:opacity-80",onClick:pe,children:"Crear Servicio"})]})})]}),e.jsxs("div",{className:"p-3 rounded-lg shadow",children:[e.jsxs(Y,{className:"w-full  rounded-lg",children:[e.jsx(ye,{children:M.getHeaderGroups().map(a=>e.jsx(G,{children:a.headers.map(s=>e.jsx(je,{colSpan:s.colSpan,children:s.isPlaceholder?null:e.jsx("div",{className:s.column.getCanSort()?"cursor-pointer select-none":"",onClick:s.column.getToggleSortingHandler(),children:W(s.column.columnDef.header,s.getContext())})},s.id))},a.id))}),e.jsx(Ne,{children:M.getRowModel().rows.slice(K,Re).map(a=>e.jsx(G,{children:a.getVisibleCells().map(s=>e.jsx(_e,{children:W(s.column.columnDef.cell,s.getContext())},s.id))},a.id))})]}),e.jsx(qe,{onChange:Ee,currentPage:H,totalRows:De,rowsPerPage:B})]}),e.jsxs($e,{isOpen:me,onClose:Q,className:"rounded-md shadow",children:[e.jsx("h2",{className:"mb-4 text-xl font-bold",children:"Crear Servicio"}),e.jsx(Xe,{initialValues:{nombre_servicio:(o==null?void 0:o.nombre_servicio)||"",descripcion:(o==null?void 0:o.descripcion)||"",uid_categoria:(o==null?void 0:o.uid_categoria)||"",nombre_categoria:(o==null?void 0:o.nombre_categoria)||"",service_image:[],service_image_files:[],uid_taller:y==="Admin"?(o==null?void 0:o.uid_taller)||"":X,taller:y==="Admin"?(o==null?void 0:o.taller)||"":Z,precio:(o==null?void 0:o.precio)||"",garantia:(o==null?void 0:o.garantia)||"",typeService:"local",subcategoria:(o==null?void 0:o.subcategoria)||[]},validationSchema:ue,onSubmit:ge,children:({values:a,handleChange:s,setFieldValue:c,errors:d,touched:m})=>{var N;return e.jsxs(Ze,{className:"flex flex-col space-y-6",children:[e.jsx("div",{className:"mt-2 flex flex-col items-center rounded-lg border border-dashed border-gray-900/25 px-6 py-10",children:e.jsxs("div",{className:"text-center",children:[Array.isArray(a.service_image)&&a.service_image.length>0?e.jsx("div",{className:"grid grid-cols-3 gap-4",children:a.service_image.map((r,t)=>e.jsx("img",{src:r,alt:`Preview ${t+1}`,className:"h-32 w-32 object-cover rounded-md"},t))}):e.jsx(Qe,{className:"mx-auto h-12 w-12 text-gray-300","aria-hidden":"true"}),e.jsxs("div",{className:"mt-4 flex flex-col text-sm leading-6 text-gray-600 justify-center",children:[e.jsxs("label",{htmlFor:"images-upload",className:"relative cursor-pointer rounded-md bg-white font-semibold text-indigo-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-indigo-600 focus-within:ring-offset-2 hover:text-indigo-500 flex justify-center items-center",children:[e.jsx("span",{children:"Agregar otra imagen"}),e.jsx("input",{id:"images-upload",name:"images-upload",type:"file",accept:"image/*",multiple:!0,className:"sr-only",onChange:r=>{const t=Array.from(r.target.files||[]),l=t.map(u=>URL.createObjectURL(u));c("service_image",[...a.service_image||[],...l]),c("service_image_files",[...a.service_image_files||[],...t])}})]}),((N=a.service_image_files)==null?void 0:N.length)===0&&e.jsx("p",{className:"text-red-600 mt-2",children:"Debes seleccionar al menos una imagen."})]})]})}),e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Nombre Servicio:"}),e.jsx(f,{type:"text",name:"nombre_servicio",value:a.nombre_servicio,onChange:s,className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200"}),e.jsx(v,{name:"nombre_servicio",component:"div",className:"text-red-600 text-sm"})]}),V&&e.jsx("div",{children:e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Taller:"}),e.jsx("div",{className:"relative",children:e.jsx(J,{name:"uid_taller",options:R.map(r=>({label:r.nombre,value:r.uid})),value:R.map(r=>({label:r.nombre,value:r.uid})).find(r=>r.value===a.uid_taller)||null,onChange:r=>{const t=R.find(l=>l.uid===(r==null?void 0:r.value));c("uid_taller",(r==null?void 0:r.value)||""),c("taller",(t==null?void 0:t.nombre)||"")},placeholder:"Buscar taller...",className:"w-full mt-1 p-3 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200",isClearable:!0,isSearchable:!0})}),e.jsx(v,{name:"uid_taller",component:"div",className:"text-red-600 text-sm"})]})}),e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Tipo de Servicio:"}),e.jsxs("div",{className:"flex items-center space-x-10",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx(f,{type:"radio",name:"typeService",value:"local",className:"form-radio"}),e.jsx("span",{children:"En el Local"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx(f,{type:"radio",name:"typeService",value:"domicilio",className:"form-radio"}),e.jsx("span",{children:"A Domicilio"})]})]}),e.jsx(v,{name:"typeService",component:"div",className:"text-red-600 text-sm"})]}),e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Categoría:"}),e.jsxs(f,{as:"select",name:"uid_categoria",value:a.uid_categoria,onChange:r=>{const t=r.target.value,l=q.find(u=>u.uid_categoria===t);c("uid_categoria",t),c("nombre_categoria",(l==null?void 0:l.nombre)||""),c("subcategoria",[]),de(t)},className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200",children:[e.jsx("option",{value:"",children:"Seleccione una categoría"}),q.map(r=>e.jsx("option",{value:r.uid_categoria,children:r.nombre},r.uid_categoria))]}),e.jsx(v,{name:"uid_categoria",component:"div",className:"text-red-600 text-sm"})]}),e.jsx("label",{className:"font-semibold text-gray-700",children:"Subcategorías:"}),e.jsx(J,{isMulti:!0,placeholder:"Selecciona subcategorías",noOptionsMessage:()=>"No hay Subcategorías disponibles",options:a.uid_categoria?re.map(r=>({value:r.uid_subcategoria,label:r.nombre})):[],value:a.subcategoria.map(r=>({value:r.uid_subcategoria,label:r.nombre_subcategoria})),onChange:r=>c("subcategoria",r.map(t=>({uid_subcategoria:t.value,nombre_subcategoria:t.label}))),className:"mt-1"}),e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Descripción:"}),e.jsx(f,{as:"textarea",name:"descripcion",value:a.descripcion,onChange:s,rows:1,className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 resize-none overflow-hidden",style:{maxHeight:"150px",overflowY:"auto"},onInput:r=>{r.target.style.height="auto",r.target.style.height=`${r.target.scrollHeight}px`}}),e.jsx(v,{name:"descripcion",component:"div",className:"text-red-600 text-sm"})]}),e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Precio:"}),e.jsx(f,{type:"text",name:"precio",value:a.precio,onChange:s,className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200"}),e.jsx(v,{name:"precio",component:"div",className:"text-red-600 text-sm"})]}),e.jsxs("label",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Garantía:"}),e.jsx(f,{type:"text",name:"garantia",value:a.garantia,onChange:s,className:"mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200"}),e.jsx(v,{name:"garantia",component:"div",className:"text-red-600 text-sm"})]}),e.jsxs("div",{className:"text-right mt-6",children:[e.jsx(E,{variant:"default",onClick:Q,className:"mr-2",children:"Cancelar"}),e.jsx(E,{type:"submit",style:{backgroundColor:"#000B7E"},className:"text-white hover:opacity-80",children:"Guardar"})]})]})}})]})]})},Nr=Ve;export{Nr as default};
