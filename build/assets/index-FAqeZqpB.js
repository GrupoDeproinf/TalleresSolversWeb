import{r as o,j as e,a9 as Y,a8 as Z,a7 as $,aa as ee}from"./index-sxY2vR_b.js";import{P as te}from"./index-AsMD9Xvv.js";import{T as E}from"./index-AN3niVhH.js";import{B as T}from"./Button-gHfU8a9b.js";import{D as ae}from"./Dialog-FwOZiQ_s.js";import{u as oe,f as R,g as se,a as re,b as ne}from"./index-AdiLc_ck.js";import{t as c,N as d}from"./toast-N-ApZxOe.js";import{O as le,D as ie}from"./index.esm-cN1LGhJ4.js";import{u as j,w as ce}from"./xlsx-b-y62sF7.js";import"./index.esm-7rMJeW_p.js";import"./context-ugtK0z0w.js";import"./index-gZB_DS34.js";import"./index-t_CREONj.js";import"./CloseButton-zdejdkm_.js";import"./motion-h-3axnRn.js";import"./useTimeout-KcO8uHA1.js";import"./StatusIcon-KQcZjBe0.js";import"./chainedFunction-ltcSYACe.js";const de=()=>{const[k,P]=o.useState([]),[_,u]=o.useState([]);o.useState(null);const[v,M]=o.useState("nombre_servicio"),[h,A]=o.useState(""),[S,B]=o.useState([]),[m,C]=o.useState(""),[g,w]=o.useState(""),N=async()=>{try{const a=$(Z(Y,"servicesContact")),[t]=await Promise.all([ee(a)]),s=t.docs.map(i=>({...i.data(),uid_servicio:i.id}));B(s)}catch(a){console.error("Error obteniendo los datos:",a)}};o.useEffect(()=>{N()},[]);const H=async()=>{await N(),c.push(e.jsx(d,{title:"Datos actualizados",children:"La tabla ha sido actualizada con éxito."}))},O=a=>{const t=a.target.value;A(t),u([{id:v,value:t}])},U=a=>{const t=a.target.value;M(t),h!==""&&u([{id:t,value:h}])},[K,y]=o.useState(!1),q=()=>{y(!0)},x=()=>{y(!1),C(""),w("")},L=[{header:"Nombre del Servicio",accessorKey:"nombre_servicio"},{header:"Taller",accessorKey:"taller"},{header:"Precio",accessorKey:"precio"},{header:"Fecha de Creación",cell:({row:a})=>{var s;const t=a.original.fecha_creacion;if((s=a.original.usuario)==null||s.nombre,t){if(t.toDate)return t.toDate().toLocaleString();if(t instanceof Date)return t.toLocaleString()}return"Sin fecha"}},{header:"Nombre del Usuario",accessorKey:"usuario.nombre"},{header:"Correo del Usuario",accessorKey:"usuario.email"}],{Tr:D,Th:I,Td:z,THead:Q,TBody:V,Sorter:ue}=E,p=oe({data:S,columns:L,state:{sorting:k,columnFilters:_},onSortingChange:P,onColumnFiltersChange:u,getCoreRowModel:se(),getSortedRowModel:re(),getFilteredRowModel:ne()}),[f,G]=o.useState(1),b=6,J=p.getRowModel().rows.length,W=a=>{console.log("onPaginationChange",a),G(a)},X=()=>{if(!m||!g){c.push(e.jsx(d,{title:"Fechas incompletas",children:"Por favor, selecciona ambas fechas para continuar."}));return}const a=new Date(m);a.setUTCHours(0,0,0,0);const t=new Date(g);t.setUTCHours(23,59,59,999),console.log({startDate:a,endDate:t});const s=S.filter(r=>{var l;const n=(l=r.fecha_creacion)==null?void 0:l.toDate();return console.log("Creation date aquí",n),n&&n>=a&&n<=t}).map(r=>{var n,l;return{"Nombre del Servicio":r.nombre_servicio||"N/A",Taller:r.taller||"N/A",Precio:r.precio||"N/A","Fecha de Creación":r.fecha_creacion?r.fecha_creacion.toDate().toLocaleString():"N/A","Nombre del Usuario":((n=r.usuario)==null?void 0:n.nombre)||"N/A","Correo del Usuario":((l=r.usuario)==null?void 0:l.email)||"N/A"}});if(s.length===0){c.push(e.jsx(d,{title:"Sin datos para exportar",children:"No hay datos disponibles en el rango de fechas seleccionado."}));return}const i=j.json_to_sheet(s),F=j.book_new();j.book_append_sheet(F,i,"Servicios"),ce(F,"ServiciosSolicitados.xlsx"),c.push(e.jsx(d,{title:"Exportación exitosa",children:"El archivo Excel se ha descargado correctamente."})),x(),console.log("Start date aquí: ",a,"End date aquí",t)};return e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsxs("h1",{className:"mb-6 flex justify-start items-center space-x-4",children:[" ",e.jsx("span",{className:"text-[#000B7E]",children:"Servicios Solicitados"}),e.jsx("button",{className:"p-2  bg-slate-100 hover:bg-slate-200 active:bg-slate-300 transition-all duration-200 shadow-md transform hover:scale-105 rounded-md",onClick:H,children:e.jsx(le,{className:"w-5 h-5 text-gray-700 hover:text-blue-500 transition-colors duration-200"})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"relative w-32",children:[" ",e.jsxs("select",{className:"h-10 w-full py-2 px-4 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:U,value:v,children:[e.jsx("option",{value:"nombre_servicio",children:"Servicio"}),e.jsx("option",{value:"taller",children:"Taller"}),e.jsx("option",{value:"precio",children:"Precio"})]})]}),e.jsxs("div",{className:"relative w-80 ml-4",children:[e.jsx("input",{type:"text",placeholder:"Buscar...",className:"w-full py-2 px-4 pl-10 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 h-10",value:h,onChange:O}),e.jsx(ie,{className:"absolute left-3 top-5 transform -translate-y-1/2 text-gray-500 w-5 h-5"})]}),e.jsx("button",{style:{backgroundColor:"#000B7E"},className:"p-2 ml-4 bg-blue-500 text-white rounded-md shadow-md hover:bg-blue-600 active:bg-blue-700 transition duration-200 hover:opacity-80",onClick:q,children:"Exportar a Excel"})]})})]}),e.jsxs("div",{className:"p-1 rounded-lg shadow",children:[e.jsxs(E,{className:"w-full rounded-lg",children:[e.jsx(Q,{children:p.getHeaderGroups().map(a=>e.jsx(D,{children:a.headers.map(t=>e.jsx(I,{colSpan:t.colSpan,children:t.isPlaceholder?null:e.jsx("div",{className:t.column.getCanSort()?"cursor-pointer select-none":"",onClick:t.column.getToggleSortingHandler(),children:R(t.column.columnDef.header,t.getContext())})},t.id))},a.id))}),e.jsx(V,{children:p.getRowModel().rows.slice((f-1)*b,f*b).map(a=>e.jsx(D,{children:a.getVisibleCells().map(t=>e.jsx(z,{children:R(t.column.columnDef.cell,t.getContext())},t.id))},a.id))})]}),e.jsx(te,{onChange:W,currentPage:f,totalRows:J,rowsPerPage:b})]}),e.jsx(ae,{isOpen:K,onClose:x,children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Seleccionar Rango de Fechas"}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"startDate",className:"block text-sm",children:"Fecha de Inicio:"}),e.jsx("input",{id:"startDate",type:"date",value:m,onChange:a=>C(a.target.value),className:"w-full border border-gray-300 rounded-md p-2"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"endDate",className:"block text-sm",children:"Fecha de Fin:"}),e.jsx("input",{id:"endDate",type:"date",value:g,onChange:a=>w(a.target.value),className:"w-full border border-gray-300 rounded-md p-2"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-4",children:[e.jsx(T,{onClick:x,children:"Cancelar"}),e.jsx(T,{onClick:X,className:"text-white hover:opacity-80",style:{backgroundColor:"#000B7E"},children:"Exportar"})]})]})})]})})},ke=de;export{ke as default};
